# ConstructionYard Version 0.4
Scripts:
  Description:
    Script:
    - '@PLAYER &4WHAT IT DOES:&r A $<worldname>.<playername>CommandHelpBuilding is the first building that will be created when a new town is founded.
    It will allow you to select and build other buildings within the towns borders.
    It allows you to expand those town borders 49 times at a 16x16 block increment.
    It allows for you to recruit other players as assistants to work with you in building the town.
    It creates a personal creative world for you where you can create buildings to be saved as schematics.
    You can also hire your first NPC called a builder who will then take those schematics and build them in the survival world.
    It also allows you to buy and sell schematics with others.'
  Help:
    Script:
    - '@IF i <itemid> = 339'
    - ' @PLAYER Opened $<worldname>.<playername>CurrentBuildingCategory Help. Please complete the entire help file before doing anything else or type &4/mi cancel&r to close it.'
    - ' @PLAYER Category: $<worldname>.<playername>CurrentBuildingCategory'
    - ' @PLAYER Town: $<worldname>.<playername>CurrentBuildingTown'
    - ' @PLAYER Owner: $<worldname>.<playername>CurrentBuildingOwner'
    - ' @PLAYER Name: $<worldname>.<playername>CurrentBuildingName'
    - ' @PLAYER Upkeep: Current storage level at $Ledger.<var:$<worldname>.<playername>CurrentBuildingID>Upkeep '
    - ' @PLAYER Current Town Size: $<worldname>.<playername><var:$<worldname>.<playername>CurrentBuildingTown>TownSize '
    - ' @SETSTR $<worldname>.<playername>CommandHelpBuilding $<worldname>.<playername>CurrentBuildingCategory'
    - ' @CALL Shared:BowCheck'
    - '@ELSE'
    - ' @PLAYER Opened $<worldname>.<playername>CommandHelpBuilding Help. Please complete the entire help file before doing anything else or type &4/mi cancel&r to close it.'
    - '@ENDIF'
    - '@PLAYER &4PRICES:&r' 
    - '@PLAYER Upkeep Price:'
    - '@SETSTR $<worldname>.<playername>Building $<worldname>.<playername>CommandHelpBuilding'
    - '@SETSTR $<worldname>.<playername>Action Upkeep'
    - '@CALL Shared:PriceCheck'
    - '@CALL Shared:BowCheck'
    - '@PLAYER Price to Expand Town Borders:'
    - '@SETSTR $<worldname>.<playername>Building $<worldname>.<playername>CommandHelpBuilding'
    - '@SETSTR $<worldname>.<playername>Action ClaimTownBlock'
    - '@CALL Shared:PriceCheck'
    - '@CALL Shared:BowCheck'
    - '@PLAYER Hire a builder: Builder Population $<worldname>.<playername>BuilderPop . Price to hire:'
    - '@SETSTR $<worldname>.<playername>Building $<worldname>.<playername>CommandHelpBuilding'
    - '@SETSTR $<worldname>.<playername>Action HireBuilder'
    - '@CALL Shared:PriceCheck'
    - '@CALL Shared:BowCheck'
    - '@CALL <var:$<worldname>.<playername>CommandHelpBuilding>:Description'
    - '@CALL Shared:BowCheck'
    - '@PLAYER &4HOW IT WORKS:&r &cExpand Town Borders.&r Type &4/mi help ConstructionYard Claim&r to get help on how to claim more land.'
    - '@CALL Shared:BowCheck'
    - '@PLAYER &cAdd other Players as Residents.&r After clicking on the Ender Portal Frame Type &4/town add (playername)&r to add a player as a resident of your town.'
    - '@PLAYER &cAdd other Players as Assistants.&r Assistants can use all buildings and even claim more land for your town. Note you must add the player as a resident first see above. After clicking on the Ender Portal Frame Type &4/town rank add (playername) assistant&r to add a person as an assistant of your town.'
    - '@CALL Shared:BowCheck'    
    - '@PLAYER &cHire a Builder.&r To hire a builder you must click on the ender portal frame while holding an emerald.' 
    - '@CALL Shared:BowCheck'
    - '@PLAYER &cTeleport to Personal Creative World.&r To teleport to your personal creative world where you can build and sell your own schematics
    you must right click on the ender portal frame while holding bone meal. Note in order to save your schematic you build in this world to the correct
    building category you must have completed step 1 of building schematics. Building schematics steps will be explained next.' 
    - '@CALL Shared:BowCheck'
    - '@PLAYER &cBuilding Schematics:&r This is a 6 Step process. As you go through all the stages you will have help but 
    I will go over them here so you have an idea of how they all work.'
    - '@CALL Shared:BowCheck' 
    - '@PLAYER &cStep 1: Select a plan.&r To select a building plan first click on the ender portal frame with a &l&nfeather&r. This will start a new building project.
    Then use an &l&nempty hand&r and click on the ender portal frame, to go back on selection &l&nhold shift&r while clicking.
    Once you find your selection equip a torch and right click to select it.'
    - '@CALL Shared:BowCheck'    
    - '@PLAYER &cStep 2: Select a schematic.&r Once step 1 is complete you can select a schematic of that building type of your own or one you purchased. This can be done by 
    using an empty hand and clicking on the ender portal frame, to go back on selection bow(shift) while clicking. Once you find your selection equip a shovel and right click to select
    it which will give the plan to your builder.'
    - '@CALL Shared:BowCheck'
    - '@PLAYER &cStep 2 Alternative: Buying a schematic.&r You can also choose to select and buy a schematic of the building type. This can be done by 
    eqiupping an emerald and clicking on the ender portal frame, to go back on selection bow(shift) while clicking. Once you find your selection equip a torch and right click to teleport
    to that schematic to investigate or purchase. This is useful when you have already purchased a schematic as well because it allows you to investigate the details before placing.' 
    - '@CALL Shared:BowCheck'
    - '@PLAYER &cStep 3: Breaking Ground.&r Once step 2 is complete you can build the schematic. This can only be done if you have
    hired a builder. Once you hire a builder walk to the location where you want to build your schematic and type &4/mi builder survey&r. 
    The builder you have selected will then place four glass blocks at the bottom corners of the building schematic you have selected and will
    also tell you how many blocks approximatly it will take to build in that area.'
    - '@CALL Shared:BowCheck'
    - '@PLAYER &cStep 4: Building Schematic.&r Once step 3 is complete and you are happy with your placement you will type &4/mi schematic build&r.
    You will then be able to interact with the builder. Right clicking on him twice while having a block he needs equipped will give him those blocks.
    Once he has all the blocks he needs he will start building the structure.'
    - '@CALL Shared:BowCheck'
    - '@PLAYER &cStep 5: Ledger.&r When the builder finishes step 4 he will notify you. This will unlock the Ledger stage in which you will name your
    building and activate it. If you need to you can start the ledger stage by simply clicking on the Construction Yard end portal frame with an empty hand while having
    the correct plan selected. Activating the building requires you to fill its upkeep and this can be done by left clicking on the new end portal frame for the building with wheat.'
    - '@CALL Shared:BowCheck'
    - '@PLAYER &cStep 6: Upkeep.&r Each building will have a different upkeep cost. You can find the upkeep cost by clicking the ender portal frame of
    that building while having a book and quill equipped.'
    - '@CALL Shared:BowCheck'
# NEED TO TEST TO MAKE SURE BUILDER WILL STILL ACTIVATE THE RIGHT LEDGER STAGE EVEN IF BUILDING ANOTHER STRUCTURE.    
    - '@PLAYER &cReset Stages.&r At anytime you can right click on the ender portal frame with a feather to switch to another schematic
    which will put your current project on hold. This is helpfull when your builder is taking a while to build something but you still 
    want to go access your creative world to build your next project. To get back to your project simply do steps 1 and 2, once you
    select the schematic for the building you had on hold it will jump you to stage your were on.'
    - '@CALL Shared:BowCheck' 
    - '@PLAYER As the owner you can also click the ender portal frame while having a book and quill equipped to see how much money this $<worldname>.<playername>CommandHelpBuilding has made you.'
    - '@PLAYER HELP ENDED'
  HelpSchematic:
    Script:
    - '@PLAYER Schematics Help File Opened.'
    - '@PLAYER Commands: anything in () is text you add with no spaces and without the ()'
    - '@PLAYER &4/mi help ConstructionYard schematic&r - pulls up this help file.'
    - '@PLAYER &4/mi builder survey&r - specifies the location you are standing at as the location you want your builder to survey and mark up for building a selected schematic.'
    - '@PLAYER &4/mi schematic build&r - after a builder survey this will build the selected schematic at the location surveyed.'
    - '@PLAYER &4/mi schematic rotate (degrees)&r - rotates a schematic given to a builder by degrees specified must use 90 180 or 270 make sure to run builder survey after rotation.'
    - '@PLAYER &4/mi schematic publish (NameOfSchematic) (PriceOfSchematic) (HoldsPopulationOf)&r - Allows you to start the publishing of a schematic you build with the name and price given. Note that the category is chosen using the construction yard before teleporting to the creative world.'    
    - '@PLAYER &4/mi schematic ledger (NameOfBuilding)&r - Allows you to name the building after you finished building and activating it.'
    - '@PLAYER &4/mi help ConstructionYard&r - pulls up the detailed help file on the ConstructionYard and all the powers it provides.'
    - '@PLAYER &4Schematics Help File Closed.&r'
  HelpTown:
    Script:
    - '@PLAYER See http://silverscreed.gaming.multiplay.co.uk/Help.htm#Town.'
  HelpClaim:
    Script:
    - '@PLAYER Plot Claim Help File Opened.'
    - '@PLAYER Commands: anything in () is text you add with no spaces and without the ()'
    - '@PLAYER &4/mi help ConstructionYard Claim&r - pulls up this help file.'
    - '@PLAYER &4/mi claim&r - claims the 16x16 chunk of land your standing in for your town. Note that if you are not standing in a 16x16 block that is attached to one you already own then the nearest 16x16 block that IS ATTACHED will be claimed. This will cost you:' 
    - '@SETSTR $<worldname>.<playername>Building $<worldname>.<playername>CommandHelpBuilding'
    - '@SETSTR $<worldname>.<playername>Action ClaimTownBlock'
    - '@CALL Shared:PriceCheck'
    - '@PLAYER &4/resident toggle map&r - Turns on map which refreshes when moving across plot borders.'
    - '@PLAYER &4/resident toggle plotborder&r - Turns on smokey plot-border view. Border shows when players cross to different townblocks.'
    - '@PLAYER &4/resident toggle reset&r - This turns off all modes that are active.' 
    - '@PLAYER &4/mi help ConstructionYard&r - pulls up the detailed help file on the ConstructionYard and all the powers it provides.'
    - '@PLAYER &4Plot Claim Help File Closed.&r'
  HelpTownCopy:
    Script:
    - '@PLAYER Town Copy Help File Opened.'
    - '@PLAYER This is useful for copying land you own into a creative world so you can design buildings for your landscape
    and explore the depths of your town in creative mode for exploration in survival mode.'
    - '@CALL Shared:BowCheck' 
    - '@PLAYER When in Town Copy mode you can no longer build outside of your town borders. 
    And in order to activate the commands below you need to place a block inside your town and within a 16 block radius of what you want to copy.
    Once you place a block you will be granted the ability to copy anything within 16 blocks of where you are standing.'
    - '@CALL Shared:BowCheck'     
    - '@PLAYER In Town Copy mode you can use a wooden axe to make selections see http://wiki.sk89q.com/wiki/WorldEdit/Quick_start#Making_selections'
    - '@CALL Shared:BowCheck'     
    - '@PLAYER Commands: anything in () is text you add with no spaces and without the ()'
    - '@PLAYER &4/mi towncopy&r - turns towncopy mode on.'
    - '@PLAYER &4/mi towncopy stop&r - turns towncopy mode off.'
    - '@PLAYER &4/toggleeditwand&r - Toggles the edit wand selection mode, allowing you to use the edit wand item normally.'
    - '@PLAYER &4//pos1&r - Set selection position #1 to the block above the one that you are standing on.'
    - '@PLAYER &4//pos2&r - Set selection position #2 to the block above the one that you are standing on.'
    - '@PLAYER &4//chunk&r - Select the chunk that you are within for your selection. This will select an entire town block very easily.'
    - '@PLAYER &4//count (block)&r - Count the number of blocks in the region.'
    - '@PLAYER &4//distr&r - Get the block distribution in the selection.'
    - '@PLAYER &4//copy&r - Copies the currently selected region. Be aware that it stores your position relative to the selection when copying.'
    - '@PLAYER &4/clearclipboard&r - Clear your clipboard.'
    - '@PLAYER &4//size&r - Get information about the selection.'
    - '@PLAYER &4Town Copy Help File Closed.&r'
  HelpEndPortalFrame:
    Script:
    - '@PLAYER Remember the construction yard is the center of most towns. So the ender portal frame should probably be accessible from all sides but does not have to be.'
  Setup:
    Script:
    - '@SETSTR $<worldname>.<playername>CurrentBuildingCategory ConstructionYard'
    - '@IF b $<worldname>.<playername>NewPlayer = True'
#    - ' @CMDOP pex group $<worldname>.<playername>CurrentBuildingCategory user add <playername>'
    - ' @PLAYER &8LOG $<worldname>.<playername>CurrentBuildingCategory Setup Complete&r'
    - '@ELSE'
# The next few scripts will add a group TO PERMISSIONSEX. It will be activated when needed.
    - '@CMDOP pex group $<worldname>.<playername>CurrentBuildingCategory delete'
    - '@CMDOP pex group $<worldname>.<playername>CurrentBuildingCategory create'
    - '@CMDOP pex group $<worldname>.<playername>CurrentBuildingCategory add -towny.wild.*'
    - '@CMDOP pex group TownCopy delete'
    - '@CMDOP pex group TownCopy create'
    - '@CMDOP pex group TownCopy add worldedit.clipboard.copy'
    - '@CMDOP pex group TownCopy add worldedit.clipboard.clear'
    - '@CMDOP pex group TownCopy add worldedit.selection.chunk'
    - '@CMDOP pex group TownCopy add worldedit.wand'
    - '@CMDOP pex group TownCopy add worldedit.selection.pos'
    - '@CMDOP pex group TownCopy add worldedit.analysis*'
    - '@CMDOP pex group TownCopy add worldedit.selection.size'
    - '@CMDOP pex group Towny delete'
    - '@CMDOP pex group Towny create'
    - '@CMDOP pex group Towny add njs.towny.rank.modify'
    - '@CMDOP pex group Towny add towny.command.town.add'
    - '@CMDOP pex group Towny add towny.command.town.kick'
    - '@CMDOP pex group Towny add towny.command.town.rank.*'    
#    - '@CMDOP pex group $<worldname>.<playername>CurrentBuildingCategory user add $UserList.ForPEX'
#   TECH COST
    - '@SETINT $Price.<var:$<worldname>.<playername>CurrentBuildingCategory>Tech 5'
#   ACTION COSTS
    - '@SETSTR $ITEMID.YellowWool 35:4'
    - '@SETSTR $ITEMID.RedWool 35:14'
    - '@SETSTR $ITEMID.BoneMeal 351:15'
    - '@SETINT $Price.<var:$<worldname>.<playername>CurrentBuildingCategory>HireBuilder 20'
    - '@SETSTR $ItemTake.<var:$<worldname>.<playername>CurrentBuildingCategory>HireBuilder YES'
    - '@SETINT $ItemTypeAmount.<var:$<worldname>.<playername>CurrentBuildingCategory>HireBuilder 1'
    - '@SETSTR $ITEMID.Villager 383:120'
    - '@SETSTR $ItemName.<var:$<worldname>.<playername>CurrentBuildingCategory>HireBuilder1 Villager'
    - '@SETINT $ItemAmount.<var:$<worldname>.<playername>CurrentBuildingCategory>HireBuilder1 1'
    - '@SETINT $Price.<var:$<worldname>.<playername>CurrentBuildingCategory>ClaimTownBlock 25'
#   UPKEEP COST
    - '@SETINT $Price.<var:$<worldname>.<playername>CurrentBuildingCategory>Upkeep 1'
    - '@SETSTR $ItemTake.<var:$<worldname>.<playername>CurrentBuildingCategory>Upkeep YES'
    - '@SETINT $ItemTypeAmount.<var:$<worldname>.<playername>CurrentBuildingCategory>Upkeep 1'
    - '@SETSTR $ITEMID.Bread 297'
    - '@SETSTR $ItemName.<var:$<worldname>.<playername>CurrentBuildingCategory>Upkeep1 Bread'
    - '@SETINT $ItemAmount.<var:$<worldname>.<playername>CurrentBuildingCategory>Upkeep1 10'
#   VERSION
    - '@IF s $Setup.<var:$<worldname>.<playername>CurrentBuildingCategory>Version != 0.3a'
    - ' @SETSTR $Setup.<var:$<worldname>.<playername>CurrentBuildingCategory>Version 0.3a'
    - ' @PLAYER <var:$<worldname>.<playername>CurrentBuildingCategory> Version $Setup.<var:$<worldname>.<playername>CurrentBuildingCategory>Version setup completed.'
    - '@ELSE'
    - ' @PLAYER <var:$<worldname>.<playername>CurrentBuildingCategory> Version $Setup.<var:$<worldname>.<playername>CurrentBuildingCategory>Version has already been setup.'
    - '@ENDIF'
#   First Time Setup handled by NateConfig:Reload ConstructionYard will be set to Tech.0
    - '@PLAYER $<worldname>.<playername>CurrentBuildingCategory Setup Completed'
    - '@DELVAR s $<worldname>.<playername>CurrentBuildingCategory'
    - '@ENDIF'
  Settle:
    Script:
# FOR Testing /vtrigger delvar b natersteen Settled
    - '@IF si <cmdarg:1> = claim'
    - '@AND i <cmdargcount> = 3'
    - '@AND b $<worldname>.<playername>Settled = False'
    - ' @SETSTR $<worldname>.<playername>CurrentTown <cmdarg:2>'
    - ' @GETSTRLEN $<playername>TMP.SelectionCheck $<worldname>.<playername>CurrentTown'
    - ' @PLAYER &8Log CurrentTown StrLen Check $<playername>TMP.SelectionCheck &r'
    - ' @IF i $<playername>TMP.SelectionCheck >= 2'
    - '     @DELVAR i $<playername>TMP.SelectionCheck'
    - '     @PLAYER &8Log Deleted? CurrentTown StrLen Check $<playername>TMP.SelectionCheck &r'
    - '     @SETSTR $<worldname>.<playername>NameTMP <cmdarg:3>'
    - '     @GETSTRLEN $<playername>TMP.SelectionCheck $<worldname>.<playername>NameTMP'
    - '     @PLAYER &8Log BuildingName StrLen Check $<playername>TMP.SelectionCheck &r'
    - '     @IF i $<playername>TMP.SelectionCheck >= 2'
    - '         @DELVAR i $<playername>TMP.SelectionCheck'
    - '         @PLAYER &8Log Deleted? BuildingName StrLen Check $<playername>TMP.SelectionCheck &r'
    - '         @SETBOOL $<worldname>.<playername>ConstructionYardLedgerCommand True'
    - '         @POOF 5 <playerloc>'
    - '         @EXPLOSION 0.0 <playerloc>'
    - '         @CMDOP town new <cmdarg:2>'
    - '         @SETBOOL $<worldname>.<playername>Settled True'
    - '         @SETINT $<worldname>.<playername><cmdarg:2>TownCopyBlocks 1'
    - '         @SETINT $<worldname>.<playername><cmdarg:2>TownSize 1'
#    - '        @CMDOP town toggle explosion'
#    - '        @CMDOP town toggle fire'
#    - '        @CMDOP town toggle mobs'
    - '         @SETBLOCK 120:0 <playerloc>'
    - '         @SETSTR $<worldname>.<playername>NextScriptText You have claimed this plot of land as your own and have started a town named <cmdarg:2> and started to create a Construction Yard named <cmdarg:3>. 
    You feel power eminating from the ender portal frame that just appeared next to you. As you walk near it 
    a sudden rush of magical energy engulfs you. (Remember &4...&r means there is more text or another step. Follow the directions after the &4...&r to continue.)'
    - '         @SETSTR $<worldname>.<playername>NextScript ConstructionYard:Settle1'
    - '         @CALL Shared:NextStep'
    - '     @ELSE'
    - '         @PLAYER You Building Name does not follow proper naming conventions. Please use letters and numbers only with no spaces _ is allowed.
    Please retry. Remember type &4/settle claim NameOfSettlement NameOfConstructionYard&r to begin building your first settlement. '
    - '     @ENDIF'
    - ' @ELSE'
    - '     @PLAYER You Town Name does not follow proper naming conventions. Please use letters and numbers only with no spaces _ is allowed.
    Please retry. Remember type &4/settle claim NameOfSettlement NameOfConstructionYard&r to begin building your first settlement.'
    - ' @ENDIF'
    - '@ELSE'
    - ' @PLAYER You typed the command wrong. Or you already created your first free settlement.
    Simply type &4/settle claim NameOfSettlement NameOfConstructionYard&r to begin building your first settlement. Use letters and numbers only with no spaces _ is allowed.'
    - '@ENDIF'
  Settle1:
    Script:
    - '@PLAYER Placing the Construction Yard Command Block now.'
    - '@CALL Shared:BowCheck'
    - '@SETSTR $<worldname>.<playername>ActivePlans ConstructionYard'
    - '@SETSTR $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage Ledger'
    - '@SETBOOL $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>LedgerCommand True'
# CREATE A STEP CHECK HERE FOR IF SERVER GOES DOWN ON LOG BACK IN REACTIVATES SCRIPT AT THIS LOCATION. FYI THIS IS WHERE I LOST CONNECTION AT.    
    - '@CALL ConstructionYard:Ledger'
  Power:
    Script:
    - '@CALL Shared:BuildingID'
#    - '@CALL Shared:Upkeep'
#    - '@PLAYER &8LOG ActivePlansStage $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage ConstructionYardProjectStatus $<worldname>.<playername>ConstructionYardProjectStatus LOGEND&r'
    - '@IF b $<worldname>.<playername>AllowedUse = True'
    #  /mi select hire - to hire A BUILDER.
    - ' @IF s $<worldname>.<playername>Select = hire'
    - '     @IF i $<worldname>.<playername>BuilderPop < 1'
    - '         @SETSTR $<worldname>.<playername>Building ConstructionYard'
    - '         @SETSTR $<worldname>.<playername>Action HireBuilder'
    - '         @CALL Shared:Price'
    - '         @IF b $<worldname>.<playername>PriceCheck = true'
    - '             @CMDOP npc create Bob --type PLAYER --trait builder'
    - '             @PAUSE 1'
    - '             @CMDOP npc assignment --set Builder'
    - '             @CMDOP npc vulnerable'
    - '             @CMDOP npc health --set 100'
    - '             @CMDOP builder supply true'
    - '             @CMDOP npc lookclose'
    - '             @PLAYER You hired a builder named Bob type &4/npc rename (name)&r to change his name. 
    He will now be able to help you build schematics during the breaking ground stage. 
    To select him before building equip a stick and right click on him. 
    He is currently selected so clicking on him with a stick now will do nothing. 
    We now will set the anchor for where he lives. This is where he will return to once he is 
    done building a structure.'
    - '             @CALL Shared:BowCheck'
    - '             @PLAYER Move to the location then type &4/npc anchor --save home&r and the anchor will 
    be created and the builder will move to that location. Note that you can change his home at anytime'
    - '             @CALL Shared:BowCheck'
#    - '             @CMDOP npc anchor --save home'
    - '             @PLAYER Once you run the command Bobs home will be set. You will then be all set 
    to start using him as you wish to build fantastic structures. Remember right click on him with a stick when 
    you want to use and abuse him. You can also type &4/npc help&r for a list of commands you can use 
    or visit http://wiki.citizensnpcs.com/Commands for the full list.'
    - '             @ADDINT $<worldname>.<playername>BuilderPop 1'
#    - '         @ELSE'
#    - '             @PLAYER Did you lose your villager? If so next time make sure to left click while holding a villager spawn egg and not right click!'
    - '         @ENDIF'
    - '     @ELSE'
    - '         @PLAYER You can only have one builder hired for a level 1 construction yard.'
    - '     @ENDIF'
    - ' @ENDIF'
    #  /mi select creative - To teleport to your own personal creative world.
    - ' @IF s $<worldname>.<playername>Select = creative'
    - ' @AND i <hasitem:<playername>:$ITEMID.BoneMeal> >= 1'
    - '     @IF b <takeitem:<playername>:$ITEMID.BoneMeal:1> = True'
    - '         @IF b $<worldname>.<playername>CreativeWorldGenerated = True'
    - '             @CMDOP setwarp <playername>SurvivalBindPoint'
    - '             @PLAYER Warping you to your personal creative world for planning and creating your own schematics.
    Remember type &4/mi schematic publish (NameOfSchematic) (PriceOfSchematic) (HoldsPopulationOf)&r. When you are ready to publish anything you have built. 
    Please use letters and numbers only with no spaces but _ is allowed.'
    - '             @CMDCON mv load <playername>Creative'
    - '             @SOUNDEX PORTAL_TRIGGER 1.0 0.5 <currentloc:<playername>>'
    - '             @PAUSE 5'
    - '             @CMDOP mv tp <playername> <playername>Creative'
    - '             @PAUSE 5'
#    - '             @SETSTR $<worldname>.<playername>LastWorldTeleportedTo <playername>Creative'
    - '             @PLAYER Once you are done building type &4/mi warp&r to warp back to your Construction Yard. You can also type &4/mi help&r to
    pull up all the commands for this creative world that can be used by you. To change your gamemode to creative type &4/mi gm 1&r'
#    - '             @CMDOP gamemode 1 <playername>'
#    - '             @CMDOP pex user <playername> group add creative'
    - '         @ELSE'
    - '             @PLAYER Creating World <playername>Creative'
    - '             @CMDOP setwarp <playername>SurvivalBindPoint'
    - '             @CMDOP mv create <playername>Creative NORMAL -t FLAT -a false'
    - '             @PAUSE 5'
    - '             @PLAYER Setting Properties for World <playername>Creative'    
    - '             @CMDOP mvm set mode creative <playername>Creative'
    - '             @CMDOP mvm set diff peaceful <playername>Creative'
    - '             @CMDOP mvm set memory false <playername>Creative'
    - '             @CMDOP mvm set animals false <playername>Creative'
    - '             @CMDOP mvm set monsters false <playername>Creative'
    - '             @CMDCON wb <playername>Creative set 250 250 0 0'
#    - '             @CMDOP pex user <playername> add towny.wild.* <playername>Creative'
#    - '             @CMDOP pex user <playername> add -modifyworld.items.hold.381 <playername>Creative'
    - '             @SETBOOL $<worldname>.<playername>CreativeWorldGenerated True'
    - '             @PAUSE 5'
    - '             @PLAYER Warping you to your personal creative world for planning and creating your own schematics.
    Remember type &4/mi schematic publish (NameOfSchematic) (PriceOfSchematic) (HoldsPopulationOf)&r when you are ready to publish anything you have built.
    Please use letters and numbers only with no spaces but _ is allowed.'
    - '             @SOUNDEX PORTAL_TRIGGER 1.0 0.5 <currentloc:<playername>>'
    - '             @PAUSE 5'
    - '             @CMDOP mv tp <playername> <playername>Creative'
    - '             @PAUSE 5'
#    - '             @SETSTR $<worldname>.<playername>LastWorldTeleportedTo <playername>Creative'
#    - '             @CMDOP vtevent BlockPlaced @CALL Shared:PlayernameCreativeBlockPlacedEvent'
    - '             @PLAYER Once you are done building type &4/mi warp&r to warp back to your Construction Yard. You can also type &4/mi help&r to
    pull up all the commands for this creative world that can be used by you. To change your gamemode to creative type &4/mi gm 1&r' 
#    - '             @CMDOP gamemode 1 <playername>'
#    - '             @CMDOP pex user <playername> group add creative'
    - '         @ENDIF'
    - '     @ENDIF'
    - ' @ENDIF'
# USE Feather to start new project.
    - ' @IF i <itemid> = 288'
    - '     @IF s $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage != Building'
    - '         @SETSTR $<worldname>.<playername>ConstructionYardProjectStatus New'
    - '         @PLAYER You start a new project and put your other project on hold for now.'
    - '         @DELVAR s $<worldname>.<playername>ActivePlans'
    - '     @ELSE'
    - '         @PLAYER You cannot start a new project until your builder has completed the structure. This maybe removed in future builds.'
    - '     @ENDIF'
    - ' @ENDIF'
        # This is done so that if its their first time ever you still get set to be able to start a new project
    - ' @IF s $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage != BreakingGround'
    - ' @AND s $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage != Ledger'
    - ' @AND s $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage != Building'
    - '     @SETSTR $<worldname>.<playername>ConstructionYardProjectStatus New'
    - ' @ENDIF'
    #   This is the start of actrually selects and making a schematic.
    - ' @IF s $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage = BreakingGround'
    - ' @OR s $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage = Ledger'
    - ' @OR s $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage = Building'
    - ' @AND s $<worldname>.<playername>ConstructionYardProjectStatus = Started'
#    - '     @PLAYER &8LOG Trying to call script ConstructionYard <var:$<worldname>.<playername>ActivePlans> $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage LOGEND&r'
    - '     @CALL ConstructionYard:$<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage'
    - ' @ELSE'
    # If you click with your hand increment which Plans you have selected.  You will only see Plans you have purchased and if you hit the end of the plans it will loop back to the beginning. 
    # If no plans are found then you will be notified you have no plans.
    - '     @IF i <itemid> = 0'
    - '     @AND b <issneaking:> = false'
    - '         @ADDINT $<worldname>.<playername>PlansSelection 1'
#    - '         @PLAYER &8LOG PlansSelection $<worldname>.<playername>PlansSelection LOGEND&r'
    - '         @GETSTRLEN $<worldname>.<playername>TechSelectionCheck $Tech.<var:$<worldname>.<playername>PlansSelection>'
#    - '         @PLAYER &8LOG TechSelectionCheck $<worldname>.<playername>TechSelectionCheck LOGEND&r'
    - '         @SETSTR $<worldname>.<playername>PlansSelectionStr $Tech.<var:$<worldname>.<playername>PlansSelection>'
#    - '         @PLAYER &8LOG PlansSelectionStr $<worldname>.<playername>PlansSelectionStr Purchased? $<worldname>.<playername>Plans<var:$<worldname>.<playername>PlansSelectionStr> LOGEND&r'
    - '         @IF s $<worldname>.<playername>Plans<var:$<worldname>.<playername>PlansSelectionStr> = purchased'
    - '         @AND i $<worldname>.<playername>TechSelectionCheck != 1'
    - '             @PLAYER Plans $Tech.<var:$<worldname>.<playername>PlansSelection> Selected. Equip and click with a torch to select the plans so that you can either create a schematic of it or start building it.'
    - '         @ELSE'
    - '             @SETINT $<worldname>.<playername>PlansSelectionStart $<worldname>.<playername>PlansSelection'
    - '             @ADDINT $<worldname>.<playername>PlansSelection 1'
    - '             @SETSTR $<worldname>.<playername>PlansSelectionStr $Tech.<var:$<worldname>.<playername>PlansSelection>'
    - '             @LOOP 720'
    - '                 @IF s $<worldname>.<playername>Plans<var:$<worldname>.<playername>PlansSelectionStr> = purchased'
    - '                 @OR i $<worldname>.<playername>PlansSelection = $<worldname>.<playername>PlansSelectionStart'
    - '                     @BREAKLOOP'
    - '                 @ELSE'
    - '                     @GETSTRLEN $<worldname>.<playername>TechSelectionCheck $Tech.<var:$<worldname>.<playername>PlansSelection>'
    - '                     @IF i $<worldname>.<playername>TechSelectionCheck = 1'
    - '                         @SETINT $<worldname>.<playername>PlansSelection 0'
    - '                     @ELSE'
    - '                         @ADDINT $<worldname>.<playername>PlansSelection 1'
    - '                     @ENDIF'
    - '                     @SETSTR $<worldname>.<playername>PlansSelectionStr $Tech.<var:$<worldname>.<playername>PlansSelection>'
    - '                 @ENDIF'
    - '             @ENDLOOP'
    - '             @IF i $<worldname>.<playername>PlansSelection = $<worldname>.<playername>PlansSelectionStart'
    - '                 @PLAYER You own no Plans.  Please buy some plans from the Golden City.'
    - '             @ELSE'
    - '                 @PLAYER Plans $Tech.<var:$<worldname>.<playername>PlansSelection> Selected. Equip and click with a torch to select the plans so that you can either create a schematic of it or start building it.'
    - '             @ENDIF'
    - '         @ENDIF'
    - '     @ENDIF'
    # If you click with your hand and you are sneaking (holding shift) pull the previous Plan.  You will only see Plans you have purchased and if you hit the beginning of the plans it will loop back to the end. 
    # If no plans are found then you will be notified you have no plans.
    - '     @IF i <itemid> = 0'
    - '     @AND b <issneaking:> = true'
    - '         @SUBINT $<worldname>.<playername>PlansSelection 1'
    - '         @GETSTRLEN $<worldname>.<playername>TechSelectionCheck $Tech.<var:$<worldname>.<playername>PlansSelection>'
    - '         @SETSTR $<worldname>.<playername>PlansSelectionStr $Tech.<var:$<worldname>.<playername>PlansSelection>'
    - '         @IF s $<worldname>.<playername>Plans<var:$<worldname>.<playername>PlansSelectionStr> = purchased'
    - '         @AND i $<worldname>.<playername>TechSelectionCheck != 1'
    - '             @PLAYER Plans $Tech.<var:$<worldname>.<playername>PlansSelection> Selected. Equip and click with a torch to select the plans so that you can either create a schematic of it or start building it.'
    - '         @ELSE'
    - '             @SETINT $<worldname>.<playername>PlansSelectionStart $<worldname>.<playername>PlansSelection'
    - '             @SUBINT $<worldname>.<playername>PlansSelection 1'
    - '             @SETSTR $<worldname>.<playername>PlansSelectionStr $Tech.<var:$<worldname>.<playername>PlansSelection>'
    - '             @LOOP 720'
    - '                 @IF s $<worldname>.<playername>Plans<var:$<worldname>.<playername>PlansSelectionStr> = purchased ' 
    - '                 @OR i $<worldname>.<playername>PlansSelection = $<worldname>.<playername>PlansSelectionStart'     
    - '                     @BREAKLOOP'
    - '                 @ELSE'
    - '                     @GETSTRLEN $<worldname>.<playername>TechSelectionCheck $Tech.<var:$<worldname>.<playername>PlansSelection>'
    - '                     @IF i $<worldname>.<playername>TechSelectionCheck = 1'
    - '                         @ADDINT $<worldname>.<playername>PlansSelection 2'
    - '                         @GETSTRLEN $<worldname>.<playername>TechSelectionCheck $Tech.<var:$<worldname>.<playername>PlansSelection>' 
    - '                         @WHILE i $<worldname>.<playername>TechSelectionCheck != 1'
    - '                             @ADDINT $<worldname>.<playername>PlansSelection 1'
    - '                             @GETSTRLEN $<worldname>.<playername>TechSelectionCheck $Tech.<var:$<worldname>.<playername>PlansSelection>'
    - '                         @ENDWHILE'
    - '                         @SUBINT $<worldname>.<playername>PlansSelection 1'
    - '                     @ELSE'
    - '                         @SUBINT $<worldname>.<playername>PlansSelection 1'
    - '                     @ENDIF'
    - '                     @SETSTR $<worldname>.<playername>PlansSelectionStr $Tech.<var:$<worldname>.<playername>PlansSelection>'
    - '                 @ENDIF'
    - '             @ENDLOOP'
    - '             @IF i $<worldname>.<playername>PlansSelection = $<worldname>.<playername>PlansSelectionStart'
    - '                 @PLAYER You own no Plans.  Please buy some plans from the Golden City.'
    - '             @ELSE'
    - '                 @PLAYER Plans $Tech.<var:$<worldname>.<playername>PlansSelection> Selected. Equip and click with a torch to select the plans so that you can either create a schematic of it or start building it.'
    - '             @ENDIF'
    - '         @ENDIF'
    - '     @ENDIF'
#           USE Torch to select tech plan.    
    - '     @IF i <itemid> = 50'
    - '         @IF s $<worldname>.<playername>PlansSelectionStr != ConstructionYard'
    - '             @IF s $<worldname>.<playername>Plans<var:$<worldname>.<playername>PlansSelectionStr> = purchased'
    - '                 @PLAYER You unravel the plans and begin to build your $<worldname>.<playername>PlansSelectionStr'
    - '                 @PAUSE 5'
    - '                 @SETSTR $<worldname>.<playername>ActivePlans $<worldname>.<playername>PlansSelectionStr'
    - '                 @IF s $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage = BreakingGround'
    - '                 @OR s $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage = Ledger'
    - '                 @OR s $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage = Building'
    - '                     @SETSTR $<worldname>.<playername>ConstructionYardProjectStatus Started'
    - '                     @PLAYER Loading your project where you left off which was on stage $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage'
#    - '                     @CALL ConstructionYard:$<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage'
    - '                 @ELSE'
    - '                     @SETSTR $<worldname>.<playername>ConstructionYardProjectStatus Started'
    - '                     @SETSTR $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage BreakingGround'
    - '                     @PLAYER You have entered the breaking ground stage of your $<worldname>.<playername>PlansSelectionStr plan. See Help(click with paper equipped) for more information if your confused what to do next.'
    - '                 @ENDIF'
    - '             @ELSE'
    - '                 @PLAYER You look at the plans but as you read them they fade away and are replaced with an image of a bed and you holding some bone meal as you get into the bed.'
    - '             @ENDIF'
    - '         @ENDIF'
    - '     @ENDIF'
    - '     @DELVAR i $<worldname>.<playername>TechSelectionCheck'
    - '     @DELVAR i $<worldname>.<playername>PlansSelectionStart'
    - ' @ENDIF'
    - '@ENDIF'
  BreakingGround:
    Script:
    # If you click with your hand increment which Schematic you have selected.  You will only see Schematic you have purchased and if you hit the end of the Schematic it will loop back to the beginning. 
    # If no Schematic are found then you will be notified you have no Schematic.
#    - '@PLAYER &8LOG Running ConstructionYard BreakingGround Script. LOGEND&r'
    - '@IF i <itemid> = 0'
    - '@AND b <issneaking:> = false'
    - ' @DELVAR b $<worldname>.<playername>SchematicSelected'
    - ' @ADDINT $<worldname>.<playername>SchematicSelection 1'  
#    - ' @PLAYER &8LOG $<worldname>.<playername>SchematicSelection LOGEND&r'
    - ' @SETSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>ActivePlans'
    - ' @ADDSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>SchematicSelection'    
#    - ' @PLAYER &8LOG $<worldname>.<playername>SchematicSelectionStr LOGEND&r'
    - ' @GETSTRLEN $<worldname>.<playername>SchematicSelectionCheck $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
#    - ' @PLAYER &8LOG $<worldname>.<playername>SchematicSelectionCheck LOGEND&r'
#    - ' @PLAYER &8LOG $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> LOGEND&r'
#    - ' @PLAYER &8LOG Selected: $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> Purchased: $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> Owner: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner LOGEND&r'
    # THIS ENTIRE SECTION HAS TO BE FIXED ALONG WITH THE GOING DOWN MENU.
#    - '     @IF i $<worldname>.<playername>SchematicSelectionCheck != 1'
    - ' @IF s $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> = purchased'
    - ' @OR s $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner = <playername>'
    - '     @SETBOOL $<worldname>.<playername>SchematicSelected True'
    - '     @PLAYER Schematic Name: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Name Owner: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner Population: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Pop selected. Select your builder by clicking on him with a stick and then click on the construction yard ender portal frame with a shovel to give the builder this schematic.'
    - ' @ELSE'
    - '     @SETINT $<worldname>.<playername>SchematicSelectionStart $<worldname>.<playername>SchematicSelection'
    - '     @ADDINT $<worldname>.<playername>SchematicSelection 1'
    - '     @SETSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>ActivePlans'
    - '     @ADDSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>SchematicSelection'
    - '     @LOOP 720'
    - '         @IF s $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> = purchased'
    - '         @OR s $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner = <playername>'  
    - '         @OR i $<worldname>.<playername>SchematicSelection = $<worldname>.<playername>SchematicSelectionStart'     
    - '             @BREAKLOOP'
    - '         @ELSE'
    - '             @GETSTRLEN $<worldname>.<playername>SchematicSelectionCheck $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - '             @IF i $<worldname>.<playername>SchematicSelectionCheck = 1'
    - '                 @SETINT $<worldname>.<playername>SchematicSelection 0'
    - '             @ELSE'
    - '                 @ADDINT $<worldname>.<playername>SchematicSelection 1'
    - '             @ENDIF'
    - '             @SETSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>ActivePlans'
    - '             @ADDSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>SchematicSelection'
    - '         @ENDIF'
    - '     @ENDLOOP'
    - '     @IF i $<worldname>.<playername>SchematicSelection = $<worldname>.<playername>SchematicSelectionStart'
    - '     @OR i $<worldname>.<playername>SchematicSelectionCheck = 1'
    - '         @PLAYER You have no schematics filed under $<worldname>.<playername>ActivePlans . To buy a schematic equip an emerald and click on this same button to begin browsing through the schematics you can purchase. Or make your own. Hint: Click with paper for more help.'
    - '     @ELSE'
    - '         @SETBOOL $<worldname>.<playername>SchematicSelected True'
    - '         @PLAYER Schematic Name: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Name Owner: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner Population: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Pop selected. 
    Using a STICK, select your BUILDER. Next use a SHOVEL on your CONSTRUCTION YARD to give him the schematic.'
    - '     @ENDIF'
    - ' @ENDIF'
    - '@ENDIF'
    # If you click with your hand and you are sneaking (holding shift) pull the previous Plan.  You will only see Schematic you have purchased and if you hit the beginning of the Schematic it will loop back to the end. 
    # If no Schematic are found then you will be notified you have no Schematic.
    - '@IF i <itemid> = 0'
    - '@AND b <issneaking:> = true'
    - ' @DELVAR b $<worldname>.<playername>SchematicSelected'
    - ' @SUBINT $<worldname>.<playername>SchematicSelection 1'
    - ' @SETSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>ActivePlans'
    - ' @ADDSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>SchematicSelection'
    - ' @GETSTRLEN $<worldname>.<playername>SchematicSelectionCheck $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - ' @IF s $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> = purchased'
    - ' @OR s $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner = <playername>'
    - ' @AND i $<worldname>.<playername>SchematicSelectionCheck != 1'
    - '     @SETBOOL $<worldname>.<playername>SchematicSelected True'
    - '     @PLAYER Schematic Name: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Name Owner: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner Population: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Pop selected. Select your builder by click on him with a stick and then click on the construction yard ender portal frame with a shovel to give the builder this schematic.'
    - ' @ELSE'
    - '     @SETINT $<worldname>.<playername>SchematicSelectionStart $<worldname>.<playername>SchematicSelection'
    - '     @SUBINT $<worldname>.<playername>SchematicSelection 1'
    - '     @SETSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>ActivePlans'
    - '     @ADDSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>SchematicSelection'
    - '     @LOOP 720'
    - '         @IF s $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> = purchased'
    - '         @OR s $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner = <playername>'    
    - '         @OR i $<worldname>.<playername>SchematicSelection = $<worldname>.<playername>SchematicSelectionStart'     
    - '             @BREAKLOOP'
    - '         @ELSE'
    - '             @GETSTRLEN $<worldname>.<playername>SchematicSelectionCheck $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - '             @IF i $<worldname>.<playername>SchematicSelectionCheck = 1'
    - '                 @ADDINT $<worldname>.<playername>SchematicSelection 2'
    - '                 @GETSTRLEN $<worldname>.<playername>SchematicSelectionCheck $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner' 
    - '                 @WHILE i $<worldname>.<playername>SchematicSelectionCheck != 1'
    - '                     @ADDINT $<worldname>.<playername>SchematicSelection 1'
    - '                     @GETSTRLEN $<worldname>.<playername>SchematicSelectionCheck $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - '                 @ENDWHILE'
    - '                 @SUBINT $<worldname>.<playername>SchematicSelection 1'
    - '             @ELSE'
    - '                 @SUBINT $<worldname>.<playername>SchematicSelection 1'
    - '             @ENDIF'
    - '             @SETSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>ActivePlans'
    - '             @ADDSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>SchematicSelection'
    - '         @ENDIF'
    - '     @ENDLOOP'
    - '     @IF i $<worldname>.<playername>SchematicSelection = $<worldname>.<playername>SchematicSelectionStart'
    - '     @OR i $<worldname>.<playername>SchematicSelectionCheck = 1'
    - '         @PLAYER You have no schematics filed under $<worldname>.<playername>ActivePlans . To buy a schematic equip an emerald and click on this same button to begin browsing through the schematics you can purchase. Or make your own. Hint: Click with paper for more help.'
    - '     @ELSE'
    - '         @SETBOOL $<worldname>.<playername>SchematicSelected True'
    - '         @PLAYER Schematic Name: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Name Owner: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner Population: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Pop selected. 
    Using a STICK, select your BUILDER. Next use a SHOVEL on your CONSTRUCTION YARD to give him the schematic.'
    - '     @ENDIF'
    - ' @ENDIF'
    - '@ENDIF'
# Use Emerald to browse through schematics that you do not own to then purchase.
    # If you click with an emerald increment which Schematic you have selected.  You will only see Schematic you have purchased and if you hit the end of the Schematic it will loop back to the beginning. 
    # If no Schematic are found then you will be notified you have no Schematic.
    - '@IF i <itemid> = 388'
    - '@AND b <issneaking:> = false'
    - ' @DELVAR b $<worldname>.<playername>SchematicSelected'
    - ' @ADDINT $<worldname>.<playername>SchematicSelection 1'
    - ' @SETSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>ActivePlans'
    - ' @ADDSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>SchematicSelection'
    - ' @GETSTRLEN $<worldname>.<playername>SchematicSelectionCheck $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - ' @IF s $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> != purchased'
    - ' @AND i $<worldname>.<playername>SchematicSelectionCheck != 1'
    - '     @SETBOOL $<worldname>.<playername>SchematicSelected True'
    - '     @PLAYER Schematic Name: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Name Owner: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner Population: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Pop Price: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Price selected.'
    - ' @ELSE'
    - '     @SETINT $<worldname>.<playername>SchematicSelectionStart $<worldname>.<playername>SchematicSelection'
    - '     @ADDINT $<worldname>.<playername>SchematicSelection 1'
    - '     @SETSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>ActivePlans'
    - '     @ADDSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>SchematicSelection'
    - '     @LOOP 720'
    - '         @IF s $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> != purchased ' 
    - '         @OR i $<worldname>.<playername>SchematicSelection = $<worldname>.<playername>SchematicSelectionStart'     
    - '             @BREAKLOOP'
    - '         @ELSE'
    - '             @GETSTRLEN $<worldname>.<playername>SchematicSelectionCheck $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - '             @IF i $<worldname>.<playername>SchematicSelectionCheck = 1'
    - '                 @SETINT $<worldname>.<playername>SchematicSelection 0'
    - '             @ELSE'
    - '                 @ADDINT $<worldname>.<playername>SchematicSelection 1'
    - '             @ENDIF'
    - '             @SETSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>ActivePlans'
    - '             @ADDSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>SchematicSelection'
    - '         @ENDIF'
    - '     @ENDLOOP'
    - '     @IF i $<worldname>.<playername>SchematicSelection = $<worldname>.<playername>SchematicSelectionStart'
    - '         @PLAYER You have no schematics filed under $<worldname>.<playername>ActivePlans . To buy a schematic equip an emerald and click on this same button to begin browsing through the schematics you can purchase. Or make your own. Hint: Click with paper for more help.'
    - '     @ELSE'
    - '         @SETBOOL $<worldname>.<playername>SchematicSelected True'
    - '         @PLAYER Schematic Name: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Name Owner: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner Population: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Pop Price: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Price selected. Left click while holding a &4torch&r to warp and see an example of this schematic.'
    - '     @ENDIF'
    - ' @ENDIF'
    - '@ENDIF'
    # If you click with an emerald and you are sneaking (holding shift) pull the previous Schematic.  You will only see Schematic you have purchased and if you hit the beginning of the Schematic it will loop back to the end. 
    # If no Schematic are found then you will be notified you have no Schematic.
    - '@IF i <itemid> = 388'
    - '@AND b <issneaking:> = true'
    - ' @DELVAR b $<worldname>.<playername>SchematicSelected'
    - ' @SUBINT $<worldname>.<playername>SchematicSelection 1'
    - ' @SETSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>ActivePlans'
    - ' @ADDSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>SchematicSelection'
    - ' @GETSTRLEN $<worldname>.<playername>SchematicSelectionCheck $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - ' @IF s $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> != purchased'
    - ' @AND i $<worldname>.<playername>SchematicSelectionCheck != 1'
    - '     @SETBOOL $<worldname>.<playername>SchematicSelected True'
    - '     @PLAYER Schematic Name: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Name Owner: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner Population: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Pop Price: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Price selected.'
    - ' @ELSE'
    - '     @SETINT $<worldname>.<playername>SchematicSelectionStart $<worldname>.<playername>SchematicSelection'
    - '     @SUBINT $<worldname>.<playername>SchematicSelection 1'
    - '     @SETSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>ActivePlans'
    - '     @ADDSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>SchematicSelection'
    - '     @LOOP 720'
    - '         @IF s $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> != purchased ' 
    - '         @OR i $<worldname>.<playername>SchematicSelection = $<worldname>.<playername>SchematicSelectionStart'     
    - '             @BREAKLOOP'
    - '         @ELSE'
    - '             @GETSTRLEN $<worldname>.<playername>SchematicSelectionCheck $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - '             @IF i $<worldname>.<playername>SchematicSelectionCheck = 1'
    - '                 @ADDINT $<worldname>.<playername>SchematicSelection 2'
    - '                 @GETSTRLEN $<worldname>.<playername>SchematicSelectionCheck $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner' 
    - '                 @WHILE i $<worldname>.<playername>SchematicSelectionCheck != 1'
    - '                     @ADDINT $<worldname>.<playername>SchematicSelection 1'
    - '                     @GETSTRLEN $<worldname>.<playername>SchematicSelectionCheck $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - '                 @ENDWHILE'
    - '                 @SUBINT $<worldname>.<playername>SchematicSelection 1'
    - '             @ELSE'
    - '                 @SUBINT $<worldname>.<playername>SchematicSelection 1'
    - '             @ENDIF'
    - '             @SETSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>ActivePlans'
    - '             @ADDSTR $<worldname>.<playername>SchematicSelectionStr $<worldname>.<playername>SchematicSelection'
    - '         @ENDIF'
    - '     @ENDLOOP'
    - '     @IF i $<worldname>.<playername>SchematicSelection = $<worldname>.<playername>SchematicSelectionStart'
    - '         @PLAYER You have no schematics filed under $<worldname>.<playername>ActivePlans . To buy a schematic equip an emerald and click on this same button to begin browsing through the schematics you can purchase. Or make your own. Hint: Click with paper for more help.'
    - '     @ELSE'
    - '         @SETBOOL $<worldname>.<playername>SchematicSelected True'
    - '         @PLAYER Schematic Name: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Name Owner: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner Population: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Pop Price: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Price selected. Left click while holding a &4torch&r to warp and see an example of this schematic.'
    - '     @ENDIF'
    - ' @ENDIF'
    - '@ENDIF'
# USE Torch To teleport to schematic example to buy or just investigate.
    - '@IF i <itemid> = 50'
#    - ' @IF i <itemid> = 351'    
    - '@AND b $<worldname>.<playername>SchematicSelected = true'
    - ' @SETBOOL $<worldname>.<playername>SchematicSelected false'
    - ' @CMDOP setwarp <playername>SurvivalBindPoint'
    - ' @PLAYER Warping you to Schematic
    Category: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Category 
    Name: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Name
    Owner: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - ' @SETSTR $<worldname>.<playername>WarpWorldTMP $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - ' @ADDSTR $<worldname>.<playername>WarpWorldTMP Creative'
    - ' @CMDCON mv load $<worldname>.<playername>WarpWorldTMP'
    - ' @SOUNDEX PORTAL_TRIGGER 1.0 0.5 <currentloc:<playername>>'
    - ' @PAUSE 5'
    - ' @CMDOP warp Schematic<var:$<worldname>.<playername>SchematicSelectionStr>'
    - ' @PAUSE 5'
    - ' @CMDOP njs fly'
    - ' @PLAYER Type &4/mi fly&r to get the ability to fly and explore at ease. This will also provide you with 1 emerald and paper if you do not already have one.'
    - ' @SETSTR $<worldname>.<playername>LastWorldTeleportedTo $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - ' @ADDSTR $<worldname>.<playername>LastWorldTeleportedTo Creative'
    - ' @IF s $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> = purchased'
    - '     @PLAYER When you are done investigating type &4/mi warp&r to warp back to your Construction Yard'
    - ' @ENDIF'
    - ' @IF s $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> != purchased'
    - '     @PLAYER You can use paper on the block for more information on how to purchase this schematic.
    Once your are done investigating and purchasing type &4/mi warp&r to warp back to your Construction Yard'
    - ' @ENDIF'
    - ' @DELVAR s $<worldname>.<playername>WarpWorldTMP'
    - '@ENDIF'
# USE A SHOVEL TO GIVE SCHEMATIC TO BUILDER.
# Commented out untill I find a solution to not having builder select when selecting causing you to be stuck.    - '@IF b $<worldname>.<playername>SchematicLoaded != true'
    - ' @IF i <itemid> = 269'
    - ' @OR i <itemid> = 256'
    - ' @OR i <itemid> = 273'
    - ' @OR i <itemid> = 277'
    - ' @OR i <itemid> = 284'
# Line can be removed after Selection system only selects purchased schematics.
#    - '@AND s $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicSelectionStr> = purchased'
### CHANGE SCRIPT TO USE DISTANCE DEPENDING ON TERRITORY OWNED TO PREVENT PEOPLE TO BUILD OUTSIDE OF TERRITORY AND ALSO SEE IF WE CAN GET RID OF COMMAND
# AND USE SHIFT INSTEAD!!! OR USE TOWNY PERMISSIONS AND REMOVE PERMISSION TO EDIT OR USE ANYTHING IN THE WILD AND OTHER TOWNS WHILE IN THIS MODE.
    - '     @PLAYER You hand over a shovel and the following schematic and tell your builder to get to work!'
    - '     @PLAYER Category: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Category'
    - '     @SETSTR $<worldname>.<playername>CurProjCategoryTMP $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Category'
    - '     @PLAYER Name: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Name'
#    - '     @SETSTR $<worldname>.<playername>CurProjNameTMP $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Name'
    - '     @PLAYER Owner: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
#    - '     @SETSTR $<worldname>.<playername>CurProjOwnerTMP $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Owner'
    - '     @PLAYER Population: $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Pop'
    - '     @SETINT $<worldname>.<playername>CurProjPopTMP $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Pop'
    - '     @PLAYER In Town: $<worldname>.<playername>CurrentTown'
    - '     @SETSTR $<worldname>.<playername>CurProjTownTMP $<worldname>.<playername>CurrentTown'
    - '     @PLAYER Type &4/mi help ConstructionYard Schematic&r for what to do next.'
#    Now move to where you want to build $Schematic.<var:$<worldname>.<playername>SchematicSelectionStr>Name and break gound using a wooden shovel. 
#    This will designate the location for Bob the Builder to start building. Please note that it must be in territory you own. He will begin by placing blocks at the four corners of where the structure will be built. 
#    You can then use the wooden shovel again to reposition. You can also type &4/mi schematic rotate 90&r to rotate it 90 degrees. You can change 90 to 180 or 270 to get different rotations. Once you are happy type &4/mi schematic build&r to begin construction.'
    - '     @CMDOP builder load $<worldname>.<playername>SchematicSelectionStr'
    - '     @SETBOOL $<worldname>.<playername>SchematicLoaded true'
#    - ' @CMDOP pex user <playername> group add ConstructionYard'
    - ' @ENDIF'
# SEE ABOVE Under USE SHOVEL Comment.    - '@ENDIF'
# LAST TEST FAILED AT LEDGER!!! FIND OUT WHATs WRONG!    
  Ledger:
    Script:
# Use a paper for help
#    - '@IF i <itemid> = 339'
#    - ' @CALL ConstructionYard:Help'
#    - '@ENDIF'
# Use torch to start ledger stage
    - '@IF s $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage = Ledger'
#    - ' @IF i <itemid> = 351'
    - ' @IF i <itemid> != 288'
    - ' @OR i <itemid> != 388'
    - ' @OR i <itemid> != 383'
    - ' @OR i <itemid> != 339'
    - ' @OR i <itemid> != 386'
#    - ' @IF i <itemid> = 50'
    - ' @OR s $<worldname>.<playername>ActivePlans = ConstructionYard'
    - '     @SETSTR $<worldname>.<playername>NextScript ConstructionYard:Ledger'
    - '     @IF s $<worldname>.<playername>ActivePlans != ConstructionYard'
    - '         @PLAYER Now it is time to give your building a good name. &4Replace NameOfBuilding&r (no spaces allowed) with a building name 
    of your choosing for this $<worldname>.<playername>ActivePlans. Type the following command and you will automatically move to the next step.
    &4/mi schematic ledger (NameOfBuilding)&r.'
    - '         @WHILE b $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>LedgerCommand != true'
    - '             @PAUSE 2'
    - '         @ENDWHILE'
    - '         @PLAYER Step Done.'
    - '     @ENDIF'
#    - '     @PLAYER Your next step will be to use a bone to place powers on the ender portal frame. 
#    This will give the powers to the ender portal frame so you can use the $<worldname>.<playername>ActivePlans
#    Remember to bow for 2 seconds or more when you are ready to place the first power and second in the same place.
#    Note you will not be able to go to the next step until you have typed the command above correctly.'
#    - '     @CALL Shared:BowCheck'
    - ' @ENDIF'
    - ' @PAUSE 3'
    - ' @IF b $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>LedgerCommand = true'
#    - '@OR b $<worldname>.<playername>Settled = False'
    - '     @SETSTR $<worldname>.<playername>PublishLedger $<worldname>.<playername>CurProjCategoryTMP'
    - '     @ADDINT $Building.ID 1'
    - '     @SETINT $<worldname>.<playername>BuildingID $Building.ID'
    - '     @ADDINT $<var:$<worldname>.<playername>ActivePlans>.LedgerID 1'
    - '     @ADDSTR $<worldname>.<playername>PublishLedger $<var:$<worldname>.<playername>CurProjCategoryTMP>.LedgerID'
    - '     @SETSTR $Ledger.<var:$<worldname>.<playername>PublishLedger>Category $<worldname>.<playername>CurProjCategoryTMP'
    - '     @SETSTR $Ledger.<var:$<worldname>.<playername>PublishLedger>Town $<worldname>.<playername>CurProjTownTMP'
    - '     @SETSTR $Ledger.<var:$<worldname>.<playername>PublishLedger>Owner <playername>'
#    - ' @SETINT $Ledger.<var:$<worldname>.<playername>PublishLedger>Price $<worldname>.<playername>LedgerPriceSelection'
    - '     @SETSTR $Ledger.<var:$<worldname>.<playername>PublishLedger>Name $<worldname>.<playername>NameTMP'
    - '     @SETINT $Ledger.<var:$<worldname>.<playername>PublishLedger>Pop $<worldname>.<playername>CurProjPopTMP'
    - '     @DELVAR s $<worldname>.<playername>NameTMP'
    - '     @DELVAR b $<worldname>.<playername>SchematicLoaded'
    - '     @DELVAR s $<worldname>.<playername>CurProjCategoryTMP'
    - '     @DELVAR s $<worldname>.<playername>CurProjTownTMP'
    - '     @DELVAR i $<worldname>.<playername>CurProjPopTMP'
    - '     @PLAYER You document the following into your ledger.
    ID: $<worldname>.<playername>PublishLedger 
    Category: $Ledger.<var:$<worldname>.<playername>PublishLedger>Category 
    Owner: $Ledger.<var:$<worldname>.<playername>PublishLedger>Owner
    Name: $Ledger.<var:$<worldname>.<playername>PublishLedger>Name
    Holds Population of: $Ledger.<var:$<worldname>.<playername>PublishLedger>Pop'
    - '     @CALL Shared:BowCheck'
#    - '     @PLAYER Each time a power is ready to be placed you will see the following text
#    &8Now right click a block with the wand(bone) to set trigger(power) or add to an existing trigger.&r This means the bone has been primed and is ready
#    for you to right click an ender portal frame block. The next step with prime the bone.'
#    - '     @CALL Shared:BowCheck'
#    - '     @PLAYER Now equip the bone you were given and place the first power(trigger) on the ender portal frame. This will designate you as the owner.
#    After you place the script hold shift to move to the next step.'
#    - '     @PAUSE 3'
    - '     @IF i $Ledger.<var:$<worldname>.<playername>CurrentBuildingID>Upkeep != 0'
    - '         @SUBINT $Ledger.<var:$<worldname>.<playername>CurrentBuildingID>Upkeep 1'
    - '     @ENDIF'
#    - '     @PLAYER Your $<worldname>.<playername>ActivePlans ender portal frame is now ready to be activated. It will need to consume two ender eyes (that will be provided for you) before it is fully activated.'
#    - '     @SETSTR $<worldname>.<playername>PlaceScriptTMP vtclick @SETSTR $Placeholder.Ledger <var:$<worldname>.<playername>PublishLedger>'    
#    - '     @CALL Shared:PlaceScript'
    - '     @SETSTR $<worldname>.<playername>NextScriptText Your <var:$<worldname>.<playername>ActivePlans> ender portal frame is now ready to be activated. It will need to consume two ender eyes (that will be provided for you) before it is fully activated.'
    - '     @SETSTR $<worldname>.<playername>NextScript ConstructionYard:Ledger1'
    - '     @CALL Shared:NextStep'
    - ' @ENDIF'
    - '@ENDIF'
  Ledger1:
    Script:
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp'
    - '@DELVAR b $<worldname>.<playername>LOSCheckTmp'
    - '@DELVAR s $<worldname>.<playername>LOSLocTmp'
    - '@DELVAR s $<worldname>.<playername>BlockTypeTMP'
    - '@EXPLOSION 0.0 <currentloc:<playername>>'
    - '@FLAMES 3 <currentloc:<playername>>'
    - '@POOF 3 <currentloc:<playername>>' 
    - '@IF i <giveitem:<playername>:381:1> = 1'
    - ' @PLAYER &4An Enchanted Eye of Ender appears in your inventory.&r'
    - '@ENDIF'
    - '@WHILE i <hasitem:<playername>:381> = 0'
    - ' @IF i <hasitem:<playername>:381> = 0'
    - '     @PLAYER &4Your Inventory is full please make room.'
    - ' @ENDIF'
    - ' @PAUSE 5'
    - ' @ADDINT $<worldname>.<playername>WhileCheckTimeLimitTmp 5'
    - ' @IF i $<worldname>.<playername>WhileCheckTimeLimitTmp >= 300'
    - '     @PLAYER &4You took to long.&r Your time limit was 5 minutes. Contact an admin if you think this was due to bug or if you want to try to place the script again.'
    - '     @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '     @EXIT'
    - ' @ENDIF'
    - '@ENDWHILE'
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '@PLAYER Now &4look at&r the empty ender portal frame while having the &4An Enchanted Eye of Ender&r in your hands and slowly walk up to it and right click on it.'
    - '@WHILE b $<worldname>.<playername>LOSCheckTmp != True'
    - ' @ADDINT $<worldname>.<playername>WhileCheckTimeLimitTmp 1'
#    - ' @PLAYER &8LOG Current Item Holding <itemid> &r'
# New Wand item Eye of Ender 381 Check.
#    - ' @IF i <itemid> = 381'
    # Check if looking at end portal frame without an eye.
#    - '     @PLAYER &8LOG Current Block Looking at within 3 sqrs <getblocklos:TYPE:3> &r'
    - '     @IF s <getblocklos:TYPE:3> = 120:0'
    - '     @OR s <getblocklos:TYPE:3> = 120:1'
    - '     @OR s <getblocklos:TYPE:3> = 120:2'
    - '     @OR s <getblocklos:TYPE:3> = 120:3'
#    - '         @LIGHTNING false <playerloc>'
    - '         @SOUNDEX ENDERMAN_STARE 1.0 2.0 <currentloc:<playername>>'
            #Place script you want them to be able to place right here.
    - '         @CMDOP vtclick @SETSTR $Placeholder.Ledger $<worldname>.<playername>PublishLedger'
    - '         @PLAYER The &4Eye of Ender&r is now ready to be &4joined&r with the &4empty end portal frame&r. In order for it to by joined correctly you must &4DOUBLE RIGHT CLICK&r with the eye on the portal frame.'
    - '         @SETBOOL $<worldname>.<playername>LOSCheckTmp True'
    - '     @ELSE'
    - '         @IF i $<worldname>.<playername>WhileCheckTimeLimitTmp >= 150'
#    - '             @CMDOP vtclickview'
    - '             @SETINT $<worldname>.<playername>WhileCheckTimeLimitTmp 0'
    - '             @ADDINT $<worldname>.<playername>WhileCheckTimeLimitTotalTmp 150'
    - '             @PLAYER You must be &4looking&r at an &4end portal frame&r that is not filled in with an &4eye&r while being at most &4 3 squares away&r.'
    - '             @PLAYER &8Log Current block looking at LOC <getblocklos:LOC:100> and ID <getblocklos:TYPE:100> &r'
    - '         @ENDIF'
    - '     @ENDIF'
    - '     @IF i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp >= 1500'
    - '     @AND b $<worldname>.<playername>LOSCheckTmp != True'
    - '         @PLAYER &4You took to long.&r Your time limit was 5 minutes. Contact an admin if you think this was due to bug or if you want to try to place the script again.'
    - '         @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '         @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp'
    - '         @EXIT'
    - '     @ENDIF'
#    - ' @ENDIF'
    - ' @SETSTR $<worldname>.<playername>BlockTypeTMP <getblocklos:TYPE:3>'
    - ' @PAUSE 0.2'
    - '@ENDWHILE'
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp'
    - '@DELVAR b $<worldname>.<playername>LOSCheckTmp'
    - '@WHILE b $<worldname>.<playername>LOSCheckTmp != True'
    - ' @ADDINT $<worldname>.<playername>WhileCheckTimeLimitTmp 1'
        # Make sure end portal frame now has an eye from player placing script.
    - ' @IF s <getblocklos:TYPE:3> = 120:4'
    - ' @OR s <getblocklos:TYPE:3> = 120:5'
    - ' @OR s <getblocklos:TYPE:3> = 120:6'
    - ' @OR s <getblocklos:TYPE:3> = 120:7'
    - ' @OR s <getblocklos:TYPE:3> = 120:8'
    - ' @OR s $<worldname>.<playername>BlockTypeTMP = 120:4'
    - ' @OR s $<worldname>.<playername>BlockTypeTMP = 120:5'
    - ' @OR s $<worldname>.<playername>BlockTypeTMP = 120:6'
    - ' @OR s $<worldname>.<playername>BlockTypeTMP = 120:7'
    - ' @OR s $<worldname>.<playername>BlockTypeTMP = 120:8'
    - '     @SETSTR $<worldname>.<playername>LOSLocTmp <getblocklos:LOC:3>'
#    - '     @PAUSE 2'
    - '     @SETBOOL $<worldname>.<playername>LOSCheckTmp True'
    - '     @LIGHTNING false $<worldname>.<playername>LOSLocTmp'
    - '     @SETBLOCK 120:0 $<worldname>.<playername>LOSLocTmp'
    - '     @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '     @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp'
    - '     @DELVAR b $<worldname>.<playername>LOSCheckTmp'
    - '     @DELVAR s $<worldname>.<playername>LOSLocTmp'
    - '     @DELVAR b $<worldname>.<playername>StartOverTmp'
    - '     @DELVAR s $<worldname>.<playername>BlockTypeTMP'
    - '     @PLAYER &4The ender portal frame consumes the eye and gains power.&r'
    - '     @DELVAR s $<worldname>.<playername>PlaceScriptTMP'
    - '     @SETSTR $<worldname>.<playername>NextScriptText You will now go through the same steps again in order to place a second ender eye to complete the activation of your <var:$<worldname>.<playername>ActivePlans>.'
    - '     @SETSTR $<worldname>.<playername>NextScript ConstructionYard:Ledger2'
    - '     @CALL Shared:NextStep'
    - '     @EXIT'
    - ' @ELSE'
    - '     @IF i $<worldname>.<playername>WhileCheckTimeLimitTmp >= 150'
    - '         @SETINT $<worldname>.<playername>WhileCheckTimeLimitTmp 0'
    - '         @ADDINT $<worldname>.<playername>WhileCheckTimeLimitTotalTmp 150'
    - '         @PLAYER &4DOUBLE Right Click on the Ender Portal Frame with the Eye of Ender&r'
    - '         @PLAYER &8Log Current block looking at LOC <getblocklos:LOC:100> and ID <getblocklos:TYPE:100> &r'
    - '     @ENDIF'
    - '     @IF s <getblocklos:TYPE:3> != 120:0'
    - '     @AND s <getblocklos:TYPE:3> != 120:1'
    - '     @AND s <getblocklos:TYPE:3> != 120:2'
    - '     @AND s <getblocklos:TYPE:3> != 120:3'
    - '     @AND s <getblocklos:TYPE:3> != 120:4'
    - '     @AND s <getblocklos:TYPE:3> != 120:5'
    - '     @AND s <getblocklos:TYPE:3> != 120:6'
    - '     @AND s <getblocklos:TYPE:3> != 120:7'
    - '     @AND s <getblocklos:TYPE:3> != 120:8'
    - '         @CMDOP vtclickview'
    - '         @PLAYER &4You FAILED to place the Eye of Ender on the Ender Portal Frame while it was still enchanted. 
    Once it it enchanted you must not look away from the ender portal frame or it will lose its charge. STARTING OVER PLEASE WAIT&r'
    - '         @IF b <takeitem:<playername>:381:1> = True'
    - '             @PLAYER &8LOG Eye of Ender Taken&r'
    - '         @ENDIF'
    - '         @SETBOOL $<worldname>.<playername>StartOverTmp True'
    - '         @SETBOOL $<worldname>.<playername>LOSCheckTmp True'
    - '     @ENDIF'
    - ' @ENDIF'
    - ' @IF i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp >= 1500'
    - ' @AND b $<worldname>.<playername>LOSCheckTmp != True'
    - '     @PLAYER &4You took to long.&r Your time limit was 5 minutes. Contact an admin if you think this was due to bug or if you want to try to place the script again.'
    - '     @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '     @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp'
    - '     @EXIT'
    - ' @ENDIF'
    - ' @PAUSE 0.2'
    - '@ENDWHILE'
    - '@DELVAR b $<worldname>.<playername>LOSCheckTmp'
# This is the retry if the player fails to look at the ender portal frame while the eye is charged.    
    - '@IF b $<worldname>.<playername>StartOverTmp = True'
    - ' @CMDOP vtclickview'
    - ' @PAUSE 7'
    - ' @PLAYER &4Ignore the text that just appears above and this time get it right! Remember to read the directions!&r'
    - ' @PAUSE 5'
    - ' @DELVAR b $<worldname>.<playername>StartOverTmp'
    - ' @CALL ConstructionYard:Ledger1'
    - '@ENDIF'
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp'
    - '@DELVAR b $<worldname>.<playername>LOSCheckTmp'
    - '@DELVAR s $<worldname>.<playername>LOSLocTmp'
    - '@DELVAR b $<worldname>.<playername>StartOverTmp'
    - '@DELVAR s $<worldname>.<playername>BlockTypeTMP'
  Ledger2:
    Script:
    - '     @SETSTR $<worldname>.<playername>PlaceScriptTMP vtclick @CALL <var:$<worldname>.<playername>ActivePlans>:Power'    
    - '     @CALL Shared:PlaceScript'
    - '     @DELVAR s $<worldname>.<playername>PlaceScriptTMP'
    - '@SETSTR $Building.<var:$<worldname>.<playername>BuildingID>Loc <currentloc:<playername>>'
    - '     @SETSTR $<worldname>.<playername>NextScriptText Now move to where you would like 
    people and yourself to spawn when quick traveling to this specific building 
    (not your town just this building) through routes or other means.
    Remember all portions of the location will be saved including where you look. 
    Once you are standing and looking exactly as you want them to when they spawn 
    then move to the next step by typing &4/mi next&r and it will bind the location 
    where you standing as your <var:$<worldname>.<playername>ActivePlans> spawn point.'
    - '     @SETSTR $<worldname>.<playername>NextScript ConstructionYard:Ledger3'
    - '     @CALL Shared:NextStep'    
  Ledger3:
    Script:
    - '@CMDOP setwarp Ledger<var:$<worldname>.<playername>PublishLedger>'
    - '@PLAYER &4Step done and location bound.&r'  
    - '@PAUSE 2'
    - '@DELVAR s $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage'
    - '@DELVAR b $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>LedgerCommand'
    - '@DELVAR s $<worldname>.<playername>NextScript'
    - '@PLAYER Now you can &4click on the ender portal frame with wheat&r to activate your building and supply it with the neccessary resources for operation this is called its upkeep.
    Certain powers of each building will pull from your upkeep when activated. Make sure to always keep your buildings well supplied otherwise all
    their powers will fail. Note that a building with no upkeep left will have an ender portal frame with no eye.'
    - '@CALL Shared:BowCheck'
    - '@PLAYER &4IMPORTANT REMINDER&r that at any time you can click on any powered block while 
    having paper equipped to pull up the help for that building. 
    This will also tell you the items needed for the upkeep cost.'
    - '@CALL Shared:BowCheck'
    - '@PLAYER You can also type &4/mi help $<worldname>.<playername>ActivePlans .&r 
    Congrats you have finished your project and it should now be ready to use.'
    - '@PAUSE 5'
    - '@IF s $<worldname>.<playername>ActivePlans = ConstructionYard'
#    - ' @SETSTR $<worldname>.<playername>NextScript ConstructionYard:Settle2'
    - ' @PLAYER Now that you have finished creating your ConstructionYard you can move to the 
    final optional steps of creating a new settlement. 
    Simply type &4/mi help ConstructionYard TownCopy&r and &4/mi help ConstructionYard TownBorders&r
    to pull up mini tutorials on how to copy your town borders and how to create visual borders of
    plots to claim to expand your land. Once you finish running though both of those your new 
    settlement should be all set to expand and add buildings to.'
    - ' @CALL Shared:BowCheck'
    - ' @PLAYER Remember if you do not own any technologies yet you can discover more by paying emeralds
    for them. This can be done at a public or personal library. To reach the public library type &4/mi warp library&r.'
    - '@ENDIF'
#    - '     @SETSTR $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans> Activate'
#    - ' @ENDIF'
#    - '@ENDIF'
  TownCopyStarted:
    Script:
## NEW TOWN COPY JUST STARTED will be command and world edit based and will take away upkeep. NOTE idea will be to break block inside town borders with ink to start process
    - '@CMDOP pex user <playername> group add ConstructionYard'
    - '@SETBOOL $<worldname>.<playername>TownCopyStarted True'
#    - ' @SUBINT $Ledger.<var:$<worldname>.<playername>CurrentBuildingID>Upkeep 1'
    - '@PLAYER &4Town Copy Mode Turned On&r'
    - '@PLAYER Type &4/mi help ConstructionYard TownCopy&r for more information on how town copy works.'
  TownCopy:
    Script:
    - '@CMDOP pex user <playername> group remove ConstructionYard'
    - '@DELVAR b $<worldname>.<playername>TownCopyStarted'
    - '@CMDOP pex user <playername> group add TownCopy'
#Run distance check script.
    - '@SETSTR $<worldname>.<playername>CurrentLocation <currentloc:<playername>>'
    - '@SETSTR $<worldname>.<playername>DistanceStartLoc $<worldname>.<playername>CurrentLocation'
    - '@SETINT $<worldname>.<playername>DistanceCheckLimit 16'
    - '@SETINT $<worldname>.<playername>DistanceCheckOOBTimeLimit 4'
    - '@PLAYER Location Set. Type &4/mi help ConstructionYard TownCopy&r for a list of commands you can use within 16 blocks of this location.'
    - '@CALL Shared:DistanceCheck'
#Use this command to deny town copy.
    - '@CMDOP pex user <playername> group remove TownCopy'
    - '@PLAYER &4Town Copy Mode Turned Off&r'
  TownCopyStop:
    Script:
    - '@CMDOP pex user <playername> group remove ConstructionYard'
    - '@DELVAR b $<worldname>.<playername>TownCopyStarted'
    - '@PLAYER You are no longer in town copy mode.'
  Publish:
    Script: 
#   THIS SCRIPT NEEDS SOME WORK. 1) Lets them select the cords themselves with a wooden axe. 2)
    - '@IF i <cmdargcount> = 4'
    - ' @PLAYER Starting the publishing of a new schematic'
    - ' @SETSTR $<worldname>.<playername>SchematicNameSelection <cmdarg:3>'
    - ' @GETSTRLEN $<playername>TMP.SelectionCheck $<worldname>.<playername>SchematicNameSelection'
    - ' @PLAYER &8Log SchematicName StrLen Check $<playername>TMP.SelectionCheck &r'
    - ' @IF i $<playername>TMP.SelectionCheck >= 2'
    - '     @SETINT $<worldname>.<playername>SchematicPriceSelection <cmdarg:4>'
    - '     @PLAYER Started the publishing of a new schematic with the following information'
    - '     @PLAYER Category: $<worldname>.<playername>ActivePlans'
    - '     @PLAYER Name: $<worldname>.<playername>SchematicNameSelection' 
    - '     @PLAYER Price: $<worldname>.<playername>SchematicPriceSelection'
    - '     @SETSTR $<worldname>.<playername>NextScript ConstructionYard:Publish1'
    - '     @SETSTR $<worldname>.<playername>NextScriptText Started the publishing of a new schematic with the following information Category: <var:$<worldname>.<playername>ActivePlans> Name: <var:$<worldname>.<playername>SchematicNameSelection> Price: <var:$<worldname>.<playername>SchematicPriceSelection>'
    - '     @CALL Shared:NextStep'
    - '     @PAUSE 5'
    - ' @ELSE'
    - '     @PLAYER Your schematics name does not follow proper naming conventions. Please use letters and numbers only with no spaces. Undersocres _ are allowed.
    Please retry the command now. Remember type &4/mi schematic publish (NameOfSchematic) (PriceOfSchematic) (HoldsPopulationOf)&r.'
    - ' @ENDIF'
#    - '@ELSE'
#    - ' @PLAYER You forgot to specify the NameofSchematic and PriceofSchematic. Example: /mi schematic publish ExampleNameOneWord 50'
    - '@ENDIF'
    - '@IF i <cmdargcount> = 5'
    - ' @PLAYER Starting the publishing of a new schematic'
    - ' @SETSTR $<worldname>.<playername>SchematicNameSelection <cmdarg:3>'
    - ' @GETSTRLEN $<playername>TMP.SelectionCheck $<worldname>.<playername>SchematicNameSelection'
    - ' @PLAYER &8Log SchematicName StrLen Check $<playername>TMP.SelectionCheck &r'
    - ' @IF i $<playername>TMP.SelectionCheck >= 2'
    - '     @SETINT $<worldname>.<playername>SchematicPriceSelection <cmdarg:4>'
    - '     @SETINT $<worldname>.<playername>SchematicPopSelection <cmdarg:5>'
    - '     @PLAYER Started the publishing of a new schematic with the following information'
    - '     @PLAYER Category: $<worldname>.<playername>ActivePlans'
    - '     @PLAYER Name: $<worldname>.<playername>SchematicNameSelection' 
    - '     @PLAYER Price: $<worldname>.<playername>SchematicPriceSelection'
    - '     @PLAYER Holds Population: $<worldname>.<playername>SchematicPopSelection'
    - '     @SETSTR $<worldname>.<playername>NextScript ConstructionYard:Publish1'
    - '     @SETSTR $<worldname>.<playername>NextScriptText Started the publishing of a new schematic with the following information Category: <var:$<worldname>.<playername>ActivePlans> Name: <var:$<worldname>.<playername>SchematicNameSelection> Price: <var:$<worldname>.<playername>SchematicPriceSelection> Holds Population: <var:$<worldname>.<playername>SchematicPopSelection>'
    - '     @CALL Shared:NextStep'
    - '     @PAUSE 5'
    - ' @ELSE'
    - '     @PLAYER Your schematics name does not follow proper naming conventions. Please use letters and numbers only with no spaces. Undersocres _ are allowed.
    Please retry the command now. Remember type &4/mi schematic publish (NameOfSchematic) (PriceOfSchematic) (HoldsPopuationOf)&r.'
    - ' @ENDIF'
#    - '@ELSE'
#    - ' @PLAYER You forgot to specify the NameofSchematic and PriceofSchematic. Example: /mi schematic publish ExampleNameOneWord 50'
    - '@ENDIF'
  Publish1:
    Script:
  # Add this back in once I add this feature to the game. Tutorial enabled.  
  #  - '@IF b $<worldname>.<playername>CommandHelp = true'
    - '@PLAYER You begin the process of publishing your schematic. Note that steps 1 through 4 can be done at anytime and any order.
    Step 1 of 5: The mod that we will use to save this schematic is called WorldEdit. http://wiki.sk89q.com/wiki/WorldEdit . You will now select the area in which your creation was built to be copied into the schematic.
    To do this you will equip a wooden axe and left click on the top left corner of your creation that is furthest from you. If the top left corner is air then add blocks. After you select the top left, remove the blocks you added and move to the next step.'
    - '@CALL Shared:BowCheck'
    - '@PLAYER Step Done.'
    - '@PAUSE 1'
    - '@PLAYER Step 2 of 5: Now right click on the bottom right corner of your creation that is closest to you, then move to the next step. (Do not forget to include in your selection your lowest floor.)'
    - '@CALL Shared:BowCheck'
    - '@PLAYER Step Done.'
    - '@PAUSE 2'
    - '@PLAYER Step 3 of 5: You can now type &4//copy&r to copy the blocks you have just selected. Note that it will copy from the location you are standing. Move to another location with no buildings and type &4//paste&r.
    Make sure you have copied your entire structure, if you did not then repeat steps 1 through 3 until you have the entire selection before moving to step 4. Type &4//undo&r to remove what you have just pasted.
    Please take note that this process can be done anytime even before you publish a schematic to assist you in building.'
    - '@CALL Shared:BowCheck'
    - '@PLAYER Step Done.'
    - '@PAUSE 2'
    - '@PLAYER Step 4 of 5: Now walk to where you would like the power for the building to be placed and equip an ender portal frame and place it. 
    Please note you must not be flying, must be inside the area you have selected, and in a safe place when placing the ender portal frame.
    Once you place it move to the next step. Remeber that it should be easy to find and see this enderportal frame as it will be where every power the building gives will be accesible from.'
    - '@CALL <var:$<worldname>.<playername>ActivePlans>:HelpEndPortalFrame'
    - '@CALL Shared:BowCheck'
    - '@DELVAR s $<worldname>.<playername>BlockPlacedScript'
    - '@PLAYER Step Done.'
    - '@PAUSE 1'
    - '@PLAYER Step 5 of 5: Review and publish the schematic.
    Category: $<worldname>.<playername>ActivePlans
    Name: $<worldname>.<playername>SchematicNameSelection
    Price: $<worldname>.<playername>SchematicPriceSelection
    Population: $<worldname>.<playername>SchematicPopSelection
    Owner: <playername>'
  #  - '@ENDIF'
    - '@PLAYER Distribution:'
    - '@PAUSE 5'
    - '@CMDOP /distr'
    - '@PAUSE 5'
#    - '@PLAYER When you are ready to finish publishing this schematic stand at the entrance of your building facing it and level with it. This must be outside the selected copy area!
#    Then hold shift for 2 seconds to publish or type &4/mi trash&r and hit enter to cancel the publishing process. Please stand still until you are notified that the published process has been completed.'
    - '@SETSTR $<worldname>.<playername>NextScript ConstructionYard:Publish2'
    - '@SETSTR $<worldname>.<playername>NextScriptText When you are ready to finish publishing this schematic stand at the entrance of your building facing it and level with it. This must be outside the selected copy area!
    Then type &4/mi next&r to publish this schematic or type &4/mi cancel&r and hit enter to cancel the publishing process. Please stand still until you are notified that the published process has been completed.'
    - '@CALL Shared:NextStep'
  Publish2:
    Script:
    - '@IF b $<worldname>.<playername>CommandCanceled = true'
    - ' @PLAYER Publishing canceled'
    - ' @DELVAR b $<worldname>.<playername>CommandCanceled'
    - ' @EXIT'
    - '@ENDIF'
    - '@SETSTR $<worldname>.<playername>PublishSchematic $<worldname>.<playername>ActivePlans'
    - '@ADDINT $<var:$<worldname>.<playername>ActivePlans>.SchematicID 1'
    - '@ADDSTR $<worldname>.<playername>PublishSchematic $<var:$<worldname>.<playername>ActivePlans>.SchematicID'
    - '@CMDOP /copy'
    - '@CMDOP /schematic save $<worldname>.<playername>PublishSchematic'
    - '@PAUSE 2'
    - '@CMDOP /rotate 90'
    - '@PAUSE 1'
    - '@SETSTR $<worldname>.<playername>TMPstr <var:$<worldname>.<playername>PublishSchematic>rt90'
    - '@CMDOP /schematic save $<worldname>.<playername>TMPstr'
    - '@PAUSE 2'
    - '@CMDOP /rotate 90'
    - '@PAUSE 1'
    - '@SETSTR $<worldname>.<playername>TMPstr <var:$<worldname>.<playername>PublishSchematic>rt180'
    - '@CMDOP /schematic save $<worldname>.<playername>TMPstr'
    - '@PAUSE 2'
    - '@CMDOP /rotate 90'
    - '@PAUSE 1'
    - '@SETSTR $<worldname>.<playername>TMPstr <var:$<worldname>.<playername>PublishSchematic>rt270'
    - '@CMDOP /schematic save $<worldname>.<playername>TMPstr'
    - '@DELVAR s $<worldname>.<playername>TMPstr'
    - '@SETSTR $Schematic.<var:$<worldname>.<playername>PublishSchematic>Category $<worldname>.<playername>ActivePlans'
    - '@SETSTR $Schematic.<var:$<worldname>.<playername>PublishSchematic>Owner <playername>'
    - '@SETINT $Schematic.<var:$<worldname>.<playername>PublishSchematic>Price $<worldname>.<playername>SchematicPriceSelection'
    - '@SETINT $Schematic.<var:$<worldname>.<playername>PublishSchematic>Pop $<worldname>.<playername>SchematicPopSelection'
    - '@SETSTR $Schematic.<var:$<worldname>.<playername>PublishSchematic>Name $<worldname>.<playername>SchematicNameSelection'
    - '@SETSTR $<worldname>.<playername><var:$<worldname>.<playername>PublishSchematic> purchased'
#    - '@PLAYER Schematic has been published. Now starting setup for selling schematic.'
#    - ' @CMDOP vtrigger setloc <playername> CurrentLocation'
#    - '@PAUSE 1'
    - '@SETSTR $<worldname>.<playername>NextScript ConstructionYard:Publish3'
    - '@SETSTR $<worldname>.<playername>NextScriptText &4The schematic has been published. Now move to where you want other players to be able to buy this schematic and move to the next step.'
    - '@CALL Shared:NextStep'
#    - '@CALL ConstructionYard:Sell'
#    - '@PLAYER &8LOG Succesfull Call. Test Command Args 1 <cmdarg:1> 2 <cmdarg:2> 3 <cmdarg:3> 4 <cmdarg:4>&r'
  Publish3:
    Script: 
    - '@SETSTR $<worldname>.<playername>CurrentLocation <currentloc:<playername>>'
    - '@SETBLOCK 120:0 $<worldname>.<playername>CurrentLocation'
    - '@CMDOP setwarp Schematic<var:$<worldname>.<playername>PublishSchematic>'
    - '@SETSTR $<worldname>.<playername>NextScriptText &4An Ender Portal Frame has been created at the location you are standing you are now prepared to place the scripts on this empty frame that will allow others to purchase your schematic.'
    - '@SETSTR $<worldname>.<playername>NextScript ConstructionYard:Publish4'
    - '@CALL Shared:NextStep'
  Publish4:
    Script:
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp'
    - '@DELVAR b $<worldname>.<playername>LOSCheckTmp'
    - '@DELVAR s $<worldname>.<playername>LOSLocTmp'
    - '@DELVAR s $<worldname>.<playername>BlockTypeTMP'
    - '@EXPLOSION 0.0 <currentloc:<playername>>'
    - '@FLAMES 3 <currentloc:<playername>>'
    - '@POOF 3 <currentloc:<playername>>' 
    - '@IF i <giveitem:<playername>:381:1> = 1'
    - ' @PLAYER &4An Enchanted Eye of Ender appears in your inventory.&r'
    - '@ENDIF'
    - '@WHILE i <hasitem:<playername>:381> = 0'
    - ' @IF i <hasitem:<playername>:381> = 0'
    - '     @PLAYER &4Your Inventory is full please make room.'
    - ' @ENDIF'
    - ' @PAUSE 5'
    - ' @ADDINT $<worldname>.<playername>WhileCheckTimeLimitTmp 5'
    - ' @IF i $<worldname>.<playername>WhileCheckTimeLimitTmp >= 300'
    - '     @PLAYER &4You took to long.&r Your time limit was 5 minutes. Contact an admin if you think this was due to bug or if you want to try to place the script again.'
    - '     @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '     @EXIT'
    - ' @ENDIF'
    - '@ENDWHILE'
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '@PLAYER Now &4look at&r the empty ender portal frame while having the &4An Enchanted Eye of Ender&r in your hands and slowly walk up to it and right click on it.'
    - '@WHILE b $<worldname>.<playername>LOSCheckTmp != True'
    - ' @ADDINT $<worldname>.<playername>WhileCheckTimeLimitTmp 1'
#    - ' @PLAYER &8LOG Current Item Holding <itemid> &r'
# New Wand item Eye of Ender 381 Check.
#    - ' @IF i <itemid> = 381'
    # Check if looking at end portal frame without an eye.
#    - '     @PLAYER &8LOG Current Block Looking at within 3 sqrs <getblocklos:TYPE:3> &r'
    - '     @IF s <getblocklos:TYPE:3> = 120:0'
    - '     @OR s <getblocklos:TYPE:3> = 120:1'
    - '     @OR s <getblocklos:TYPE:3> = 120:2'
    - '     @OR s <getblocklos:TYPE:3> = 120:3'
#    - '         @LIGHTNING false <playerloc>'
    - '         @SOUNDEX ENDERMAN_STARE 1.0 2.0 <currentloc:<playername>>'
            #Place script you want them to be able to place right here.
    - '         @CMDOP vtclick @SETSTR $Placeholder.SchematicToBuy $<worldname>.<playername>PublishSchematic'
    - '         @PLAYER The &4Eye of Ender&r is now ready to be &4joined&r with the &4empty end portal frame&r. In order for it to by joined correctly you must &4DOUBLE RIGHT CLICK&r with the eye on the portal frame.'
    - '         @SETBOOL $<worldname>.<playername>LOSCheckTmp True'
    - '     @ELSE'
    - '         @IF i $<worldname>.<playername>WhileCheckTimeLimitTmp >= 150'
#    - '             @CMDOP vtclickview'
    - '             @SETINT $<worldname>.<playername>WhileCheckTimeLimitTmp 0'
    - '             @ADDINT $<worldname>.<playername>WhileCheckTimeLimitTotalTmp 150'
    - '             @PLAYER You must be &4looking&r at an &4end portal frame&r that is not filled in with an &4eye&r while being at most &4 3 squares away&r.'
    - '             @PLAYER &8Log Current block looking at LOC <getblocklos:LOC:100> and ID <getblocklos:TYPE:100> &r'
    - '         @ENDIF'
    - '     @ENDIF'
    - '     @IF i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp >= 1500'
    - '     @AND b $<worldname>.<playername>LOSCheckTmp != True'
    - '         @PLAYER &4You took to long.&r Your time limit was 5 minutes. Contact an admin if you think this was due to bug or if you want to try to place the script again.'
    - '         @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '         @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp'
    - '         @EXIT'
    - '     @ENDIF'
#    - ' @ENDIF'
    - ' @SETSTR $<worldname>.<playername>BlockTypeTMP <getblocklos:TYPE:3>'
    - ' @PAUSE 0.2'
    - '@ENDWHILE'
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp'
    - '@DELVAR b $<worldname>.<playername>LOSCheckTmp'
    - '@WHILE b $<worldname>.<playername>LOSCheckTmp != True'
    - ' @ADDINT $<worldname>.<playername>WhileCheckTimeLimitTmp 1'
        # Make sure end portal frame now has an eye from player placing script.
    - ' @IF s <getblocklos:TYPE:3> = 120:4'
    - ' @OR s <getblocklos:TYPE:3> = 120:5'
    - ' @OR s <getblocklos:TYPE:3> = 120:6'
    - ' @OR s <getblocklos:TYPE:3> = 120:7'
    - ' @OR s <getblocklos:TYPE:3> = 120:8'
    - ' @OR s $<worldname>.<playername>BlockTypeTMP = 120:4'
    - ' @OR s $<worldname>.<playername>BlockTypeTMP = 120:5'
    - ' @OR s $<worldname>.<playername>BlockTypeTMP = 120:6'
    - ' @OR s $<worldname>.<playername>BlockTypeTMP = 120:7'
    - ' @OR s $<worldname>.<playername>BlockTypeTMP = 120:8'
    - '     @SETSTR $<worldname>.<playername>LOSLocTmp <getblocklos:LOC:3>'
#    - '     @PAUSE 2'
    - '     @SETBOOL $<worldname>.<playername>LOSCheckTmp True'
    - '     @LIGHTNING false $<worldname>.<playername>LOSLocTmp'
    - '     @SETBLOCK 120:0 $<worldname>.<playername>LOSLocTmp'
    - '     @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '     @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp'
    - '     @DELVAR b $<worldname>.<playername>LOSCheckTmp'
    - '     @DELVAR s $<worldname>.<playername>LOSLocTmp'
    - '     @DELVAR b $<worldname>.<playername>StartOverTmp'
    - '     @DELVAR s $<worldname>.<playername>BlockTypeTMP'
    - '     @PLAYER &4The ender portal frame consumes the eye and gains power.&r'
    - '     @DELVAR s $<worldname>.<playername>PlaceScriptTMP'
    - '     @SETSTR $<worldname>.<playername>NextScriptText You will now go through the same steps again in order to place a second ender eye to complete the activation of your <var:$<worldname>.<playername>ActivePlans>.'
    - '     @SETSTR $<worldname>.<playername>NextScript ConstructionYard:Publish5'
    - '     @CALL Shared:NextStep'
    - '     @EXIT'
    - ' @ELSE'
    - '     @IF i $<worldname>.<playername>WhileCheckTimeLimitTmp >= 150'
    - '         @SETINT $<worldname>.<playername>WhileCheckTimeLimitTmp 0'
    - '         @ADDINT $<worldname>.<playername>WhileCheckTimeLimitTotalTmp 150'
    - '         @PLAYER &4DOUBLE Right Click on the Ender Portal Frame with the Eye of Ender&r'
    - '         @PLAYER &8Log Current block looking at LOC <getblocklos:LOC:100> and ID <getblocklos:TYPE:100> &r'
    - '     @ENDIF'
    - '     @IF s <getblocklos:TYPE:3> != 120:0'
    - '     @AND s <getblocklos:TYPE:3> != 120:1'
    - '     @AND s <getblocklos:TYPE:3> != 120:2'
    - '     @AND s <getblocklos:TYPE:3> != 120:3'
    - '     @AND s <getblocklos:TYPE:3> != 120:4'
    - '     @AND s <getblocklos:TYPE:3> != 120:5'
    - '     @AND s <getblocklos:TYPE:3> != 120:6'
    - '     @AND s <getblocklos:TYPE:3> != 120:7'
    - '     @AND s <getblocklos:TYPE:3> != 120:8'
    - '         @CMDOP vtclickview'
    - '         @PLAYER &4You FAILED to place the Eye of Ender on the Ender Portal Frame while it was still enchanted. 
    Once it it enchanted you must not look away from the ender portal frame or it will lose its charge. STARTING OVER PLEASE WAIT&r'
    - '         @IF b <takeitem:<playername>:381:1> = True'
    - '             @PLAYER &8LOG Eye of Ender Taken&r'
    - '         @ENDIF'
    - '         @SETBOOL $<worldname>.<playername>StartOverTmp True'
    - '         @SETBOOL $<worldname>.<playername>LOSCheckTmp True'
    - '     @ENDIF'
    - ' @ENDIF'
    - ' @IF i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp >= 1500'
    - ' @AND b $<worldname>.<playername>LOSCheckTmp != True'
    - '     @PLAYER &4You took to long.&r Your time limit was 5 minutes. Contact an admin if you think this was due to bug or if you want to try to place the script again.'
    - '     @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '     @DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp'
    - '     @EXIT'
    - ' @ENDIF'
    - ' @PAUSE 0.2'
    - '@ENDWHILE'
    - '@DELVAR b $<worldname>.<playername>LOSCheckTmp'
# This is the retry if the player fails to look at the ender portal frame while the eye is charged.    
    - '@IF b $<worldname>.<playername>StartOverTmp = True'
    - ' @CMDOP vtclickview'
    - ' @PAUSE 7'
    - ' @PLAYER &4Ignore the text that just appears above and this time get it right! Remember to read the directions!&r'
    - ' @PAUSE 5'
    - ' @DELVAR b $<worldname>.<playername>StartOverTmp'
    - ' @CALL ConstructionYard:Ledger1'
    - '@ENDIF'
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTmp'
    - '@DELVAR i $<worldname>.<playername>WhileCheckTimeLimitTotalTmp'
    - '@DELVAR b $<worldname>.<playername>LOSCheckTmp'
    - '@DELVAR s $<worldname>.<playername>LOSLocTmp'
    - '@DELVAR b $<worldname>.<playername>StartOverTmp'
    - '@DELVAR s $<worldname>.<playername>BlockTypeTMP'
  Publish5:
    Script:
#    - '@SETSTR $<worldname>.<playername>PlaceScriptTMP vtclick @SETSTR $Placeholder.SchematicToBuy <var:$<worldname>.<playername>PublishSchematic>'
#    - '@CALL Shared:PlaceScript'
#    - '@DELVAR s $<worldname>.<playername>PlaceScriptTMP'
    - '@PLAYER &4First power placed.'
    - '@PAUSE 4'
    - '@PLAYER &4Now to place the second power.'
    - '@SETSTR $<worldname>.<playername>PlaceScriptTMP vtclick @CALL ConstructionYard:Buy'
    - '@CALL Shared:PlaceScript'
    - '@DELVAR s $<worldname>.<playername>PlaceScriptTMP'
    - '@DELVAR s $<worldname>.<playername>NextScript'
    - '@PLAYER Once you place this power you are finished publishing and putting your schematic up for sale. 
    Click on the ender portal frame to test it to make sure it is all set the way you want.
    Also a friendly reminder you can type &4/mi warp&r to go back to the construction yard you used to get to this world.'
  Edit:
    Script:
#STILL WORKING OUT THE DETAILS ON HOW EDITING WILL WORK
    - '@PLAYER No Way To Edit At This Time'
  Buy:
    Script:
    - '@IF s <playername> = $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Owner'
    - ' @IF i <itemid> = 0'
    - '     @CMDOP /schematic load $<worldname>.<playername>SchematicToBuy'
    - '     @PLAYER You own this schematic. Information regarding this schematic will now be listed.
    Category: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Category
    Owner: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Owner
    Name: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Name
    Price: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Price
    Population: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Pop
    Distribution: Currently not working.'
    - '     @PAUSE 5'
    - '     @CMDOP /copy'
    - '     @PAUSE 5'
    - '     @CMDOP /distr'
    - '     @CMDOP clearclipboard'
    - ' @ENDIF'
    - ' @IF i <itemid> = 351'
    - '     @PLAYER You begin to edit the schematic.'
    - '     @CALL ConstructionYard:Edit'
    - ' @ENDIF'
    - ' @IF i <itemid> = 339'
    - '     @PLAYER Click with an empty hand to get information on this schematic. 
    Click with ink to edit this schematic.'
    - ' @ENDIF'
    - '@ELSE'
    - ' @IF i <itemid> = 0'
    - '     @PLAYER Click with Emerald to buy. Selected Schematic Info Listed Below.
    Category: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Category
    Owner: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Owner
    Name: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Name
    Population: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Pop
    Price: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Price'
    - ' @ENDIF'
    - ' @IF i <itemid> = 388'
    - '     @SETINT $<worldname>.<playername>SchematicToBuyPrice $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Price'
    - '     @SETSTR $<worldname>.<playername>SchematicToBuyOwner $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Owner'
    - '     @IF b <takemoney:<playername>:$<worldname>.<playername>SchematicToBuyPrice> = true'
    - '         @IF b <givemoney:$<worldname>.<playername>SchematicToBuyOwner:$<worldname>.<playername>SchematicToBuyPrice> = TRUE'
    - '             @PLAYER You just purchased a new schematic and paid $<worldname>.<playername>SchematicToBuyOwner $<worldname>.<playername>SchematicToBuyPrice $Config.CurrencyType . Note the placement and direction(example south press f3) of this ender portal frame compared
    to the structure. When building this setup will be the first one the builder will get unless you rotate it. More information will be given at that time on how to rotate.'
    - '             @ADDINT $<var:$<worldname>.<playername>SchematicToBuyOwner>.SchematicsProfit $<worldname>.<playername>SchematicToBuyPrice'    
    - '             @SETSTR $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicToBuy> purchased'
    - '             @PLAYER &8LOG Test $<worldname>.<playername>Schematic<var:$<worldname>.<playername>SchematicToBuy> &r'
    - '         @ENDIF'
    - '     @ENDIF'
    - ' @ENDIF'
    - ' @IF i <itemid> = 351'
    - '     @CMDOP /schematic load $<worldname>.<playername>SchematicToBuy'
    - '     @PLAYER Click with Emerald to buy. Selected Schematic Info Listed Below.
    Category: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Category
    Owner: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Owner
    Name: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Name
    Price: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Price
    Population: $Schematic.<var:$<worldname>.<playername>SchematicToBuy>Pop
    Distribution: Currently not working.'
    - '     @PAUSE 5'
    - '     @CMDOP /copy'
    - '     @PAUSE 5'
    - '     @CMDOP /distr'
    - '     @CMDOP clearclipboard'
    - ' @ENDIF'
    - ' @IF i <itemid> = 339'
    - '     @PLAYER Click with an emerald to buy. 
    Click with an empty hand to get information on this schematic. 
    Click with ink to get information on this schematic including the distribution of the blocks.'
    - ' @ENDIF'
    - '@ENDIF'
  BuilderComplete:
    Script:
    - '@SETSTR $<worldname>.<playername><var:$<worldname>.<playername>ActivePlans>Stage Ledger'
    - '@CMDOP npc anchor --assume home'
    - '@CALL ConstructionYard:Ledger'
  BuilderDeath:
    Script:
    - '@IF i $<worldname>.<playername>BuilderPop > 0'
    - ' @SUBINT $<worldname>.<playername>BuilderPop 1'
    - '@ENDIF'
    - '@PLAYER &4One of your Builders Died&r'
  Claim:
    Script:
    - '     @PLAYER Current Town Size: $<worldname>.<playername><var:$<worldname>.<playername>CurrentBuildingTown>TownSize .'
    - '     @IF i $<worldname>.<playername><var:$<worldname>.<playername>CurrentBuildingTown>TownSize < 49'
    - '         @SETSTR $<worldname>.<playername>Building ConstructionYard'
    - '         @SETSTR $<worldname>.<playername>Action ClaimTownBlock'
    - '         @CALL Shared:Price'
    - '         @IF b $<worldname>.<playername>PriceCheck = true'
#    - '             @PLAYER You have activated the ability to claim more land for <var:$<worldname>.<playername>CurrentBuildingTown>. The system that is used to claim new land for your
#    town can be confusing but it will become easier after your first attempt.'
#    - '             @CALL Shared:BowCheck'
#    - '             @PLAYER Step 1: After this step a text based map will appear that will help you find a 16x16 plot of land that is for sale and has not already been claimed.
#    You should also have yellow and red dyed wool blocks to help you visualize the borders of each plot. IMPORTANT NOTE you can only claim a plot of land that is connected to one you already own.'
#    - '             @CALL Shared:BowCheck'  
#    - '             @CMDOP resident toggle plotborder'
#    - '             @CMDOP resident toggle map'
#    - '             @SETBOOL $<worldname>.<playername>ClaimLandStep True'
#    - '             @DELVAR i $<worldname>.<playername>TimerTmp'
#    - '             @PLAYER Step 2: Your map and borders have been toggled on. Now move within the borders of the plot of land you would like to claim for your town
#    and place a sign to claim it as your plot of land. MAKE SURE this plot of land is not already claimed and is connected to your current town.'
#    - '             @WHILE b $<worldname>.<playername>ClaimLandStep = True'
#    - '                 @PAUSE 2'
#    - '                 @ADDINT $<worldname>.<playername>TimerTmp 2'
#    - '                 @IF i $<worldname>.<playername>TimerTmp >= 600'
#    - '                     @SETBOOL $<worldname>.<playername>ClaimLandStep False'
#    - '                     @CMDOP resident toggle plotborder'
#    - '                     @CMDOP resident toggle map'
#    - '                     @DELVAR i $<worldname>.<playername>TimerTmp'
#    - '                     @PLAYER Plot claim failed due to running out of time. Contact an admin if you need help.'
#    - '                     @EXIT'
#    - '                 @ENDIF'
#    - '             @ENDWHILE'
#    - '             @CMDOP resident toggle plotborder'
#    - '             @CMDOP resident toggle map'
    - '             @CMDOP town claim'
#    - '             @ADDINT $<worldname>.<playername><var:$<worldname>.<playername>CurrentBuildingTown>TownCopyBlocks 1'
    - '             @ADDINT $<worldname>.<playername><var:$<worldname>.<playername>CurrentBuildingTown>TownSize 1'
#    - '             @DELVAR b $<worldname>.<playername>ClaimLandStep'
    - '             @PLAYER Congratulations you have expanded your town borders. You can now copy and paste this 16x16 plot of land you just purchased into your creative world. 
    Type &4/mi help ConstructionYard TownCopy&r for help on how to copy plots of land near your Construction Yard into your creative world.'
#    - '             @CALL Shared:BowCheck'
#    - '             @CALL ConstructionYard:TownCopy'
    - '         @ENDIF'
    - '     @ELSE'
    - '         @PLAYER Your town is to large and can only be expanded by building a town hall.'
    - '     @ENDIF'