# Known bugs:
# - blocks that do not fall in vanilla minecraft do not fall when blocks are mined
# - FailReason should be a team variable, not player, so that it can be pinged by the team in the Mine Hub command block
# - Items such as mushrooms will fail the solid block vs air test and prevent rail from being placed. Have the script also check for these as well and destroy.
# Brainstorming and Notes
# Grabbed Barracks file and copied it over for now as a template.
# This building will hire an NPC who will perform a script that will slowly build a mineshaft in the direction that the building as placed.
# MiningI Unlocks Coal and Cobblestone Collection.
# MiningII Unlocks Iron
# MiningIII Unlocks Everything else and allows for a decline/elevators.
# How it Works:
# You supply the building with a villager and money and tools + build blocks such as rails and railcarts wood torches.
# It will then begin mining. If it finds stone it breaks it to cobblestone.
# If it finds a resource it will mine it with a chance to get bonus.
# Either have a rail system pick up the blocks or... run a script that just places the blocks into a chest.
Scripts:
  Help:
    Script:
    - '@PLAYER Opened Mine Help.'
    - '@PLAYER &4 UNDER CONSTRUCTION'
    - '@PLAYER Closed Mine Help.'
  MinerControlHelp:
    Script:
    - '@PLAYER Menu Help for Miner Control. UNDER CONSTRUCTION'
    - '@PLAYER Commands are accessible through the menu but also can be typed. See http://wiki.citizensnpcs.co/Commands and http://wiki.citizensnpcs.co/Sentry#Commands . This is useful for setting hotkeys instead of using the menu system.'
  Ledger:
    Script:
#    - '@SETSTR $<worldname>.<playername>ActivePlans Mine'
    - '@SETSTR $<worldname>.<playername>CurrentTown $<playername>.SMTeam'
#    - '@ADDINT $<worldname>.<var:$<playername>.SMTeam>PopLimit 6'
    - '@PLAYER &8LOG Calling Shared:BuildingLedger'
    - '@CALL Shared:BuildingLedger'
  Menu:
    Script:
    - '@SETSTR $<worldname>.<playername>CheckType Y-1Check'
    - '@CALL Shared:BuildingID'
    - '@IF b $<worldname>.<playername>NoOwner = True'
    - '@AND b $<worldname>.<var:$<playername>.SMTeam>Building != True'
#    - ' @SETBOOL $<worldname>.<var:$<playername>.SMTeam>Building False' 
#    - ' @SETSTR $<worldname>.<playername>ActivePlans Mine'
    - ' @SETSTR $<worldname>.<playername>CurrentTown $<playername>.SMTeam'
    - ' @CALL Shared:BuildingLedger'
    - '@ENDIF'
    - '@IF b $<worldname>.<playername>AllowedUse = True'
    - ' @PLAYER Opening Mine Menu'
    - ' @OPENINV Mine'
    - '@ENDIF'
  IEvent:
    Script:
    - '@IF s <inventorytitle> ?= Mine'
    - ' @SWITCH i <clickedslot>'
    - '   @CASE 0'
    - '     @CALL Mine:Help'
    - '   @CASE 1'
    - '     @SETSTR $<worldname>.<playername>CitizenSelected <var:$<playername>.SMTeam>1'
    - '     @IF b $<worldname>.<var:$<playername>.SMTeam>1Built != True'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType New'
    - '         @SETSTR $<worldname>.<playername>CitizenTeamID $<playername>.SMTeam'
    - '         @ADDSTR $<worldname>.<playername>CitizenTeamID 1'
    - '         @PLAYER <var:$<playername>.SMTeam> 1 new citizen selected.'
    - '     @ELSE'
    - '       @IF b $<worldname>.<var:$<playername>.SMTeam>1Dead = True'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType Dead'
    - '         @SETSTR $<worldname>.<playername>CitizenTeamID $<playername>.SMTeam'
    - '         @ADDSTR $<worldname>.<playername>CitizenTeamID 1'
    - '         @PLAYER <var:$<playername>.SMTeam> 1 respawn selected.'
    - '       @ELSE'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType Taken'
    - '         @PLAYER <var:$<playername>.SMTeam> 1 slot has already been taken.'
    - '       @ENDIF'
    - '     @ENDIF'
    - '   @CASE 2'
    - '     @SETSTR $<worldname>.<playername>CitizenSelected <var:$<playername>.SMTeam>2'
    - '     @IF b $<worldname>.<var:$<playername>.SMTeam>2Built != True'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType New'
    - '         @SETSTR $<worldname>.<playername>CitizenTeamID $<playername>.SMTeam'
    - '         @ADDSTR $<worldname>.<playername>CitizenTeamID 2'
    - '         @PLAYER <var:$<playername>.SMTeam> 2 new citizen selected.'
    - '     @ELSE'
    - '       @IF b $<worldname>.<var:$<playername>.SMTeam>2Dead = True'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType Dead'
    - '         @SETSTR $<worldname>.<playername>CitizenTeamID $<playername>.SMTeam'
    - '         @ADDSTR $<worldname>.<playername>CitizenTeamID 2'
    - '         @PLAYER <var:$<playername>.SMTeam> 2 respawn selected.'
    - '       @ELSE'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType Taken'
    - '         @PLAYER <var:$<playername>.SMTeam> 2 slot has already been taken.'
    - '       @ENDIF'
    - '     @ENDIF'
    - '   @CASE 3'
    - '     @SETSTR $<worldname>.<playername>CitizenSelected <var:$<playername>.SMTeam>3'
    - '     @IF b $<worldname>.<var:$<playername>.SMTeam>3Built != True'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType New'
    - '         @SETSTR $<worldname>.<playername>CitizenTeamID $<playername>.SMTeam'
    - '         @ADDSTR $<worldname>.<playername>CitizenTeamID 3'
    - '         @PLAYER <var:$<playername>.SMTeam> 3 new citizen selected.'
    - '     @ELSE'
    - '       @IF b $<worldname>.<var:$<playername>.SMTeam>3Dead = True'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType Dead'
    - '         @SETSTR $<worldname>.<playername>CitizenTeamID $<playername>.SMTeam'
    - '         @ADDSTR $<worldname>.<playername>CitizenTeamID 3'
    - '         @PLAYER <var:$<playername>.SMTeam> 3 respawn selected.'
    - '       @ELSE'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType Taken'
    - '         @PLAYER <var:$<playername>.SMTeam> 3 slot has already been taken.'
    - '       @ENDIF'
    - '     @ENDIF'
    - '   @CASE 4'
    - '     @SETSTR $<worldname>.<playername>CitizenSelected <var:$<playername>.SMTeam>4'
    - '     @IF b $<worldname>.<var:$<playername>.SMTeam>4Built != True'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType New'
    - '         @SETSTR $<worldname>.<playername>CitizenTeamID $<playername>.SMTeam'
    - '         @ADDSTR $<worldname>.<playername>CitizenTeamID 4'
    - '         @PLAYER <var:$<playername>.SMTeam> 4 new citizen selected.'
    - '     @ELSE'
    - '       @IF b $<worldname>.<var:$<playername>.SMTeam>4Dead = True'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType Dead'
    - '         @SETSTR $<worldname>.<playername>CitizenTeamID $<playername>.SMTeam'
    - '         @ADDSTR $<worldname>.<playername>CitizenTeamID 4'
    - '         @PLAYER <var:$<playername>.SMTeam> 4 respawn selected.'
    - '       @ELSE'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType Taken'
    - '         @PLAYER <var:$<playername>.SMTeam> 4 slot has already been taken.'
    - '       @ENDIF'
    - '     @ENDIF'
    - '   @CASE 5'
    - '     @SETSTR $<worldname>.<playername>CitizenSelected <var:$<playername>.SMTeam>5'
    - '     @IF b $<worldname>.<var:$<playername>.SMTeam>5Built != True'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType New'
    - '         @SETSTR $<worldname>.<playername>CitizenTeamID $<playername>.SMTeam'
    - '         @ADDSTR $<worldname>.<playername>CitizenTeamID 5'
    - '         @PLAYER <var:$<playername>.SMTeam> 5 new citizen selected.'
    - '     @ELSE'
    - '       @IF b $<worldname>.<var:$<playername>.SMTeam>5Dead = True'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType Dead'
    - '         @SETSTR $<worldname>.<playername>CitizenTeamID $<playername>.SMTeam'
    - '         @ADDSTR $<worldname>.<playername>CitizenTeamID 5'
    - '         @PLAYER <var:$<playername>.SMTeam> 5 respawn selected.'
    - '       @ELSE'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType Taken'
    - '         @PLAYER <var:$<playername>.SMTeam> 5 slot has already been taken.'
    - '       @ENDIF'
    - '     @ENDIF'
    - '   @CASE 6'
    - '     @SETSTR $<worldname>.<playername>CitizenSelected <var:$<playername>.SMTeam>6'
    - '     @IF b $<worldname>.<var:$<playername>.SMTeam>6Built != True'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType New'
    - '         @SETSTR $<worldname>.<playername>CitizenTeamID $<playername>.SMTeam'
    - '         @ADDSTR $<worldname>.<playername>CitizenTeamID 6'
    - '         @PLAYER <var:$<playername>.SMTeam> 6 new citizen selected.'
    - '     @ELSE'
    - '       @IF b $<worldname>.<var:$<playername>.SMTeam>6Dead = True'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType Dead'
    - '         @SETSTR $<worldname>.<playername>CitizenTeamID $<playername>.SMTeam'
    - '         @ADDSTR $<worldname>.<playername>CitizenTeamID 6'
    - '         @PLAYER <var:$<playername>.SMTeam> 6 respawn selected.'
    - '       @ELSE'
    - '         @SETSTR $<worldname>.<playername>CitizenSelectType Taken'
    - '         @PLAYER <var:$<playername>.SMTeam> 6 slot has already been taken.'
    - '       @ENDIF'
    - '     @ENDIF'
    - '   @CASE 9'
    - '@PLAYER &8LOG Start Case 1 script'
    - '     @CALL Mine:HireStick'
    - '     @CLOSEINV <playername>'
    - '   @CASE 10'
    - '     @IF i $<worldname>.<playername>BuildingLevel >= 2'
    - '       @CALL Mine:HireStone'
    - '       @SETBOOL $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>Built True'
    - '       @CLOSEINV <playername>'
    - '     @ELSE'
    - '       @PLAYER You must upgrade your Mine to Level 2 before you can recruit this soldier.'
    - '     @ENDIF'
    - '   @CASE 11'
    - '     @IF i $<worldname>.<playername>BuildingLevel >= 3'
    - '       @CALL Mine:HireIron1'
    - '       @SETBOOL $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>Built True'
    - '       @CLOSEINV <playername>'
    - '     @ELSE'
    - '       @PLAYER You must upgrade your Mine to Level 3 before you can recruit this soldier.'
    - '     @ENDIF'
    - '   @CASE 12'
    - '     @IF i $<worldname>.<playername>BuildingLevel >= 4'
    - '       @CALL Mine:HireIron2'
    - '       @SETBOOL $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>Built True'
    - '       @CLOSEINV <playername>'
    - '     @ELSE'
    - '       @PLAYER You must upgrade your Mine to Level 4 before you can recruit this soldier.'
    - '     @ENDIF'
    - '   @CASE 13'
    - '     @IF i $<worldname>.<playername>BuildingLevel >= 5'
    - '       @CALL Mine:HireDiamond'
    - '       @SETBOOL $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>Built True'
    - '       @CLOSEINV <playername>'
    - '     @ELSE'
    - '       @PLAYER You must upgrade your Mine to Level 5 before you can recruit this soldier.'
    - '     @ENDIF'
    - '   @CASE 18'
    - '     @SETSTR $<worldname>.<playername>TempVarCombine $<worldname>.<var:$<playername>.SMTeam>FletcherID'
    - '     @ADDSTR $<worldname>.<playername>TempVarCombine Level'
    - '     @IF i $<worldname>.<playername>BuildingLevel >= 2'
    - '     @AND i $<worldname>.<var:$<worldname>.<playername>TempVarCombine> >= 1'
    - '       @CALL Mine:HireBow1'
    - '       @SETBOOL $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>Built True'
    - '       @CLOSEINV <playername>'
    - '     @ELSE'
    - '       @PLAYER You must upgrade your Mine 2 and Fletcher to Level 1 before you can recruit this bowman.'
    - '     @ENDIF'
    - '   @CASE 19'
    - '     @SETSTR $<worldname>.<playername>TempVarCombine $<worldname>.<var:$<playername>.SMTeam>FletcherID'
    - '     @ADDSTR $<worldname>.<playername>TempVarCombine Level'
    - '     @IF i $<worldname>.<playername>BuildingLevel >= 4'
    - '     @AND i $<worldname>.<var:$<worldname>.<playername>TempVarCombine> >= 2'
    - '       @CALL Mine:HireBow2'
    - '       @SETBOOL $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>Built True'
    - '       @CLOSEINV <playername>'
    - '     @ELSE'
    - '       @PLAYER You must upgrade your Mine 4 and Fletcher to Level 2 before you can recruit this bowman.'
    - '     @ENDIF'
    - '   @CASE 20'
    - '     @SETSTR $<worldname>.<playername>TempVarCombine $<worldname>.<var:$<playername>.SMTeam>FletcherID'
    - '     @ADDSTR $<worldname>.<playername>TempVarCombine Level'
    - '     @IF i $<worldname>.<playername>BuildingLevel >= 5'
    - '     @AND i $<worldname>.<var:$<worldname>.<playername>TempVarCombine> >= 3'
    - '       @CALL Mine:HireBow3'
    - '       @SETBOOL $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>Built True'
    - '       @CLOSEINV <playername>'
    - '     @ELSE'
    - '       @PLAYER You must upgrade your Mine 5 and Fletcher to Level 3 before you can recruit this bowman.'
    - '     @ENDIF'
    - '   @CASE 25'
    # Add an are you sure system.
    - '     @CALL Shared:DemolishBuilding'
    - '   @CASE 26'
    - '     @PLAYER Upgrade Selected'
    - '     @IF b $<worldname>.<var:$<playername>.SMTeam>Building = True'
    - '       @PLAYER Your team needs to complete their current building first before starting another building project.'
    - '     @ELSE'
    - '       @IF b $<worldname>.<var:$<playername>.SMTeam>ActivateCB = True'
    - '         @CMDCON title <playername> title {text:"ERROR Activate Structure First",color:red}'
    - '         @PLAYER You need to activate a structure first before moving on to building another.'
    - '         @CALL Shared:BuildComplete'
    - '       @ELSE'
    - '       @SETBOOL $<worldname>.<playername>PlanSchematicUpgradable False'
    - '       @IF i $<worldname>.<playername>BuildingLevel = 1'
    - '       @AND b $<worldname>.<var:$<playername>.SMTeam>ArtofWarIIDiscovered = True'
    - '         @SETSTR $<worldname>.<playername>PlanSchematic Mine2'
    - '         @SETBOOL $<worldname>.<playername>PlanSchematicUpgradable True'
    - '       @ENDIF'
    - '       @IF i $<worldname>.<playername>BuildingLevel = 2'
    - '       @AND b $<worldname>.<var:$<playername>.SMTeam>ArtofWarIIIDiscovered = True'
    - '         @SETSTR $<worldname>.<playername>PlanSchematic Mine3'
    - '         @SETBOOL $<worldname>.<playername>PlanSchematicUpgradable True'
    - '       @ENDIF'
    - '       @IF i $<worldname>.<playername>BuildingLevel = 3'
    - '       @AND b $<worldname>.<var:$<playername>.SMTeam>ArtofWarIVDiscovered = True'
    - '         @SETSTR $<worldname>.<playername>PlanSchematic Mine4'
    - '         @SETBOOL $<worldname>.<playername>PlanSchematicUpgradable True'
    - '       @ENDIF'
    - '       @IF i $<worldname>.<playername>BuildingLevel = 4'
    - '       @AND b $<worldname>.<var:$<playername>.SMTeam>ArtofWarVDiscovered = True'
    - '         @SETSTR $<worldname>.<playername>PlanSchematic Mine5'
    - '         @SETBOOL $<worldname>.<playername>PlanSchematicUpgradable True'
    - '       @ENDIF'
    - '       @IF b $<worldname>.<playername>PlanSchematicUpgradable = True'
    - '         @SETSTR $<worldname>.<playername>PlanSchematicID $<worldname>.<playername>BuildingID'
    # Figure out what direction the player is facing to load correct facing schematic
    - '         @SETSTR $<worldname>.<playername>PlanSchematicDirection $<worldname>.<playername>BuildingDirection'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = North'
    # Change the origin based on North facing schematic East +X West -X North -Z South +Z .. Then Y depending on basement or not.
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX 1' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY -4'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ 1'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = East'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX -2' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY -4'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ 1'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = South'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX -1' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY -4'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ -2'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = West'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX 1' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY -4'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ -1'
    - '         @ENDIF'
    - '         @CALL Shared:Plan'
    - '       @ELSE'
    - '         @PLAYER This building is not upgradable yet. Discover more tech.'
    - '       @ENDIF'
    - '     @ENDIF'
    - '     @ENDIF'
    - ' @ENDSWITCH'
    - '@ENDIF'
    - '@CALL Mine:IEventSentryControl'
    Script:
    - '     @IF s $<worldname>.<playername>CitizenSelectType = New'
    - '       @CMDOP npc create <var:$<worldname>.<playername>CitizenTeamID> --type PLAYER --trait sentry'
    - '       @SETBOOL $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>Built True'
    - '       @PAUSE 2'
    # Setting up sentry default attack list.
    - '       @PLAYER &8LOG Start Hire script'
    - '       @CMDCON scoreboard teams join <var:$<playername>.SMTeam> <var:$<playername>.SMTeam>'
    - '       @CMDOP sentry ignore add group:<var:$<playername>.SMTeam>'
    - '       @SETINT $<worldname>.TeamListCountTmp 0'
    - '       @LOOP @<worldname>.TeamList'
    - '         @SETSTR $<worldname>.TeamListStr @<worldname>.TeamList[<var:$<worldname>.TeamListCountTmp>]'
    - '         @IF s $<worldname>.TeamListStr != $<playername>.SMTeam'
    - '           @CMDOP sentry target add group:<var:$<worldname>.TeamListStr>'
    - '         @ENDIF'
    - '         @ADDINT $<worldname>.TeamListCountTmp 1'
    - '       @ENDLOOP'
    - '       @CMDOP npc nickname --set <var:$<playername>.SMTeam>'
#    - '@CMDOP npc constant --set Team --value <var:$<playername>.SMTeam>'
    - '       @CMDOP npc assignment --set Sentry'
    - '       @PAUSE 2'
    - '       @SETINT $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>ID $<worldname>.<playername>CitizenID'
#    - '@CMDOP sentry healrate 0'
#    - '@CMDOP sentry respawn 0'
#    - '@CMDOP npc playerlist'
    - '       @CMDOP npc pushable'
    - '       @CMDOP sentry guard <playername>'
    - '     @ENDIF'
    - '     @IF s $<worldname>.<playername>CitizenSelectType = Dead'
    - '@PLAYER &8LOG $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>ID'
    - '       @CMDOP npc spawn $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>ID'
    - '       @SETBOOL $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>Dead False'
    - '       @PAUSE 1'
    - '       @CMDCON npc select $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>ID'
    - '       @PAUSE 0.2'
    - '       @CMDCON npc owner <playername>'
    - '       @CMDOP npc select $<worldname>.<var:$<worldname>.<playername>CitizenTeamID>ID'
    - '       @CMDOP npc tphere'
    - '       @CMDOP sentry guard <playername>'
    - '     @ENDIF'
  MineSetup:
    Script:
    - '@SETSTR $<playername>.MineSelection AngleDown'
    # After menu is set up, delete above line. Mine types selected from the menu: Straight, AngleDown, AngleUp, Shaft; save as string $<playername>.MineSelection
    - '@SETSTR $<playername>.Direction <direction:TEXT>'
#    - '@BROADCAST &8LOG $<playername>.Direction'
    - '@ADDLIST @<playername>.ValidDirection NORTH'
    - '@ADDLIST @<playername>.ValidDirection EAST'
    - '@ADDLIST @<playername>.ValidDirection SOUTH'
    - '@ADDLIST @<playername>.ValidDirection WEST'
    - '@SETINT $<playername>.PLocX <playerloc:x>'
    - '@SETINT $<playername>.PLocY <playerloc:y>'
    - '@SETINT $<playername>.PLocZ <playerloc:z>'
    - '@SETINT $<playername>.StdPauseLoop 1'
    - '@SETINT $<playername>.ListCount 0'
    - '@SETBOOL $<playername>.DirectionPassed false'
    - '@LOOP @<playername>.ValidDirection'
    - '   @SETSTR $<playername>.ValidDirectionListStr @<playername>.ValidDirection[<var:$<playername>.ListCount>]'
    - '   @IF s $<playername>.ValidDirectionListStr = $<playername>.Direction'
    - '      @SETBOOL $<playername>.DirectionPassed true'
    - '   @ENDIF'
    - '   @ADDINT $<playername>.ListCount 1'
    - '@ENDLOOP'
    - '@IF b $<playername>.DirectionPassed = false'
    - '   @SETSTR $<playername>.FailReason InvalidDirection'
    - '   @CALL Mine:MineFail'
    - '   @EXIT'
    - '@ENDIF'
    - '@SWITCH s $<playername>.Direction'
    - '   @CASE NORTH'
    - '      @SETINT $<playername>.FwdAdjX 0'
    - '      @SETINT $<playername>.FwdAdjZ -1'
    - '      @SETINT $<playername>.RightAdjX 1'
    - '      @SETINT $<playername>.RightAdjZ 0'
    - '      @SETINT $<playername>.LeftAdjX -1'
    - '      @SETINT $<playername>.LeftAdjZ 0'
    - '   @CASE EAST'
    - '      @SETINT $<playername>.FwdAdjX 1'
    - '      @SETINT $<playername>.FwdAdjZ 0'
    - '      @SETINT $<playername>.RightAdjX 0'
    - '      @SETINT $<playername>.RightAdjZ 1'
    - '      @SETINT $<playername>.LeftAdjX 0'
    - '      @SETINT $<playername>.LeftAdjZ -1'
    - '   @CASE SOUTH'
    - '      @SETINT $<playername>.FwdAdjX 0'
    - '      @SETINT $<playername>.FwdAdjZ 1'
    - '      @SETINT $<playername>.RightAdjX -1'
    - '      @SETINT $<playername>.RightAdjZ 0'
    - '      @SETINT $<playername>.LeftAdjX 1'
    - '      @SETINT $<playername>.LeftAdjZ 0'
    - '   @CASE WEST'
    - '      @SETINT $<playername>.FwdAdjX -1'
    - '      @SETINT $<playername>.FwdAdjZ 0'
    - '      @SETINT $<playername>.RightAdjX 0'
    - '      @SETINT $<playername>.RightAdjZ -1'
    - '      @SETINT $<playername>.LeftAdjX 0'
    - '      @SETINT $<playername>.LeftAdjZ 1'
    - '@ENDSWITCH'
    - '@SETINT $<playername>.MineTMPX $<playername>.PLocX'
    - '@SETINT $<playername>.MineTMPY $<playername>.PLocY'
    - '@SETINT $<playername>.MineTMPZ $<playername>.PLocZ'
    - '@SETSTR $<playername>.AngleDone false'
    - '@CALL Mine:3x3Loop'
  3x3Loop:
    Script:
    - '@IF s $<playername>.MineSelection = Straight'
    - '   @SETINT $<playername>.LoopAmt 6'
    - '@ENDIF'
    - '@IF s $<playername>.MineSelection = AngleUp'
    - '@OR s $<playername>.MineSelection = AngleDown'
    - '   @IF s $<playername>.AngleDone = false'
    - '      @SETINT $<playername>.LoopAmt 5'
    - '      @SETINT $<playername>.LoopCount 0'
    - '   @ENDIF'
    - '@ENDIF'
    - '@LOOP $<playername>.LoopAmt'
    - '   @IF s $<playername>.MineSelection = AngleDown'
    - '   @AND s $<playername>.AngleDone = false'
    - '      @IF i $<playername>.LoopCount = 0'
    - '         @CALL Mine:MineBlock'
    - '      @ENDIF'
    - '      @IF i $<playername>.LoopCount < 5'
    - '         @SUBINT $<playername>.MineTMPY 1'
    - '         @CALL Mine:MineBlock'
    - '      @ENDIF'
    - '      @SUBINT $<playername>.MineTMPY 1'   
    - '      @CALL Mine:FloorCheck'
    - '      @ADDINT $<playername>.MineTMPY 1'  
    - '      @SETSTR $<playername>.BlockName minecraft:rail'
    - '      @CALL Mine:PlaceBlock'
    - '      @ADDINT $<playername>.LoopCount 1'
    - '   @ENDIF'
    - '   @ADDINT $<playername>.MineTMPY 1'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.FwdAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.FwdAdjZ'
#    - '   @BROADCAST &8LOG Starting 3x3 Loop at <var:$<playername>.MineTMPX> <var:$<playername>.MineTMPY> <var:$<playername>.MineTMPZ>'
    - '   @CALL Mine:MineBlock'
    - '   @SUBINT $<playername>.MineTMPY 1'
    - '   @CALL Mine:MineBlock'
    - '   @ADDINT $<playername>.MineTMPY 1'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.RightAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.RightAdjZ'
    - '   @CALL Mine:MineBlock'
    - '   @SUBINT $<playername>.MineTMPY 1'
    - '   @CALL Mine:MineBlock'
    - '   @ADDINT $<playername>.MineTMPY 1'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.LeftAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.LeftAdjZ'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.LeftAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.LeftAdjZ'
    - '   @CALL Mine:MineBlock'
    - '   @SUBINT $<playername>.MineTMPY 1'
    - '   @CALL Mine:MineBlock'
    - '   @ADDINT $<playername>.MineTMPY 2'
    - '   @CALL Mine:MineBlock'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.RightAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.RightAdjZ'
    - '   @CALL Mine:MineBlock'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.RightAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.RightAdjZ'
    - '   @CALL Mine:MineBlock'
    - '   @SUBINT $<playername>.MineTMPY 2'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.LeftAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.LeftAdjZ'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.LeftAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.LeftAdjZ'
    - '   @SETINT $<playername>.MineResetX $<playername>.MineTMPX'
    - '   @SETINT $<playername>.MineResetZ $<playername>.MineTMPZ'
    # Inside loop, check for falling blocks at floor level
#    - '   @BROADCAST &8LOG Starting Falling Block Check'
    - '   @SETINT $<playername>.ResetCount 1'
    - '   @SETINT $<playername>.AirCount 0'
    - '   @WHILE i $<playername>.AirCount < 3'
    - '      @PAUSE 0.5'
    - '      @CALL Mine:MineBlock'
    - '      @IF i $<playername>.ResetCount < 3'
    - '         @ADDINT $<playername>.MineTMPX $<playername>.RightAdjX'
    - '         @ADDINT $<playername>.MineTMPZ $<playername>.RightAdjZ'
    - '         @ADDINT $<playername>.ResetCount 1'
    - '      @ELSE'
    - '         @ADDINT $<playername>.MineTMPX $<playername>.LeftAdjX'
    - '         @ADDINT $<playername>.MineTMPZ $<playername>.LeftAdjZ'
    - '         @ADDINT $<playername>.MineTMPX $<playername>.LeftAdjX'
    - '         @ADDINT $<playername>.MineTMPZ $<playername>.LeftAdjZ'
    - '         @SETINT $<playername>.ResetCount 1'
    - '      @ENDIF'
    - '   @ENDWHILE'
    # Inside loop, check for air below floor level
#    - '   @BROADCAST &8LOG Starting Solid Floor Check'
    - '   @SETINT $<playername>.MineTMPX $<playername>.MineResetX'
    - '   @SETINT $<playername>.MineTMPZ $<playername>.MineResetZ'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.LeftAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.LeftAdjZ'
    - '   @SUBINT $<playername>.MineTMPY 1'
    - '   @LOOP 3'
    - '      @ADDINT $<playername>.MineTMPX $<playername>.RightAdjX'
    - '      @ADDINT $<playername>.MineTMPZ $<playername>.RightAdjZ'
    - '      @CALL Mine:FloorCheck'
    - '   @ENDLOOP'
    # Inside loop, place rail
    - '   @ADDINT $<playername>.MineTMPY 1'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.LeftAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.LeftAdjZ'
    - '   @IF s $<playername>.MineSelection != AngleDown'
    - '   @OR i $<playername>.LoopCount >= $<playername>.LoopAmt'
    - '      @SETSTR $<playername>.BlockName minecraft:rail'
    - '      @CALL Mine:PlaceBlock'
    - '   @ENDIF'
    - '@ENDLOOP'
    # Place mine supports
    - '   @SETINT $<playername>.MineTMPX $<playername>.MineResetX'
    - '   @SETINT $<playername>.MineTMPZ $<playername>.MineResetZ'
    - '   @SETSTR $<playername>.BlockName minecraft:dark_oak_fence'   
    - '   @CALL Mine:PlaceBlock'
    - '   @ADDINT $<playername>.MineTMPY 1'
    - '   @CALL Mine:PlaceBlock'
    - '   @SUBINT $<playername>.MineTMPY 1'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.RightAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.RightAdjZ'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.RightAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.RightAdjZ'
    - '   @CALL Mine:PlaceBlock'
    - '   @ADDINT $<playername>.MineTMPY 1'
    - '   @CALL Mine:PlaceBlock'
    - '   @ADDINT $<playername>.MineTMPY 1'
    - '   @SETSTR $<playername>.BlockName minecraft:planks'
    - '   @CALL Mine:PlaceBlock'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.LeftAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.LeftAdjZ'
    - '   @CALL Mine:PlaceBlock'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.LeftAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.LeftAdjZ'
    - '   @CALL Mine:PlaceBlock'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.RightAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.RightAdjZ'
    - '   @SUBINT $<playername>.MineTMPX $<playername>.FwdAdjX'
    - '   @SUBINT $<playername>.MineTMPZ $<playername>.FwdAdjZ'
    - '   @SETSTR $<playername>.BlockName minecraft:torch'
    - '   @CALL Mine:PlaceBlock'
    - '   @ADDINT $<playername>.MineTMPX $<playername>.FwdAdjX'
    - '   @ADDINT $<playername>.MineTMPZ $<playername>.FwdAdjZ'
    # Reloop
    - '   @IF s $<playername>.AngleDone = false'
    - '      @IF s $<playername>.MineSelection = AngleUp'
    - '      @OR s $<playername>.MineSelection = AngleDown'
    - '         @SETINT $<playername>.LoopAmt 2'
    - '         @SUBINT $<playername>.MineTMPY 2'
    - '         @SETSTR $<playername>.AngleDone = true'
    - '         @CALL Mine:3x3Loop'
    - '      @ENDIF'
    - '   @ENDIF'
    # Mine finished
    - '   @SETSTR $<playername>.FailReason Success'
    - '   @CALL Mine:MineFail'
    - '   @EXIT'
  MineBlock:
    Script:
    - '@SETSTR $<playername>.MineTMPLocation <var:$<playername>.MineTMPX>,'
    - '@ADDSTR $<playername>.MineTMPLocation <var:$<playername>.MineTMPY>,'
    - '@ADDSTR $<playername>.MineTMPLocation $<playername>.MineTMPZ'
    - '@GETBLOCK $<playername>.BlockTMP $<playername>.MineTMPLocation'
    - '@IF s $<playername>.BlockTMP = 0:0'
    - '   @ADDINT $<playername>.AirCount 1'
    - '@ELSE'
    - '   @SETINT $<playername>.AirCount 0'
    - '   @IF s $<playername>.BlockTMP = 66:0'
    - '   @OR s $<playername>.BlockTMP = 66:1'
    #- '      add 1 rail back to inventory
    - '   @ENDIF'
    - '   @CMDOP setblock $<playername>.MineTMPX $<playername>.MineTMPY $<playername>.MineTMPZ minecraft:air 0 replace'
    # miner should run this line eventually to prevent spamming
    - '   @LOOP $<playername>.StdPauseLoop'
    - '      @PAUSE 1'
    - '   @ENDLOOP'
    - '@ENDIF'
  FloorCheck:
    Script:
    - '@SETSTR $<playername>.MineTMPLocation <var:$<playername>.MineTMPX>,'
    - '@ADDSTR $<playername>.MineTMPLocation <var:$<playername>.MineTMPY>,'
    - '@ADDSTR $<playername>.MineTMPLocation $<playername>.MineTMPZ'
    - '@GETBLOCK $<playername>.BlockTMP $<playername>.MineTMPLocation'
    - '@IF s $<playername>.BlockTMP = 0:0'
    - '   @SETSTR $<playername>.BlockName minecraft:wooden_slab'
    - '   @CALL Mine:PlaceBlock'
    - '@ENDIF'
  PlaceBlock:
    Script:
    - '@SETBOOL $<playername>.InvCheck false'
    - '@SETINT $<playername>.BlockData 0'
    # likely will need extensive if statements for the 10 possible rail block datas; here or when it is called
    - '@IF s $<playername>.BlockName = minecraft:rail'
    # check inventory for rail
    #- '   @IF i [inventory rail.var] > 0'
    - '      @SETBOOL $<playername>.InvCheck true'
    # remove 1 rail from inventory
    #- '   @ENDIF'
    - '@ENDIF'
    - '@IF s $<playername>.BlockName = minecraft:wooden_slab'
    # check inventory for wooden slab
    #- '   @IF i [inventory woodslab.var] > 0'
    - '      @SETBOOL $<playername>.InvCheck true'
    - '      @SETINT $<playername>.BlockData 13'
    # remove 1 wooden slab from inventory
    #- '   @ELSE'
    #- '      @SETSTR $<playername>.FailReason NoWoodSlab'
    #- '      @CALL Mine:MineFail'
    #- '      @EXIT'
    #- '   @ENDIF'
    - '@ENDIF'
    - '@IF s $<playername>.BlockName = minecraft:dark_oak_fence'
    # check inventory for fence
    #- '   @IF i [inventory fence.var] > 0'
    - '      @SETBOOL $<playername>.InvCheck true'
    # remove 1 fence from inventory
    #- '   @ELSE'
    #- '      @SETSTR $<playername>.FailReason NoFence'
    #- '      @CALL Mine:MineFail'
    #- '      @EXIT'
    #- '   @ENDIF'
    - '@ENDIF'
    - '@IF s $<playername>.BlockName = minecraft:planks'
    # check inventory for wooden planks
    #- '   @IF i [inventory planks.var] > 0'
    - '      @SETBOOL $<playername>.InvCheck true'
    - '      @SETINT $<playername>.BlockData 5'
    # remove 1 plank from inventory
    #- '   @ELSE'
    #- '      @SETSTR $<playername>.FailReason NoPlanks'
    #- '      @CALL Mine:MineFail'
    #- '      @EXIT'
    #- '   @ENDIF'
    - '@ENDIF'
    - '@IF s $<playername>.BlockName = minecraft:torch'
    # check inventory for a torch
    #- '   @IF i [inventory torch.var] > 0'
    - '      @SETBOOL $<playername>.InvCheck true'
    - '      @SWITCH s $<playername>.Direction'
    - '         @CASE NORTH'
    - '         @SETINT $<playername>.BlockData 3'
    - '         @CASE EAST'
    - '         @SETINT $<playername>.BlockData 2'
    - '         @CASE SOUTH'
    - '         @SETINT $<playername>.BlockData 4'
    - '         @CASE WEST'
    - '         @SETINT $<playername>.BlockData 1'
    - '      @ENDSWITCH'
    # remove 1 torch from inventory
    #- '   @ELSE'
    #- '      @SETSTR $<playername>.FailReason NoTorch'
    #- '      @CALL Mine:MineFail'
    #- '      @EXIT'
    #- '   @ENDIF'
    - '@ENDIF'
    - '@IF b $<playername>.InvCheck = true'
    - '   @CMDOP setblock $<playername>.MineTMPX $<playername>.MineTMPY $<playername>.MineTMPZ $<playername>.BlockName $<playername>.BlockData'
    - '   @LOOP $<playername>.StdPauseLoop'
    - '      @PAUSE 1'
    - '   @ENDLOOP'
    - '@ENDIF'
  MineFail:
    Script:
    - '@IF s $<playername>.FailReason = Success'
    - '   @CMDCON title <playername> title {text:"Mining Completed",color:red}'
    - '   @PLAYER Your miner has completeled all mine tunnel segments in queue'
    - '   @CMDCON title <playername> subtitle {text:"Your miner has completeled all mine tunnel segments in queue",color:yellow}'
    - '@ENDIF'    
    - '@IF s $<playername>.FailReason = InvalidDirection'
    - '   @CMDCON title <playername> title {text:"Mining Failed",color:red}'
    - '   @PLAYER A mine tunnel cannot be built on a horizontal angle'
    - '   @CMDCON title <playername> subtitle {text:"A mine tunnel cannot be built on a horizontal angle",color:yellow}'
    - '@ENDIF'
    - '@IF s $<playername>.FailReason = NoWoodSlab'
    - '   @CMDCON title <playername> title {text:"Mining Stopped",color:red}'
    - '   @PLAYER You must deposit Wooden Slabs into your Mine Hub inventory'
    - '   @CMDCON title <playername> subtitle {text:"You must deposit Wooden Slabs into your Mine Hub inventory",color:yellow}'
    - '@ENDIF'
    - '@IF s $<playername>.FailReason = NoFence'
    - '   @CMDCON title <playername> title {text:"Mining Stopped",color:red}'
    - '   @PLAYER Mining stopped...You must deposit Wooden Fences into your Mine Hub inventory'
    - '   @CMDCON title <playername> subtitle {text:"You must deposit Wooden Fences into your Mine Hub inventory",color:yellow}'
    - '@ENDIF'
    - '@IF s $<playername>.FailReason = NoPlanks'
    - '   @CMDCON title <playername> title {text:"Mining Stopped",color:red}'
    - '   @PLAYER Mining stopped...You must deposit Wooden Planks into your Mine Hub inventory'
    - '   @CMDCON title <playername> subtitle {text:"You must deposit Wooden Planks into your Mine Hub inventory",color:yellow}'
    - '@ENDIF'
    - '@IF s $<playername>.FailReason = NoTorch'
    - '   @CMDCON title <playername> title {text:"Mining Stopped",color:red}'
    - '   @PLAYER Mining stopped...You must deposit Torches into your Mine Hub inventory'
    - '   @CMDCON title <playername> subtitle {text:"You must deposit Torches into your Mine Hub inventory",color:yellow}'
    - '@ENDIF'
    - '@DELVAR s $<playername>.Direction'
    - '@DELVAR i $<playername>.PLocX'
    - '@DELVAR i $<playername>.PLocY'
    - '@DELVAR i $<playername>.PLocZ'
    - '@DELVAR i $<playername>.StdPauseLoop'
    - '@DELVAR s $<playername>.FailReason'
    - '@DELLIST @<playername>.ValidDirection'
    - '@DELVAR i $<playername>.ListCount'
    - '@DELVAR s $<playername>.ValidDirectionListStr'
    - '@DELVAR b $<playername>.DirectionPassed'
    - '@DELVAR i $<playername>.FwdAdjX'
    - '@DELVAR i $<playername>.FwdAdjZ'
    - '@DELVAR i $<playername>.RightAdjX'
    - '@DELVAR i $<playername>.RightAdjZ'
    - '@DELVAR i $<playername>.LeftAdjX'
    - '@DELVAR i $<playername>.LeftAdjZ'
    - '@DELVAR i $<playername>.MineTMPX'
    - '@DELVAR i $<playername>.MineTMPY'
    - '@DELVAR i $<playername>.MineTMPZ'
    - '@DELVAR s $<playername>.MineTMPLocation'
    - '@DELVAR i $<playername>.MineResetX'
    - '@DELVAR i $<playername>.MineResetZ'
    - '@DELVAR i $<playername>.ResetCount'
    - '@DELVAR i $<playername>.AirCount'
    - '@DELVAR s $<playername>.MineSelection'
    - '@DELVAR i $<playername>.LoopAmt'
    - '@DELVAR i $<playername>.LoopCount'
    - '@DELVAR s $<playername>.BlockName'
    - '@DELVAR s $<playername>.BlockTMP'
    - '@DELVAR i $<playername>.BlockData'
    - '@DELVAR b $<playername>.InvCheck'
    - '@DELVAR s $<playername>.AngleDone'