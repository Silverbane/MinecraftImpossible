Scripts:
  Help:
    Script:
    - '@PLAYER Opened Fletcher Help.'
    - '@PLAYER &4 UNDER CONSTRUCTION'
    - '@PLAYER Closed Fletcher Help.'
  Ledger:
    Script:
#    - '@SETSTR $<worldname>.<playername>ActivePlans Fletcher'
    - '@SETSTR $<worldname>.<playername>CurrentTown $<playername>.SMTeam'
    - '@ADDINT $<worldname>.<var:$<playername>.SMTeam>PopLimit 0'
    - '@PLAYER &8LOG Calling Shared:BuildingLedger'
    - '@CALL Shared:BuildingLedger'
  IEvent:
    Script:
    - '@IF s <inventorytitle> ?= Fletcher'
    - ' @SWITCH i <clickedslot>'
    - '   @CASE 0'
    - '     @CALL Fletcher:Help'
    - '   @CASE 1'
    - '     @PLAYER Upgrade Selected'
    - '     @IF b $<worldname>.<var:$<playername>.SMTeam>Building = True'
    - '       @PLAYER Your team needs to complete their current building first before starting another building project.'
    - '     @ELSE'
    - '       @IF b $<worldname>.<var:$<playername>.SMTeam>ActivateCB = True'
    - '         @CMDCON title <playername> title {text:"ERROR Activate Structure First",color:red}'
    - '         @PLAYER You need to activate a structure first before moving on to building another.'
    - '         @CALL Shared:BuildComplete'
    - '       @ELSE'
    - '       @SETBOOL $<worldname>.<playername>PlanSchematicUpgradable False'
    - '       @IF i $<worldname>.<playername>BuildingLevel = 1'
    - '       @AND b $<worldname>.<var:$<playername>.SMTeam>ArcheryIIDiscovered = True'
    - '         @SETSTR $<worldname>.<playername>PlanSchematic Fletcher2'
    - '         @SETBOOL $<worldname>.<playername>PlanSchematicUpgradable True'
    - '       @ENDIF'
    - '       @IF i $<worldname>.<playername>BuildingLevel = 2'
    - '       @AND b $<worldname>.<var:$<playername>.SMTeam>ArcheryIIIDiscovered = True'
    - '         @SETSTR $<worldname>.<playername>PlanSchematic Fletcher3'
    - '         @SETBOOL $<worldname>.<playername>PlanSchematicUpgradable True'
    - '       @ENDIF'
    - '       @IF b $<worldname>.<playername>PlanSchematicUpgradable = True'
    - '         @SETSTR $<worldname>.<playername>PlanSchematicID $<worldname>.<playername>BuildingID'
    # Figure out what direction the player is facing to load correct facing schematic
    - '         @SETSTR $<worldname>.<playername>PlanSchematicDirection $<worldname>.<playername>BuildingDirection'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = North'
    # Change the origin based on North facing schematic East +X West -X North -Z South +Z .. Then Y depending on basement or not.
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX 0' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY -2'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = East'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX -1' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY -2'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = South'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX -1' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY -2'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ -1'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = West'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX 0' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY -2'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ -1'
    - '         @ENDIF'
    - '         @CALL Shared:Plan'
    - '       @ELSE'
    - '         @PLAYER This building is not upgradable yet. Discover more tech.'
    - '       @ENDIF'
    - '     @ENDIF'
    - '     @ENDIF'
    - ' @ENDSWITCH'
    - '@ENDIF'