Scripts:
  Setup:
    Script:
#   ACTION COSTS
    - '@SETSTR $<var:$Config.WorldName>.<playername>BuildingCategory Flag'
#    - '@SETINT $<var:$Config.WorldName>.PriceFlagEmeraldsToPoints 5'
    - '@PLAYER $<var:$Config.WorldName>.<playername>BuildingCategory Setup Completed'
    - '@SETSTR $<var:$Config.WorldName>.<playername>BuildingCategory Deleted'
  Help:
    Cooldown: 5
    Script:
    - '@PLAYER Opened Flag Help.'
    - '@PLAYER &4 UNDER CONSTRUCTION'
    - '@PLAYER Closed Flag Help.'
  Menu:
    Script:
    - '@SETSTR $HardWorld.<playername>CheckType Y-1Check'
    - '@CALL Shared:BuildingID'
    - '@IF b $HardWorld.<playername>AllowedUse = True'
    - ' @PLAYER Opening Flag Menu'
    - ' @OPENINV Flag'
    - '@ENDIF'
  Attack:
    Cooldown: 5
    Script:
  # PVP Steal points
    - '@IF b $HardWorld.<playername>AllowedUse != True'
    - '@AND i <secondticks:0> >= $HardWorld.<var:$HardWorld.<playername>BuildingOwner>FlagAttackTime'
    - '@AND b $HardWorld.<var:$HardWorld.<playername>BuildingOwner>FlagUnderAttack != True'
    - '@AND b $HardWorld.<var:$HardWorld.<playername>BuildingOwner>OfflineProtection != True'
    - '   @SETSTR $HardWorld.<playername>FlagStolenOwner $HardWorld.<playername>BuildingOwner'
    - '   @BROADCAST &4Team $<playername>.SMTeam is attacking Team $HardWorld.<playername>FlagStolenOwner .
    The attack leader must stay within 25 blocks of the flag until the flags HP reaches 0. &r'
    - '   @PLAYER You are the attack leader. If you die your team will have failed to take the flag.'
    - '   @SETBOOL $HardWorld.<var:$HardWorld.<playername>FlagStolenOwner>FlagUnderAttack True'
    - '   @SETSTR $HardWorld.<playername>FlagLoc $<playername>.CommandBlockLoc'
    - '   @SETINT $HardWorld.<playername>FlagStealCount 0'
    - '   @SETINT $HardWorld.<playername>FlagStealCountTmp 0'
    - '   @SETBOOL $HardWorld.<playername>FlagHold False'
    - '   @SETINT $HardWorld.<playername>FlagHoldTime 0'
    - '   @SETSTR $HardWorld.<playername>FlagAttackStatus Started'
#    - ' @IF i $HardWorld.<var:$HardWorld.<playername>FlagStolenOwner>Score >= -500'
    # PVP Capture the flag Code
#    - '   @LOOP $HardWorld.<var:$HardWorld.<playername>FlagStolenOwner>FlagHP'
    - '   @WHILE s $HardWorld.<playername>FlagAttackStatus = Started'
    - '     @FLAMES 3 <currentloc:<playername>>'
    - '     @PAUSE 5'
    - '     @SETSTR $HardWorld.<playername>FlagCurLocTMP <currentloc:<playername>>'
    - '     @IF i <distance:$HardWorld.<playername>FlagCurLocTMP:$HardWorld.<playername>FlagLoc> >= 26'
    - '       @ADDINT $HardWorld.<playername>DistanceCheckOOB 5'
    - '       @PLAYER You are to far away please move closer. Current Distance <distance:$HardWorld.<playername>FlagCurLocTMP:$HardWorld.<playername>FlagLoc> of the allowed 25 .
    Current time out of bounds $HardWorld.<playername>DistanceCheckOOB out of the allowed 10'
    - '       @IF i $HardWorld.<playername>DistanceCheckOOB >= 10'
    - '@PLAYER &8LOG Script Exit Due to Distance <distance:$HardWorld.<playername>FlagCurLocTMP:$HardWorld.<playername>FlagLoc> is greater then 26'
    - '         @BROADCAST &4Team $<playername>.SMTeam failed to take Team $HardWorld.<playername>FlagStolenOwner flag.&r'
    - '         @SETBOOL $HardWorld.<var:$HardWorld.<playername>FlagStolenOwner>FlagUnderAttack False'
    - '         @SETINT $HardWorld.<playername>DistanceCheckOOB 0'
    - '         @EXIT'
    - '       @ENDIF'
    - '     @ELSE'
    - '       @SETINT $HardWorld.<playername>DistanceCheckOOB 0'
    - '     @ENDIF'
    - '     @ADDINT $HardWorld.<playername>FlagStealCount 5'
    - '     @ADDINT $HardWorld.<playername>FlagStealCountTmp 5'
    - '     @IF i $HardWorld.<playername>FlagStealCountTmp = 10'
    - '       @BROADCAST &4 $HardWorld.<playername>FlagStolenOwner Flag HP Damaged $HardWorld.<playername>FlagStealCount of $HardWorld.<var:$HardWorld.<playername>FlagStolenOwner>FlagHP &r'
    - '       @SETINT $HardWorld.<playername>FlagStealCountTmp 0'
    - '     @ENDIF'
    - '     @IF i $HardWorld.<var:$HardWorld.<playername>FlagStolenOwner>FlagHP <= $HardWorld.<playername>FlagStealCount'
    - '       @SETSTR $HardWorld.<playername>FlagAttackStatus Stolen'
    - '       @SETBOOL $HardWorld.<playername>FlagHold True'
    - '       @BROADCAST Team $<playername>.SMTeam has taken Team $HardWorld.<playername>FlagStolenOwner flag.
    Now they must take it to their flag to capture it.'
    - '     @ENDIF'
    - '   @ENDWHILE'
    - '   @WHILE b $HardWorld.<playername>FlagHold = True'
#    - '     @FIREWORK <var:$HardWorld.<playername>FlagStolenOwner> burst <currentloc:<playername>>'
    - '     @FIREWORK $HardWorld.<var:$HardWorld.<playername>FlagStolenOwner>FlagColorFirework burst <currentloc:<playername>>'
    - '     @CMDCON effect <playername> 2 15 1'
    - '     @BROADCAST Team $HardWorld.<playername>FlagStolenOwner stolen flag location <currentloc:<playername>>'
    - '     @PLAYER Holding the flag slows you down.'
    - '     @PAUSE 15'
    # PVP Hold Stolen Flag Time Limit
    - '     @ADDINT $HardWorld.<playername>FlagHoldTime 1'
    - '     @IF i $HardWorld.<playername>FlagHoldTime = 60'
    - '       @BROADCAST Team $<playername>.SMTeam failed to take Team $HardWorld.<playername>FlagStolenOwner flag.'
    - '       @PLAYER Times up you can only hold an opposing flag for 60 minutes before its returned back to the owner.'
    - '       @SETBOOL $HardWorld.<var:$HardWorld.<playername>FlagStolenOwner>FlagUnderAttack False'
    - '       @SETBOOL $HardWorld.<playername>FlagHold False'
    - '       @EXIT'
    - '     @ENDIF'
    - '   @ENDWHILE'
    # PVP Flag Successfully Stolen
    - '   @PAUSE 5'
    - '   @IF b $HardWorld.<playername>FlagSuccessfullyStolen = True'
    - '     @SUBINT $HardWorld.<var:$HardWorld.<playername>FlagStolenOwner>Score 50'
    - '     @CMDCON scoreboard players remove <var:$HardWorld.<playername>FlagStolenOwner>Total SHard 50'
    - '     @SETBOOL $HardWorld.<playername>FlagSuccessfullyStolen False'
    - '     @SETBOOL $HardWorld.<var:$HardWorld.<playername>FlagStolenOwner>FlagUnderAttack False'
    - '     @SETINT $HardWorld.<var:$HardWorld.<playername>FlagStolenOwner>FlagAttackTime <secondticks:1800>'
    - '   @ENDIF'
    # PVP NOT USED - Control Point Code    
#    - ' @LOOP 600'
#    - '   @FLAMES 3 <currentloc:<playername>>'
#    - '   @PAUSE 1'
#    - '   @SETSTR $HardWorld.<playername>FlagCurLocTMP <currentloc:<playername>>'
#    - '   @IF i <distance:$HardWorld.<playername>FlagCurLocTMP:$HardWorld.<playername>FlagLoc> >= 26'
#    - '@PLAYER &8LOG Script Exit Due to Distance <distance:$HardWorld.<playername>FlagCurLocTMP:$HardWorld.<playername>FlagLoc> is greater then 26'
#    - '       @EXIT'
#    - '   @ENDIF'
#    - '   @ADDINT $HardWorld.<playername>FlagStealCount 1'
#    - ' @ENDLOOP'
#    - ' @IF i $HardWorld.<playername>FlagStealCount = 600'
#    - '   @SUBINT $HardWorld.<var:$HardWorld.<playername>FlagStolenOwner>Score 50'
#    - '   @CMDCON scoreboard players remove <var:$HardWorld.<playername>FlagStolenOwner>Total SHard 50'
#    - '   @PLAYER You have successfully broke into team $HardWorld.<playername>FlagStolenOwner treasury. Gather the emeralds at their flag and return them to your flag!'
#    - '   @SETSTR $HardWorld.<playername>FlagDropLoc <relativeloc:$HardWorld.<playername>FlagLoc:0,2,0>'
#    - '   @DROPITEM emerald 50 NONE $HardWorld.<playername>FlagDropLoc'
#    - ' @ENDIF'
#    - ' @ELSE'
#    - '   @PLAYER Unable to attack flag. The team your attacking has to have a score greater then -500.'
#    - ' @ENDIF'
    - '@ELSE'
    - ' @IF b $HardWorld.<playername>AllowedUse != True'
    - '   @PLAYER Unable to attack flag. The next time you can attack is $HardWorld.<var:$HardWorld.<playername>BuildingOwner>FlagAttackTime and current time is <secondticks:0>'
    - ' @ENDIF'
    - ' @IF b $HardWorld.<playername>AllowedUse = True'
    - '   @PLAYER Unable to attack flag. Your team already owns it.'
    - ' @ENDIF'
    - ' @IF b $HardWorld.<var:$HardWorld.<playername>BuildingOwner>OfflineProtection = True'
    - '   @PLAYER Unable to attack flag. The team your attacking is not online.'
    - ' @ENDIF'
    - '@ENDIF'
  VictoryCondition:
    Cooldown: 0
    Script:
  # Testing for Victory Condition Met.
    - '@IF i $HardWorld.<var:$<playername>.SMTeam>Score >= $Setup.SurvivalWorldVictoryPointsTotal'
    - ' @BROADCAST Team <var:$<playername>.SMTeam> has won the game!'
    - ' @PAUSE 120'
    - ' @BROADCAST For testing purposes the auto reset has been disabled for now! Become OP and type /vt run NewGame:Reset'
#    - '  @CALL NewGame:Reset'
    - '@ELSE'
    - ' @PLAYER Score $HardWorld.<var:$<playername>.SMTeam>Score of $Setup.SurvivalWorldVictoryPointsTotal'
    - '@ENDIF'
  # Testing for beginner worldguard protections
    - '@IF i $HardWorld.<var:$<playername>.SMTeam>Score >= 25'
    - '@AND b $HardWorld.<var:$<playername>.SMTeam>Explosion != True'
    - ' @CMDCON title @a[team=<var:$<playername>.SMTeam>] title {text:"!WARNING!",color:red}' 
    - ' @CMDCON title @a[team=<var:$<playername>.SMTeam>] subtitle {text:"<var:$<playername>.SMTeam> teams creeper protection fades!",color:yellow}' 
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown creeper-explosion allow'
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown other-explosion allow'
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown pvp allow'
    - ' @IF s $Setup.SurvivalWorldDiff = Easy'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 50'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 50'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 50'
    - ' @ENDIF'
    - ' @IF s $Setup.SurvivalWorldDiff = Medium'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 100'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 100'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 100'
    - ' @ENDIF'
    - ' @IF s $Setup.SurvivalWorldDiff = Hard'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 150'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 150'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 150'
    - ' @ENDIF'
    - ' @SETBOOL $HardWorld.<var:$<playername>.SMTeam>Explosion True'
    - '@ENDIF'
    - '@IF i $HardWorld.<var:$<playername>.SMTeam>Score >= 50'
    - '@AND b $HardWorld.<var:$<playername>.SMTeam>MobSpawning != True'
    - ' @CMDCON title @a[team=<var:$<playername>.SMTeam>] title {text:"!WARNING!",color:red}' 
    - ' @CMDCON title @a[team=<var:$<playername>.SMTeam>] subtitle {text:"<var:$<playername>.SMTeam> teams monster spawn protection fades!",color:yellow}'        
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown deny-spawn'
    - ' @IF s $Setup.SurvivalWorldDiff = Easy'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 75'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 75'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 75'
    - ' @ENDIF'
    - ' @IF s $Setup.SurvivalWorldDiff = Medium'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 150'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 150'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 150'
    - ' @ENDIF'
    - ' @IF s $Setup.SurvivalWorldDiff = Hard'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 200'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 200'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 200'
    - ' @ENDIF'
    - ' @SETBOOL $HardWorld.<var:$<playername>.SMTeam>MobSpawning True'
    - '@ENDIF'
    - '@IF i $HardWorld.<var:$<playername>.SMTeam>Score >= 75'
    - '@AND b $HardWorld.<var:$<playername>.SMTeam>MobSpawn200 != True'
    - ' @CMDCON title @a title {text:"!WARNING!",color:red}' 
    - ' @CMDCON title @a subtitle {text:"<var:$<playername>.SMTeam> teams actions has caused the horde to grow!",color:yellow}'   
    - ' @IF s $Setup.SurvivalWorldDiff = Easy'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 100'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 100'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 100'
    - ' @ENDIF'
    - ' @IF s $Setup.SurvivalWorldDiff = Medium'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 200'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 200'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 200'
    - ' @ENDIF'
    - ' @IF s $Setup.SurvivalWorldDiff = Hard'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 250'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 250'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 250'
    - ' @ENDIF'
    - ' @SETBOOL $HardWorld.<var:$<playername>.SMTeam>MobSpawn200 True'
    - '@ENDIF'
  Power:
    Cooldown: 5
    Script:
    # NOT DONE COPYING FROM Traps.script.yml and any (Building).script.yml
#    - '@CALL Shared:BuildingID'
#    - '@CALL Shared:Upkeep'
#    - '@IF b $HardWorld.<playername>AllowedUse = True'
    - ' @CALL Flag:Colors'
  # PVP depositing stolen flag
    - ' @IF b $HardWorld.<playername>FlagHold = True'
    - ' @AND s $<playername>.FoundCommandBlock = True'
    - '   @SETBOOL $HardWorld.<playername>FlagSuccessfullyStolen True'
    - '   @SETBOOL $HardWorld.<playername>FlagHold False'
    - '   @CMDCON scoreboard players add <playername> LHard 50'
    - '   @CMDCON scoreboard players add <var:$<playername>.SMTeam>Total SHard 50'
    - '   @ADDINT $HardWorld.<var:$<playername>.SMTeam>Score 50'
    - '   @ADDINT $HardWorld.<playername>Score 50'
    - '   @BROADCAST Team $<playername>.SMTeam has succesfully stolen Team $HardWorld.<playername>BuildingOwner flag and returned it to their own flag.'
  # Testing for Victory Condition Met.
    - '   @CALL Flag:VictoryCondition'
    - ' @ENDIF'
  # Claiming Land  
    - ' @IF s $HardWorld.<playername>Select = claimland'
    - ' @AND s $<playername>.FoundCommandBlock = True'
    - '   @IF i $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSize <= 28'
    - '     @SETINT $HardWorld.<playername>PriceSelected 5'
    - '   @ELSE'
    - '     @IF i $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSize <= 52'
    - '       @SETINT $HardWorld.<playername>PriceSelected 10'
    - '     @ELSE'
    - '       @IF i $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSize <= 104'
    - '         @SETINT $HardWorld.<playername>PriceSelected 20'
    - '       @ELSE'
    - '         @IF i $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSize > 208'
    - '           @SETINT $HardWorld.<playername>PriceSelected 40'
    - '         @ELSE'
    - '           @IF i $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSize > 1000'
    - '             @PLAYER Town size limit of 1000 expansions met you can no longer expand your town.'
    - '             @EXIT'
    - '           @ENDIF'
    - '         @ENDIF'
    - '       @ENDIF'
    - '     @ENDIF'
    - '   @ENDIF'
    - '   @SETBOOL $HardWorld.<playername>PriceSelectedBool True'
    - '   @CALL Shared:Price'
    - '   @SETBOOL $HardWorld.<playername>PriceSelectedBool False'
    - '   @IF b $HardWorld.<playername>PriceCheck = true'
    - '     @ADDINT $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSize 4'
    - '     @ADDINT $HardWorld.<var:$HardWorld.<playername>BuildingTown>FlagHP $HardWorld.<playername>PriceSelected'
    - '     @SETSTR $HardWorld.<playername>TempVarName $HardWorld.<playername>BuildingTown'
    - '     @ADDSTR $HardWorld.<playername>TempVarName TownSize<var:$HardWorld.<playername>SelectClaimLandDirection>'
    - '     @ADDINT $HardWorld.<var:$HardWorld.<playername>TempVarName> 4'
    - '     @SETSTR $HardWorld.<playername>CoordsFixed $<playername>.CommandBlockLoc'
    - '     @CALL Shared:CleanCoords'
    - '     @CMDOP /pos1 $HardWorld.<playername>CoordsFixed'
    - '     @CMDOP /pos2 $HardWorld.<playername>CoordsFixed'
    - '     @CMDOP /expand $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizeeast $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizewest east'
    - '     @CMDOP /expand $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizenorth $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizesouth north'
    - '     @CMDOP /expand $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizeup $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizedown up'
    - '     @PAUSE 1'
    - '     @CMDOP region redefine $HardWorld.<playername>BuildingTown'
    - '   @ENDIF'
    - ' @ENDIF'
  # Adding points to scoreboard display and variabletriggers int variable.    
#    - ' @IF i <itemid> = 388'
#    - '     @SETSTR $HardWorld.<playername>Action EmeraldsToPoints'
#    - '     @CALL Shared:Price'
    - ' @IF s $HardWorld.<playername>Select = deposit'
    - ' @AND s $<playername>.FoundCommandBlock = True'
    - '     @SETINT $HardWorld.<playername>PriceSelected $HardWorld.<playername>SelectDepositAmt'
    - '     @SETBOOL $HardWorld.<playername>PriceSelectedBool True'    
    - '     @CALL Shared:Price'
    - '     @SETBOOL $HardWorld.<playername>PriceSelectedBool False'
    - '     @IF b $HardWorld.<playername>PriceCheck = true'
    - '       @CMDCON scoreboard players add <playername> LHard $HardWorld.<playername>PriceSelected'
    - '       @CMDCON scoreboard players add <var:$<playername>.SMTeam>Total SHard $HardWorld.<playername>PriceSelected'
    - '       @ADDINT $HardWorld.<var:$<playername>.SMTeam>Score $HardWorld.<playername>PriceSelected'
    - '       @ADDINT $HardWorld.<playername>Score $HardWorld.<playername>PriceSelected'
    - '       @SETSTR $HardWorld.<playername>Select Deleted'
    - '       @SETINT $HardWorld.<playername>SelectDepositAmt 0'
    - '       @SETBOOL $HardWorld.<playername>PriceSelectedBool False'
  # Testing for Victory Condition Met.
    - '       @CALL Flag:VictoryCondition'
  # Testing for Gifts met.
    - '       @IF i $HardWorld.<playername>Score = 5'
    - '       @AND b $HardWorld.<playername>ScoreGift1 != True'
    - '         @PLAYER For your dedication to the cause you have been gifted a wand of arrows.'
    - '         @CMDOP wand arrow_gift'
    - '         @SETBOOL $HardWorld.<playername>ScoreGift1 True'
    - '       @ENDIF'
    - '       @IF i $HardWorld.<playername>Score = 10'
    - '       @AND b $HardWorld.<playername>ScoreGift2 != True'
    - '         @PLAYER For your dedication to the cause you have been gifted a wand of arrows.'
    - '         @CMDOP wand arrow_gift2'
    - '         @SETBOOL $HardWorld.<playername>ScoreGift2 True'
    - '       @ENDIF'
    - '       @IF i $HardWorld.<playername>Score = 20'
    - '       @AND b $HardWorld.<playername>ScoreGift3 != True'
    - '         @PLAYER For your dedication to the cause you have been gifted a wand of arrows.'
    - '         @CMDOP wand arrow_gift3'
    - '         @SETBOOL $HardWorld.<playername>ScoreGift3 True'
    - '       @ENDIF'
    - '       @IF i $HardWorld.<playername>Score = 40'
    - '       @AND b $HardWorld.<playername>ScoreGift4 != True'
    - '         @PLAYER For your dedication to the cause you have been gifted a wand of arrows.'
    - '         @CMDOP wand fireball_gift'
    - '         @SETBOOL $HardWorld.<playername>ScoreGift4 True'
    - '       @ENDIF'
    - '     @ENDIF'
#    - ' @ELSE'
  # Call Help File
#    - '   @PLAYER Type /mi help Flag - FOR HELP.'
    - ' @ENDIF'
#    - '@ELSE'
#    - ' @PLAYER Team $HardWorld.<playername>BuildingOwner Flag.'
#    - '@ENDIF'
  Settle:
    Script:
# FOR Testing /vtrigger delvar b natersteen Settled
    - '@IF s <worldname> = $Config.WorldName'
    - '@AND b $<var:$<playername>.SMTeam>.Settled != True'
    - ' @OPENINV LOADING'
    - ' @SETSTR $HardWorld.<playername>ActivePlans Flag'
    - ' @SETSTR $HardWorld.<playername>CurrentTown $<playername>.SMTeam'
    - ' @SETBOOL $HardWorld.<playername>FlagSetup True'
    - ' @POOF 5 <playerloc>'
    - ' @EXPLOSION 0.0 <playerloc>'
    - ' @CMDOP /schematic load flag_survival_match'
    - ' @PAUSE 1'
    - ' @OPENINV LOADING1'
    - ' @CMDOP /paste -a'
    - ' @SETSTR $<playername>.FoundCommandBlock 0'
    - ' @SETINT $HardWorld.<playername>SettleCounter 0'
    - ' @WHILE s $<playername>.FoundCommandBlock != True'
    - '   @PAUSE 2'
    - '   @SETSTR $HardWorld.<playername>CheckType SpiralCheck'
    - '   @CALL Shared:FindCommandBlock'
    - '   @ADDINT $HardWorld.<playername>SettleCounter 1'
    - '   @IF i $HardWorld.<playername>SettleCounter >= 30'
    - '     @SETINT $HardWorld.<playername>SettleCounter 0'
    - '     @CLOSEINV <playername>'
    - '     @PLAYER You must return to your flag and stand near the commandblock now! Otherwise you will lose the game!'
    - '   @ENDIF'
    - ' @ENDWHILE'
    - ' @OPENINV LOADING7'
    - ' @PAUSE 0.2'
    - ' @SETSTR $<playername>.AboveCommandBlockLoc <relativeloc:$<playername>.CommandBlockLoc:0,1,0>'
    - ' @TP $<playername>.AboveCommandBlockLoc'
    - ' @PAUSE 0.2'
    - ' @OPENINV LOADING8'
    - ' @SETSTR $HardWorld.<playername>CoordsFixed $<playername>.CommandBlockLoc'
    - ' @CALL Shared:CleanCoords'
    - ' @CMDOP /pos1 $HardWorld.<playername>CoordsFixed'
    - ' @CMDOP /pos2 $HardWorld.<playername>CoordsFixed'
    - ' @CMDOP /expand 20 20 east'
    - ' @CMDOP /expand 20 20 north'
    - ' @CMDOP /expand 30 10 up'
    - ' @CMDOP region define $HardWorld.<playername>CurrentTown g:members <playername>'
    - ' @PAUSE 1'
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown use deny'    
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown use -g nonmembers'
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown sleep deny'    
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown sleep -g nonmembers'
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown greeting Entered $<playername>.SMTeam Team Territory'
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown farewell Left $<playername>.SMTeam Team Territory'
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown deny-spawn CAVE_SPIDER,CREEPER,ENDER_DRAGON,ENDERMAN,GHAST,GIANT,MAGMA_CUBE,SKELETON,SLIME,SPIDER,WITCH,ZOMBIE'
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown creeper-explosion deny'
    - ' @CMDCON region flag -w HardWorld $HardWorld.<playername>CurrentTown other-explosion deny' 
    - ' @PAUSE 1'
    - ' @CMDOP /replace 80 0'
    - ' @SETBOOL $<var:$<playername>.SMTeam>.Settled True'
    - ' @SETINT $HardWorld.<var:$HardWorld.<playername>CurrentTown>TownCopyBlocks 1'
    - ' @SETINT $HardWorld.<var:$HardWorld.<playername>CurrentTown>TownSize 1'
    - ' @SETINT $HardWorld.<var:$HardWorld.<playername>CurrentTown>TownSizeeast 20'
    - ' @SETINT $HardWorld.<var:$HardWorld.<playername>CurrentTown>TownSizewest 20'
    - ' @SETINT $HardWorld.<var:$HardWorld.<playername>CurrentTown>TownSizenorth 20'
    - ' @SETINT $HardWorld.<var:$HardWorld.<playername>CurrentTown>TownSizesouth 20'
    - ' @SETINT $HardWorld.<var:$HardWorld.<playername>CurrentTown>TownSizeup 30'
    - ' @SETINT $HardWorld.<var:$HardWorld.<playername>CurrentTown>TownSizedown 10'
    - ' @SETINT $HardWorld.<var:$HardWorld.<playername>CurrentTown>FlagHP 150'
    - ' @PLAYER Land claimed for team <var:$<playername>.SMTeam>. This is your teams Flag. Protect it with your lives!'
    - ' @CMDOP vt setloc HardWorld <var:$<playername>.SMTeam>FlagSpawn'
    - ' @CMDOP setwarp <var:$<playername>.SMTeam>Flag'
    - ' @CMDOP spawnpoint <playername>'
    - ' @CMDOP climb off'
    - ' @SETSTR $HardWorld.<playername>ActivePlans Flag'
    - ' @SETSTR $<var:$<playername>.SMTeam>.TeamSpawnSet true'
    - ' @CMDCON title @a title {text:"Team <var:$<playername>.SMTeam> Ready",color:red}'
    - ' @CMDCON title @a subtitle {text:"type /mi - START GAME - to join your team leader.",color:yellow}'
    - ' @BROADCAST Team <var:$<playername>.SMTeam> spawn is set.'
    - ' @SETSTR $HardWorld.<playername>CheckType SpiralCheck'
    - ' @CALL Shared:BuildingLedger'
    - ' @CLOSEINV <playername>'
    - ' @PAUSE 1'
    - ' @CALL Flag:Colors'
    - '@ELSE'
    - ' @PLAYER You already created your first free settlement or else something else went wrong. Contact an admin if your team has no flag.'
    - '@ENDIF'
  Colors:
    Script:
  # Set Flag color based on Team Color
    - '@SETBOOL $HardWorld.<playername>FlagDamaged False'
    - '@SETINT $HardWorld.<playername>FlagDamageCount 0'
    - '@GETBLOCK $HardWorld.<playername>FlagStick01 <relativeloc:$<playername>.CommandBlockLoc:0,1,-1>'
    - '@IF i <playerloc:y> <= 150'
    - ' @SETINT $HardWorld.<playername>FlagHeight 150'
    - ' @SUBINT $HardWorld.<playername>FlagHeight <playerloc:y>'
    - ' @IF b $HardWorld.<var:$<playername>.SMTeam>FlagRaised != True'
    - '   @SETSTR $HardWorld.<playername>FlagStickLoc <relativeloc:$<playername>.CommandBlockLoc:0,1,-1>'
    - '   @LOOP $HardWorld.<playername>FlagHeight'
    - '     @SETBLOCK 85 <relativeloc:$HardWorld.<playername>FlagStickLoc:0,1,0>'
    - '     @SETSTR $HardWorld.<playername>FlagStickLoc <relativeloc:$HardWorld.<playername>FlagStickLoc:0,1,0>'
    - '   @ENDLOOP'
    - ' @ENDIF'
    - '@ELSE'
    - ' @SETINT $HardWorld.<playername>FlagHeight 6'
    - '@ENDIF'
    - '@SUBINT $HardWorld.<playername>FlagHeight 1'
    - '@GETBLOCK $HardWorld.<playername>FlagColor040 <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,0>'
    - '@IF s $HardWorld.<playername>FlagColor040 != $HardWorld.<playername>FlagColorBlockID'
    - ' @SETBLOCK $HardWorld.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,0>'
    - ' @ADDINT $HardWorld.<playername>FlagDamageCount 1'
    - ' @SETBOOL $HardWorld.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@GETBLOCK $HardWorld.<playername>FlagColor041 <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,1>'
    - '@IF s $HardWorld.<playername>FlagColor041 != $HardWorld.<playername>FlagColorBlockID'
    - ' @SETBLOCK $HardWorld.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,1>'
    - ' @ADDINT $HardWorld.<playername>FlagDamageCount 1'
    - ' @SETBOOL $HardWorld.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@GETBLOCK $HardWorld.<playername>FlagColor042 <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,2>'
    - '@IF s $HardWorld.<playername>FlagColor042 != $HardWorld.<playername>FlagColorBlockID'
    - ' @SETBLOCK $HardWorld.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,2>'
    - ' @ADDINT $HardWorld.<playername>FlagDamageCount 1'
    - ' @SETBOOL $HardWorld.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@ADDINT $HardWorld.<playername>FlagHeight 1'
    - '@GETBLOCK $HardWorld.<playername>FlagColor050 <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,0>'
    - '@IF s $HardWorld.<playername>FlagColor050 != $HardWorld.<playername>FlagColorBlockID'
    - ' @SETBLOCK $HardWorld.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,0>'
    - ' @ADDINT $HardWorld.<playername>FlagDamageCount 1'
    - ' @SETBOOL $HardWorld.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@GETBLOCK $HardWorld.<playername>FlagColor051 <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,1>'
    - '@IF s $HardWorld.<playername>FlagColor051 != $HardWorld.<playername>FlagColorBlockID'
    - ' @SETBLOCK $HardWorld.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,1>'
    - ' @ADDINT $HardWorld.<playername>FlagDamageCount 1'
    - ' @SETBOOL $HardWorld.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@GETBLOCK $HardWorld.<playername>FlagColor052 <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,2>'
    - '@IF s $HardWorld.<playername>FlagColor052 != $HardWorld.<playername>FlagColorBlockID'
    - ' @SETBLOCK $HardWorld.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,2>'
    - ' @ADDINT $HardWorld.<playername>FlagDamageCount 1'
    - ' @SETBOOL $HardWorld.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@ADDINT $HardWorld.<playername>FlagHeight 1'
    - '@GETBLOCK $HardWorld.<playername>FlagColor060 <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,0>'
    - '@IF s $HardWorld.<playername>FlagColor060 != $HardWorld.<playername>FlagColorBlockID'
    - ' @SETBLOCK $HardWorld.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,0>'
    - ' @ADDINT $HardWorld.<playername>FlagDamageCount 1'
    - ' @SETBOOL $HardWorld.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@GETBLOCK $HardWorld.<playername>FlagColor061 <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,1>'
    - '@IF s $HardWorld.<playername>FlagColor061 != $HardWorld.<playername>FlagColorBlockID'
    - ' @SETBLOCK $HardWorld.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,1>'
    - ' @ADDINT $HardWorld.<playername>FlagDamageCount 1'
    - ' @SETBOOL $HardWorld.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@GETBLOCK $HardWorld.<playername>FlagColor062 <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,2>'
    - '@IF s $HardWorld.<playername>FlagColor062 != $HardWorld.<playername>FlagColorBlockID'
    - ' @SETBLOCK $HardWorld.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$HardWorld.<playername>FlagHeight,2>'
    - ' @ADDINT $HardWorld.<playername>FlagDamageCount 1'
    - ' @SETBOOL $HardWorld.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@IF b $HardWorld.<var:$<playername>.SMTeam>FlagRaised != True'
    - ' @PLAYER You raise your Team $<playername>.SMTeam Flag'
    - ' @SETBOOL $HardWorld.<playername>FlagDamaged False'
    - ' @SETINT $HardWorld.<playername>FlagDamageCount 0'
    - ' @SETBOOL $HardWorld.<var:$<playername>.SMTeam>FlagRaised True'
    - '@ENDIF'
    - '@IF b $HardWorld.<playername>FlagDamaged = True'
    - ' @PLAYER Your Team $<playername>.SMTeam Flag was damaged. Repairing the flag and subtracting $HardWorld.<playername>FlagDamageCount points!'
    - ' @SUBINT $HardWorld.<var:$<playername>.SMTeam>Score $HardWorld.<playername>FlagDamageCount'
    - ' @CMDCON scoreboard players remove <var:$<playername>.SMTeam>Total SHard $HardWorld.<playername>FlagDamageCount'
    - ' @SETINT $HardWorld.<playername>FlagDamageCount 0'
    - ' @SETBOOL $HardWorld.<playername>FlagDamaged False'
    - '@ENDIF'
  IEvent:
    Script:
    - '@IF s <inventorytitle> ?= Flag'
    - ' @SWITCH i <clickedslot>'
    - '   @CASE 17'
    - '     @CALL Flag:Help'
    - '   @CASE 8'
    - '     @CMDOP vt run Flag:Power <playername>'
    - '     @CLOSEINV <playername>'
    - '   @CASE 9'
    - '     @SETSTR $HardWorld.<playername>Select claimland'
    - '     @SETSTR $HardWorld.<playername>SelectClaimLandDirection east'
    - '     @PLAYER Claimland direction set to $HardWorld.<playername>SelectClaimLandDirection'
    - '   @CASE 10'
    - '     @SETSTR $HardWorld.<playername>Select claimland'
    - '     @SETSTR $HardWorld.<playername>SelectClaimLandDirection west'
    - '     @PLAYER Claimland direction set to $HardWorld.<playername>SelectClaimLandDirection'
    - '   @CASE 11'
    - '     @SETSTR $HardWorld.<playername>Select claimland'
    - '     @SETSTR $HardWorld.<playername>SelectClaimLandDirection north'
    - '     @PLAYER Claimland direction set to $HardWorld.<playername>SelectClaimLandDirection'
    - '   @CASE 12'
    - '     @SETSTR $HardWorld.<playername>Select claimland'
    - '     @SETSTR $HardWorld.<playername>SelectClaimLandDirection south'
    - '     @PLAYER Claimland direction set to $HardWorld.<playername>SelectClaimLandDirection'
    - '   @CASE 13'
    - '     @SETSTR $HardWorld.<playername>Select claimland'
    - '     @SETSTR $HardWorld.<playername>SelectClaimLandDirection up'
    - '     @PLAYER Claimland direction set to $HardWorld.<playername>SelectClaimLandDirection'
    - '   @CASE 14'
    - '     @SETSTR $HardWorld.<playername>Select claimland'
    - '     @SETSTR $HardWorld.<playername>SelectClaimLandDirection down'
    - '     @PLAYER Claimland direction set to $HardWorld.<playername>SelectClaimLandDirection'
    - '   @CASE 15'
    - '     @CMDOP vt run Flag:Power <playername>'
    - '     @CLOSEINV <playername>'
    - '   @CASE 3'
    - '     @CLOSEINV <playername>'
    - '     @GETSTRLEN $HardWorld.<playername>TechSelectStrLen $HardWorld.<var:$<playername>.SMTeam>TechResearching'
    - '     @IF i $HardWorld.<playername>TechSelectStrLen >= 2'
    - '       @SETSTR $HardWorld.<playername>TechSelectedTMP $<playername>.SMTeam'
    - '       @ADDSTR $HardWorld.<playername>TechSelectedTMP $HardWorld.<var:$<playername>.SMTeam>TechResearching'
    - '       @SETSTR $HardWorld.<playername>TechSelectedTMP2 $HardWorld.<var:$<playername>.SMTeam>TechResearching'
    - '       @PLAYER Teams current technology selection is $HardWorld.<var:$<playername>.SMTeam>TechResearching and is $HardWorld.<var:$HardWorld.<playername>TechSelectedTMP>RP of $HardWorld.RPPrice<var:$HardWorld.<playername>TechSelectedTMP2> RP from being discovered.' 
    - '     @ELSE'
    - '       @PLAYER Your team has not selected a technology to research. Please select one now.'
    - '     @ENDIF'
    - '     @PAUSE 0.2'
    - '     @OPENINV Technology'
    - '   @CASE 0'
    - '     @CALL Flag:SaveSchematic'
    - '     @CLOSEINV <playername>'
    - '   @CASE 1'
    - '     @CALL Flag:Repair'
    - '     @CLOSEINV <playername>'
    - ' @ENDSWITCH'
    - '@ENDIF'    
  Repair:
    Script:
    - '@IF s $HardWorld.<var:$<playername>.SMTeam>TerSaved = Saved'
    - '@IF i <secondticks:0> >= $HardWorld.<var:$HardWorld.<playername>BuildingTown>FlagRepairTime'
    - ' @SETINT $HardWorld.<var:$HardWorld.<playername>BuildingTown>FlagRepairTime <secondticks:600>'
    - ' @CMDOP npc create BobTheBuilder --trait builder'
    - ' @PAUSE 0.5'
    - ' @CMDOP builder timeout 0.5'
    - ' @CMDOP builder supply true'
    - ' @CMDOP npc lookclose'
    - ' @CMDOP builder load HardWorld<var:$HardWorld.<playername>BuildingTown><var:$HardWorld.<playername>BuildingCategory>'
    - ' @PAUSE 1'
    - ' @CMDOP builder origin $HardWorld.<var:$<playername>.SMTeam>PlanLoc'
#    - ' @CMDOP builder origin schematic'
    - ' @PAUSE 0.5'
    - ' @CMDOP builder build ignoreair oncomplete:<var:$HardWorld.<playername>BuildingCategory>RepairComplete'
    - '@ELSE'
    - ' @SETINT $HardWorld.<var:$HardWorld.<playername>BuildingTown>FlagRepairTimeLeft $HardWorld.<var:$HardWorld.<playername>BuildingTown>FlagRepairTime'
    - ' @SUBINT $HardWorld.<var:$HardWorld.<playername>BuildingTown>FlagRepairTimeLeft <secondticks:0>'
    - ' @PLAYER $HardWorld.<var:$HardWorld.<playername>BuildingTown>FlagRepairTimeLeft Seconds left before you can repair this town again.'
    - '@ENDIF'
    - '@ELSE'
    - '@PLAYER You must first save your territory before you repair it.'
    - '@ENDIF'
  RepairComplete:
    Script:
    - '@PLAYER Repair Complete. Code not completed should restore flags health.'
  SaveSchematic:
    Script:
    # FORMULA ((E+W+1)/2)-W=X
    # E=East
    # W=West
    # X=Relative Location To Move on X axis.
    # FORMULA ((S+N+1)/2)-N=Z
    # S=South
    # N=North
    # Z=Relative Location To Move on Z axis.
    # All equations will round 0.5 down.
    - '@OPENINV LOADING'
    - '@CMDCON title @a[team=<var:$<playername>.SMTeam>] title {text:"Cleaning Litter",color:red}'
    - '@CMDCON title @a[team=<var:$<playername>.SMTeam>] subtitle {text:"During territory saves all dropped items will be removed.",color:yellow}'
    - '@SETINT $HardWorld.<playername>PlanLocX $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizeeast'
    - '@ADDINT $HardWorld.<playername>PlanLocX $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizewest'
    - '@ADDINT $HardWorld.<playername>PlanLocX 1'
    - '@DIVINT $HardWorld.<playername>PlanLocX 2'
    - '@SUBINT $HardWorld.<playername>PlanLocX $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizewest'
    - '@PLAYER &8LOG PlanLoc set to $HardWorld.<playername>PlanLocX , $HardWorld.<playername>PlanLocY , $HardWorld.<playername>PlanLocZ'
    - '@SETINT $HardWorld.<playername>PlanLocY 0' 
    - '@SUBINT $HardWorld.<playername>PlanLocY $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizedown'
    - '@SETINT $HardWorld.<playername>PlanLocZ $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizesouth'
    - '@ADDINT $HardWorld.<playername>PlanLocZ $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizenorth'
    - '@ADDINT $HardWorld.<playername>PlanLocZ 1'
    - '@DIVINT $HardWorld.<playername>PlanLocZ 2'    
    - '@SUBINT $HardWorld.<playername>PlanLocZ $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizenorth'
    - '@PLAYER &8LOG PlanLoc set to $HardWorld.<playername>PlanLocX , $HardWorld.<playername>PlanLocY , $HardWorld.<playername>PlanLocZ'
    - '@SETSTR $HardWorld.<playername>CoordsFixed $<playername>.CommandBlockLoc'
    - '@CALL Shared:CleanCoords'
    - '@CMDOP /clearhistory'
    - '@PAUSE 0.2'
    - '@CMDOP /pos1 $HardWorld.<playername>CoordsFixed'
    - '@CMDOP /pos2 $HardWorld.<playername>CoordsFixed'
    - '@SETSTR $HardWorld.<playername>PlanLoc $HardWorld.<playername>CoordsFixed'
    - '@SETSTR $HardWorld.<playername>PlanLoc <relativeloc:$HardWorld.<playername>PlanLoc:$HardWorld.<playername>PlanLocX,$HardWorld.<playername>PlanLocY,$HardWorld.<playername>PlanLocZ>'
    - '@SETSTR $HardWorld.<playername>CoordsFixed $HardWorld.<playername>PlanLoc'
    - '@CALL Shared:CleanCoords'
    - '@SETSTR $HardWorld.<var:$<playername>.SMTeam>PlanLoc $HardWorld.<playername>CoordsFixed'
    - '@PLAYER &8LOG Builder Origin Set To $HardWorld.<var:$<playername>.SMTeam>PlanLoc'
    - '@OPENINV LOADING1'
    - '@CMDOP /expand $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizeeast $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizewest east'
    - '@CMDOP /expand $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizenorth $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizesouth north'
    - '@CMDOP /expand $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizeup $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizedown up'
    # This prevents duping in containers
    - '@CMDOP /replace 6,14,15,16,17,18,21,23,30,31,32,37,38,39,40,54,56,59,61,62,73,74,83,81,86,99,100,103,104,105,111,115,117,127,129,141,142,145,146,153,154,158,162,175 0'
    - '@PAUSE 0.2'
    - '@SETSTR $<playername>.AboveCommandBlockLoc <relativeloc:$<playername>.CommandBlockLoc:0,1,0>'
    - '@TP $<playername>.AboveCommandBlockLoc'
    - '@PAUSE 0.2'
    - '@OPENINV LOADING2'
    - '@CMDOP /copy'
    - '@CMDOP /schematic save HardWorld<var:$HardWorld.<playername>BuildingTown><var:$HardWorld.<playername>BuildingCategory>'
    - '@CMDOP /distr'
    - '@IF s $HardWorld.<var:$<playername>.SMTeam>TerSaved != Saved'
    - ' @SETSTR $HardWorld.<var:$<playername>.SMTeam>TerSaved Saved'
    - '@ENDIF'
    - '@PAUSE 0.1'
    - '@OPENINV LOADING6'
    - '@CMDOP /undo'
    # Get region radius
    - '@SETINT $HardWorld.<playername>TownSizeRew $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizeeast'
    - '@ADDINT $HardWorld.<playername>TownSizeRew $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizewest'
    - '@SETINT $HardWorld.<playername>TownSizeRns $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizenorth'
    - '@ADDINT $HardWorld.<playername>TownSizeRns $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizesouth'
    - '@SETINT $HardWorld.<playername>TownSizeRud $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizeup'
    - '@ADDINT $HardWorld.<playername>TownSizeRud $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizedown'
    - '@IF i $HardWorld.<playername>TownSizeRew > $HardWorld.<playername>TownSizeRns'
    - '@AND i $HardWorld.<playername>TownSizeRew > $HardWorld.<playername>TownSizeRud'
    - ' @SETINT $HardWorld.<playername>TownSizeRadius $HardWorld.<playername>TownSizeRew'
    - '@ELSE'
    - ' @IF i $HardWorld.<playername>TownSizeRns > $HardWorld.<playername>TownSizeRud'
    - '   @SETINT $HardWorld.<playername>TownSizeRadius $HardWorld.<playername>TownSizeRns'
    - ' @ELSE'
    - '   @SETINT $HardWorld.<playername>TownSizeRadius $HardWorld.<playername>TownSizeRud'
    - ' @ENDIF'
    - '@ENDIF'
    - '@CMDOP remove items $HardWorld.<playername>TownSizeRadius'
    - '@PAUSE 0.2'
    - '@OPENINV LOADING8'
#    - '@PLAYER $HardWorld.<playername>BuildingCategory Schematic has been saved.'
  OLDSaveSchematic:
    Script:
    - '@SETINT $HardWorld.<var:$<playername>.SMTeam>PlanLocX <playerloc:x>'
    - '@ADDINT $HardWorld.<var:$<playername>.SMTeam>PlanLocX $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizeeast'
    - '@SUBINT $HardWorld.<var:$<playername>.SMTeam>PlanLocX $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizewest'    
    - '@SETINT $HardWorld.<var:$<playername>.SMTeam>PlanLocY <playerloc:y>'
    - '@SUBINT $HardWorld.<var:$<playername>.SMTeam>PlanLocY $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizedown'
    - '@SETINT $HardWorld.<var:$<playername>.SMTeam>PlanLocZ <playerloc:z>'
    - '@SUBINT $HardWorld.<var:$<playername>.SMTeam>PlanLocZ $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizenorth'
    - '@ADDINT $HardWorld.<var:$<playername>.SMTeam>PlanLocZ $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizesouth'
    - '@SETSTR $HardWorld.<var:$<playername>.SMTeam>PlanLoc $HardWorld.<var:$<playername>.SMTeam>PlanLocX'
    - '@ADDSTR $HardWorld.<var:$<playername>.SMTeam>PlanLoc ,$HardWorld.<var:$<playername>.SMTeam>PlanLocY'
    - '@ADDSTR $HardWorld.<var:$<playername>.SMTeam>PlanLoc ,$HardWorld.<var:$<playername>.SMTeam>PlanLocZ'
    - '@PLAYER &8LOG Builder Origin Set To $HardWorld.<var:$<playername>.SMTeam>PlanLoc'
    - '@CMDOP /pos1'
    - '@CMDOP /pos2'
    - '@CMDOP /expand $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizeeast $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizewest east'
    - '@CMDOP /expand $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizenorth $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizesouth north'
    - '@CMDOP /expand $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizeup $HardWorld.<var:$HardWorld.<playername>BuildingTown>TownSizedown up'
    # This prevents duping in containers
    - '@CMDOP /replace 54 0'
    - '@CMDOP /replace 61 0'
    - '@CMDOP /replace 62 0'    
    - '@CMDOP /replace 23 0'
    - '@CMDOP /replace 158 0'
    - '@CMDOP /replace 342 0'
    - '@CMDOP /replace 379 0'
    - '@CMDOP /replace 408 0'
    - '@PAUSE 1'
    - '@CMDOP /copy'
    - '@CMDOP /schematic save HardWorld<var:$HardWorld.<playername>BuildingTown><var:$HardWorld.<playername>BuildingCategory>'
    - '@PAUSE 2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PLAYER $HardWorld.<playername>BuildingCategory Schematic has been saved.'
    