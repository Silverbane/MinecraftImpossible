Scripts:
  Setup:
    Script:
#   ACTION COSTS
    - '@SETSTR $<var:$Config.WorldName>.<playername>BuildingCategory Flag'
#    - '@SETINT $<var:$Config.WorldName>.PriceFlagEmeraldsToPoints 5'
    - '@PLAYER $<var:$Config.WorldName>.<playername>BuildingCategory Setup Completed'
    - '@SETSTR $<var:$Config.WorldName>.<playername>BuildingCategory Deleted'
  Help:
    Cooldown: 5
    Script:
    - '@PLAYER Opened Flag Help.'
    - '@PLAYER &4 UNDER CONSTRUCTION'
    - '@PLAYER Closed Flag Help.'
  Menu:
    Script:
    - '@SETSTR $<worldname>.<playername>CheckType Y-1Check'
    - '@CALL Shared:BuildingID'
    - '@IF b $<worldname>.<playername>AllowedUse = True'
    - ' @PLAYER Opening Flag Menu'
    - ' @OPENINV Flag'
    - '@ENDIF'
  Attack:
    Cooldown: 5
    Script:
  # PVP Steal points
    - '@IF b $<worldname>.<playername>AllowedUse != True'
    - '@AND i <secondticks:0> >= $<worldname>.<var:$<worldname>.<playername>BuildingOwner>FlagAttackTime'
    - '@AND b $<worldname>.<var:$<worldname>.<playername>BuildingOwner>FlagUnderAttack != True'
    - ' @SETSTR $<worldname>.<playername>FlagStolenOwner $<worldname>.<playername>BuildingOwner'
    - ' @BROADCAST &4Team $<playername>.SMTeam is attacking Team $<worldname>.<playername>FlagStolenOwner .
    The attack leader must stay within 25 blocks of the flag until the flags HP reaches 0. &r'
    - ' @PLAYER You are the attack leader. If you die your team will have failed to take the flag.'
    - ' @SETBOOL $<worldname>.<var:$<worldname>.<playername>FlagStolenOwner>FlagUnderAttack True'
    - ' @SETSTR $<worldname>.<playername>FlagLoc $<playername>.CommandBlockLoc'
    - ' @SETINT $<worldname>.<playername>FlagStealCount 0'
    - ' @SETINT $<worldname>.<playername>FlagStealCountTmp 0'
    - ' @SETBOOL $<worldname>.<playername>FlagHold False'
    - ' @SETINT $<worldname>.<playername>FlagHoldTime 0'
    - ' @SETSTR $<worldname>.<playername>FlagAttackStatus Started'
#    - ' @IF i $HardWorld.<var:$<worldname>.<playername>FlagStolenOwner>Score >= -500'
    # PVP Capture the flag Code
#    - '   @LOOP $<worldname>.<var:$<worldname>.<playername>FlagStolenOwner>FlagHP'
    - '   @WHILE s $<worldname>.<playername>FlagAttackStatus = Started'
    - '     @FLAMES 3 <currentloc:<playername>>'
    - '     @PAUSE 5'
    - '     @SETSTR $<worldname>.<playername>FlagCurLocTMP <currentloc:<playername>>'
    - '     @IF i <distance:$<worldname>.<playername>FlagCurLocTMP:$<worldname>.<playername>FlagLoc> >= 26'
    - '       @ADDINT $<worldname>.<playername>DistanceCheckOOB 5'
    - '       @PLAYER You are to far away please move closer. Current Distance <distance:$<worldname>.<playername>FlagCurLocTMP:$<worldname>.<playername>FlagLoc> of the allowed 25 .
    Current time out of bounds $<worldname>.<playername>DistanceCheckOOB out of the allowed 10'
    - '       @IF i $<worldname>.<playername>DistanceCheckOOB >= 10'
    - '@PLAYER &8LOG Script Exit Due to Distance <distance:$<worldname>.<playername>FlagCurLocTMP:$<worldname>.<playername>FlagLoc> is greater then 26'
    - '         @BROADCAST &4Team $<playername>.SMTeam failed to take Team $<worldname>.<playername>FlagStolenOwner flag.&r'
    - '         @SETBOOL $<worldname>.<var:$<worldname>.<playername>FlagStolenOwner>FlagUnderAttack False'
    - '         @SETINT $<worldname>.<playername>DistanceCheckOOB 0'
    - '         @EXIT'
    - '       @ENDIF'
    - '     @ELSE'
    - '       @SETINT $<worldname>.<playername>DistanceCheckOOB 0'
    - '     @ENDIF'
    - '     @ADDINT $<worldname>.<playername>FlagStealCount 5'
    - '     @ADDINT $<worldname>.<playername>FlagStealCountTmp 5'
    - '     @IF i $<worldname>.<playername>FlagStealCountTmp = 10'
    - '       @BROADCAST &4 $<worldname>.<playername>FlagStolenOwner Flag HP Damaged $<worldname>.<playername>FlagStealCount of $<worldname>.<var:$<worldname>.<playername>FlagStolenOwner>FlagHP &r'
    - '       @SETINT $<worldname>.<playername>FlagStealCountTmp 0'
    - '     @ENDIF'
    - '     @IF i $<worldname>.<var:$<worldname>.<playername>FlagStolenOwner>FlagHP <= $<worldname>.<playername>FlagStealCount'
    - '       @SETSTR $<worldname>.<playername>FlagAttackStatus Stolen'
    - '       @SETBOOL $<worldname>.<playername>FlagHold True'
    - '       @BROADCAST Team $<playername>.SMTeam has taken Team $<worldname>.<playername>FlagStolenOwner flag.
    Now they must take it to their flag to capture it.'
    - '     @ENDIF'
    - '   @ENDWHILE'
    - '   @WHILE b $<worldname>.<playername>FlagHold = True'
#    - '     @FIREWORK <var:$<worldname>.<playername>FlagStolenOwner> burst <currentloc:<playername>>'
    - '     @FIREWORK $HardWorld.<var:$<worldname>.<playername>FlagStolenOwner>FlagColorFirework burst <currentloc:<playername>>'
    - '     @CMDCON effect <playername> 2 15 1'
    - '     @BROADCAST Team $<worldname>.<playername>FlagStolenOwner stolen flag location <currentloc:<playername>>'
    - '     @PLAYER Holding the flag slows you down.'
    - '     @PAUSE 15'
    # PVP Hold Stolen Flag Time Limit
    - '     @ADDINT $<worldname>.<playername>FlagHoldTime 1'
    - '     @IF i $<worldname>.<playername>FlagHoldTime = 60'
    - '       @BROADCAST Team $<playername>.SMTeam failed to take Team $<worldname>.<playername>FlagStolenOwner flag.'
    - '       @PLAYER Times up you can only hold an opposing flag for 60 minutes before its returned back to the owner.'
    - '       @SETBOOL $<worldname>.<var:$<worldname>.<playername>FlagStolenOwner>FlagUnderAttack False'
    - '       @SETBOOL $<worldname>.<playername>FlagHold False'
    - '       @EXIT'
    - '     @ENDIF'
    - '   @ENDWHILE'
    # PVP Flag Successfully Stolen
    - '   @PAUSE 5'
    - '   @IF b $<worldname>.<playername>FlagSuccessfullyStolen = True'
    - '     @SUBINT $HardWorld.<var:$<worldname>.<playername>FlagStolenOwner>Score 50'
    - '     @CMDOP scoreboard players remove <var:$<worldname>.<playername>FlagStolenOwner>Total SHard 50'
    - '     @SETBOOL $<worldname>.<playername>FlagSuccessfullyStolen False'
    - '     @SETBOOL $<worldname>.<var:$<worldname>.<playername>FlagStolenOwner>FlagUnderAttack False'
    - '     @SETINT $<worldname>.<var:$<worldname>.<playername>FlagStolenOwner>FlagAttackTime <secondticks:1800>'
    - '   @ENDIF'
    # PVP NOT USED - Control Point Code    
#    - ' @LOOP 600'
#    - '   @FLAMES 3 <currentloc:<playername>>'
#    - '   @PAUSE 1'
#    - '   @SETSTR $<worldname>.<playername>FlagCurLocTMP <currentloc:<playername>>'
#    - '   @IF i <distance:$<worldname>.<playername>FlagCurLocTMP:$<worldname>.<playername>FlagLoc> >= 26'
#    - '@PLAYER &8LOG Script Exit Due to Distance <distance:$<worldname>.<playername>FlagCurLocTMP:$<worldname>.<playername>FlagLoc> is greater then 26'
#    - '       @EXIT'
#    - '   @ENDIF'
#    - '   @ADDINT $<worldname>.<playername>FlagStealCount 1'
#    - ' @ENDLOOP'
#    - ' @IF i $<worldname>.<playername>FlagStealCount = 600'
#    - '   @SUBINT $HardWorld.<var:$<worldname>.<playername>FlagStolenOwner>Score 50'
#    - '   @CMDOP scoreboard players remove <var:$<worldname>.<playername>FlagStolenOwner>Total SHard 50'
#    - '   @PLAYER You have successfully broke into team $<worldname>.<playername>FlagStolenOwner treasury. Gather the emeralds at their flag and return them to your flag!'
#    - '   @SETSTR $<worldname>.<playername>FlagDropLoc <relativeloc:$<worldname>.<playername>FlagLoc:0,2,0>'
#    - '   @DROPITEM emerald 50 NONE $<worldname>.<playername>FlagDropLoc'
#    - ' @ENDIF'
#    - ' @ELSE'
#    - '   @PLAYER Unable to attack flag. The team your attacking has to have a score greater then -500.'
#    - ' @ENDIF'
    - '@ELSE'
    - ' @IF b $<worldname>.<playername>AllowedUse != True'
    - '   @PLAYER Unable to attack flag. The next time you can attack is $<worldname>.<var:$<worldname>.<playername>BuildingOwner>FlagAttackTime and current time is <secondticks:0>'
    - ' @ENDIF'
    - ' @IF b $<worldname>.<playername>AllowedUse = True'
    - '   @PLAYER Unable to attack flag. Your team already owns it.'
    - ' @ENDIF'
    - '@ENDIF'
  VictoryCondition:
    Cooldown: 0
    Script:
  # Testing for Victory Condition Met.
    - '@IF i $<worldname>.<var:$<playername>.SMTeam>Score >= $Setup.SurvivalWorldVictoryPointsTotal'
    - ' @BROADCAST Team <var:$<playername>.SMTeam> has won the game!'
    - ' @PAUSE 120'
    - ' @BROADCAST For testing purposes the auto reset has been disabled for now! Become OP and type /vt run NewGame:Reset'
#    - '  @CALL NewGame:Reset'
    - '@ELSE'
    - ' @PLAYER Score $<worldname>.<var:$<playername>.SMTeam>Score of $Setup.SurvivalWorldVictoryPointsTotal'
    - '@ENDIF'
  # Testing for beginner worldguard protections
    - '@IF i $<worldname>.<var:$<playername>.SMTeam>Score >= 25'
    - '@AND b $<worldname>.<var:$<playername>.SMTeam>Explosion != True'
    - ' @CMDCON title @a[team=<var:$<playername>.SMTeam>] title {text:"!WARNING!",color:red}' 
    - ' @CMDCON title @a[team=<var:$<playername>.SMTeam>] subtitle {text:"<var:$<playername>.SMTeam> teams creeper protection fades!",color:yellow}' 
    - ' @CMDCON region flag -w HardWorld $<worldname>.<playername>CurrentTown creeper-explosion allow'
    - ' @CMDCON region flag -w HardWorld $<worldname>.<playername>CurrentTown other-explosion allow'
    - ' @IF s $Setup.SurvivalWorldDiff = Easy'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 50'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 50'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 50'
    - ' @ENDIF'
    - ' @IF s $Setup.SurvivalWorldDiff = Medium'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 100'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 100'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 100'
    - ' @ENDIF'
    - ' @IF s $Setup.SurvivalWorldDiff = Hard'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 150'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 150'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 150'
    - ' @ENDIF'
    - ' @SETBOOL $<worldname>.<var:$<playername>.SMTeam>Explosion True'
    - '@ENDIF'
    - '@IF i $<worldname>.<var:$<playername>.SMTeam>Score >= 50'
    - '@AND b $<worldname>.<var:$<playername>.SMTeam>MobSpawning != True'
    - ' @CMDCON title @a[team=<var:$<playername>.SMTeam>] title {text:"!WARNING!",color:red}' 
    - ' @CMDCON title @a[team=<var:$<playername>.SMTeam>] subtitle {text:"<var:$<playername>.SMTeam> teams monster spawn protection fades!",color:yellow}'        
    - ' @CMDCON region flag -w HardWorld $<worldname>.<playername>CurrentTown deny-spawn'
    - ' @IF s $Setup.SurvivalWorldDiff = Easy'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 75'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 75'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 75'
    - ' @ENDIF'
    - ' @IF s $Setup.SurvivalWorldDiff = Medium'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 150'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 150'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 150'
    - ' @ENDIF'
    - ' @IF s $Setup.SurvivalWorldDiff = Hard'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 200'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 200'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 200'
    - ' @ENDIF'
    - ' @SETBOOL $<worldname>.<var:$<playername>.SMTeam>MobSpawning True'
    - '@ENDIF'
    - '@IF i $<worldname>.<var:$<playername>.SMTeam>Score >= 75'
    - '@AND b $<worldname>.<var:$<playername>.SMTeam>MobSpawn200 != True'
    - ' @CMDCON title @a title {text:"!WARNING!",color:red}' 
    - ' @CMDCON title @a subtitle {text:"<var:$<playername>.SMTeam> teams actions has caused the horde to grow!",color:yellow}'   
    - ' @IF s $Setup.SurvivalWorldDiff = Easy'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 100'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 100'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 100'
    - ' @ENDIF'
    - ' @IF s $Setup.SurvivalWorldDiff = Medium'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 200'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 200'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 200'
    - ' @ENDIF'
    - ' @IF s $Setup.SurvivalWorldDiff = Hard'
    - '   @CMDCON mslimit -s -w HardWorld -t monster -l 250'
    - '   @CMDCON mslimit -s -w HardWorld_nether -t monster -l 250'
    - '   @CMDCON mslimit -s -w HardWorld_the_end -t monster -l 250'
    - ' @ENDIF'
    - ' @SETBOOL $<worldname>.<var:$<playername>.SMTeam>MobSpawn200 True'
    - '@ENDIF'
  Power:
    Cooldown: 5
    Script:
    # NOT DONE COPYING FROM Traps.script.yml and any (Building).script.yml
#    - '@CALL Shared:BuildingID'
#    - '@CALL Shared:Upkeep'
#    - '@IF b $<worldname>.<playername>AllowedUse = True'
    - ' @CALL Flag:Colors'
  # PVP depositing stolen flag
    - ' @IF b $<worldname>.<playername>FlagHold = True'
    - ' @AND s $<playername>.FoundCommandBlock = True'
    - '   @SETBOOL $<worldname>.<playername>FlagSuccessfullyStolen True'
    - '   @SETBOOL $<worldname>.<playername>FlagHold False'
    - '   @CMDOP scoreboard players add <playername> SHard 50'
    - '   @CMDOP scoreboard players add <var:$<playername>.SMTeam>Total SHard 50'
    - '   @ADDINT $<worldname>.<var:$<playername>.SMTeam>Score 50'
    - '   @ADDINT $<worldname>.<playername>Score 50'
    - '   @BROADCAST Team $<playername>.SMTeam has succesfully stolen Team $<worldname>.<playername>BuildingOwner flag and returned it to their own flag.'
  # Testing for Victory Condition Met.
    - '   @CALL Flag:VictoryCondition'
    - ' @ENDIF'
  # Claiming Land  
    - ' @IF s $<worldname>.<playername>Select = claimland'
    - ' @AND s $<playername>.FoundCommandBlock = True'
    - '   @IF i $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSize <= 28'
    - '     @SETINT $<worldname>.<playername>PriceSelected 5'
    - '   @ELSE'
    - '     @IF i $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSize <= 52'
    - '       @SETINT $<worldname>.<playername>PriceSelected 10'
    - '     @ELSE'
    - '       @IF i $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSize <= 104'
    - '         @SETINT $<worldname>.<playername>PriceSelected 20'
    - '       @ELSE'
    - '         @IF i $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSize > 208'
    - '           @SETINT $<worldname>.<playername>PriceSelected 40'
    - '         @ELSE'
    - '           @IF i $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSize > 1000'
    - '             @PLAYER Town size limit of 1000 expansions met you can no longer expand your town.'
    - '             @EXIT'
    - '           @ENDIF'
    - '         @ENDIF'
    - '       @ENDIF'
    - '     @ENDIF'
    - '   @ENDIF'
    - '   @SETBOOL $<worldname>.<playername>PriceSelectedBool True'
    - '   @CALL Shared:Price'
    - '   @SETBOOL $<worldname>.<playername>PriceSelectedBool False'
    - '   @IF b $<worldname>.<playername>PriceCheck = true'
    - '     @ADDINT $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSize 4'
    - '     @ADDINT $<worldname>.<var:$<worldname>.<playername>BuildingTown>FlagHP $<worldname>.<playername>PriceSelected'
    - '     @SETSTR $<worldname>.<playername>TempVarName $<worldname>.<playername>BuildingTown'
    - '     @ADDSTR $<worldname>.<playername>TempVarName TownSize<var:$<worldname>.<playername>SelectClaimLandDirection>'
    - '     @ADDINT $<worldname>.<var:$<worldname>.<playername>TempVarName> 4'
    - '     @SETSTR $<worldname>.<playername>CoordsFixed $<playername>.CommandBlockLoc'
    - '     @CALL Shared:CleanCoords'
    - '     @CMDOP /pos1 $<worldname>.<playername>CoordsFixed'
    - '     @CMDOP /pos2 $<worldname>.<playername>CoordsFixed'
    - '     @CMDOP /expand $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizeeast $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizewest east'
    - '     @CMDOP /expand $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizenorth $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizesouth north'
    - '     @CMDOP /expand $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizeup $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizedown up'
    - '     @PAUSE 1'
    - '     @CMDOP region redefine $<worldname>.<playername>BuildingTown'
    - '   @ENDIF'
    - ' @ENDIF'
  # Adding points to scoreboard display and variabletriggers int variable.    
#    - ' @IF i <itemid> = 388'
#    - '     @SETSTR $<worldname>.<playername>Action EmeraldsToPoints'
#    - '     @CALL Shared:Price'
    - ' @IF s $<worldname>.<playername>Select = deposit'
    - ' @AND s $<playername>.FoundCommandBlock = True'
    - '     @SETINT $<worldname>.<playername>PriceSelected $<worldname>.<playername>SelectDepositAmt'
    - '     @SETBOOL $<worldname>.<playername>PriceSelectedBool True'    
    - '     @CALL Shared:Price'
    - '     @SETBOOL $<worldname>.<playername>PriceSelectedBool False'
    - '     @IF b $<worldname>.<playername>PriceCheck = true'
    - '       @CMDOP scoreboard players add <playername> SHard $<worldname>.<playername>PriceSelected'
    - '       @CMDOP scoreboard players add <var:$<playername>.SMTeam>Total SHard $<worldname>.<playername>PriceSelected'
    - '       @ADDINT $<worldname>.<var:$<playername>.SMTeam>Score $<worldname>.<playername>PriceSelected'
    - '       @ADDINT $<worldname>.<playername>Score $<worldname>.<playername>PriceSelected'
    - '       @SETSTR $<worldname>.<playername>Select Deleted'
    - '       @SETINT $<worldname>.<playername>SelectDepositAmt 0'
    - '       @SETBOOL $<worldname>.<playername>PriceSelectedBool False'
  # Testing for Victory Condition Met.
    - '       @CALL Flag:VictoryCondition'
  # Testing for Gifts met.
    - '       @IF i $<worldname>.<playername>Score = 5'
    - '       @AND b $<worldname>.<playername>ScoreGift1 != True'
    - '         @PLAYER For your dedication to the cause you have been gifted a wand of arrows.'
    - '         @CMDOP wand arrow_gift'
    - '         @SETBOOL $<worldname>.<playername>ScoreGift1 True'
    - '       @ENDIF'
    - '       @IF i $<worldname>.<playername>Score = 10'
    - '       @AND b $<worldname>.<playername>ScoreGift2 != True'
    - '         @PLAYER For your dedication to the cause you have been gifted a wand of arrows.'
    - '         @CMDOP wand arrow_gift2'
    - '         @SETBOOL $<worldname>.<playername>ScoreGift2 True'
    - '       @ENDIF'
    - '       @IF i $<worldname>.<playername>Score = 20'
    - '       @AND b $<worldname>.<playername>ScoreGift3 != True'
    - '         @PLAYER For your dedication to the cause you have been gifted a wand of arrows.'
    - '         @CMDOP wand arrow_gift3'
    - '         @SETBOOL $<worldname>.<playername>ScoreGift3 True'
    - '       @ENDIF'
    - '       @IF i $<worldname>.<playername>Score = 40'
    - '       @AND b $<worldname>.<playername>ScoreGift4 != True'
    - '         @PLAYER For your dedication to the cause you have been gifted a wand of arrows.'
    - '         @CMDOP wand fireball_gift'
    - '         @SETBOOL $<worldname>.<playername>ScoreGift4 True'
    - '       @ENDIF'
    - '     @ENDIF'
#    - ' @ELSE'
  # Call Help File
#    - '   @PLAYER Type /mi help Flag - FOR HELP.'
    - ' @ENDIF'
#    - '@ELSE'
#    - ' @PLAYER Team $<worldname>.<playername>BuildingOwner Flag.'
#    - '@ENDIF'
  Settle:
    Script:
# FOR Testing /vtrigger delvar b natersteen Settled
    - '@IF s <worldname> = $Config.WorldName'
    - '@AND b $<var:$<playername>.SMTeam>.Settled != True'
    - ' @OPENINV LOADING'
    - ' @SETSTR $<worldname>.<playername>ActivePlans Flag'
    - ' @SETSTR $<worldname>.<playername>CurrentTown $<playername>.SMTeam'
    - ' @SETBOOL $<worldname>.<playername>FlagSetup True'
    - ' @POOF 5 <playerloc>'
    - ' @EXPLOSION 0.0 <playerloc>'
    - ' @CMDOP /schematic load flag_survival_match'
    - ' @PAUSE 1'
    - ' @OPENINV LOADING1'
    - ' @CMDOP /paste -a'
    - ' @SETSTR $<playername>.FoundCommandBlock 0'
    - ' @SETINT $<worldname>.<playername>SettleCounter 0'
    - ' @WHILE s $<playername>.FoundCommandBlock != True'
    - '   @PAUSE 2'
    - '   @SETSTR $<worldname>.<playername>CheckType SpiralCheck'
    - '   @CALL Shared:FindCommandBlock'
    - '   @ADDINT $<worldname>.<playername>SettleCounter 1'
    - '   @IF i $<worldname>.<playername>SettleCounter >= 30'
    - '     @SETINT $<worldname>.<playername>SettleCounter 0'
    - '     @CLOSEINV <playername>'
    - '     @PLAYER You must return to your flag and stand near the commandblock now! Otherwise you will lose the game!'
    - '   @ENDIF'
    - ' @ENDWHILE'
    - ' @OPENINV LOADING7'
    - ' @PAUSE 0.2'
    - ' @SETSTR $<playername>.AboveCommandBlockLoc <relativeloc:$<playername>.CommandBlockLoc:0,1,0>'
    - ' @TP $<playername>.AboveCommandBlockLoc'
    - ' @PAUSE 0.2'
    - ' @OPENINV LOADING8'
    - ' @SETSTR $<worldname>.<playername>CoordsFixed $<playername>.CommandBlockLoc'
    - ' @CALL Shared:CleanCoords'
    - ' @CMDOP /pos1 $<worldname>.<playername>CoordsFixed'
    - ' @CMDOP /pos2 $<worldname>.<playername>CoordsFixed'
    - ' @CMDOP /expand 20 20 east'
    - ' @CMDOP /expand 20 20 north'
    - ' @CMDOP /expand 30 10 up'
    - ' @CMDOP region define $<worldname>.<playername>CurrentTown g:members <playername>'
    - ' @PAUSE 1'
    - ' @CMDCON region flag -w HardWorld $<worldname>.<playername>CurrentTown use deny'    
    - ' @CMDCON region flag -w HardWorld $<worldname>.<playername>CurrentTown use -g nonmembers'
    - ' @CMDCON region flag -w HardWorld $<worldname>.<playername>CurrentTown sleep deny'    
    - ' @CMDCON region flag -w HardWorld $<worldname>.<playername>CurrentTown sleep -g nonmembers'
    - ' @CMDCON region flag -w HardWorld $<worldname>.<playername>CurrentTown greeting Entered $<playername>.SMTeam Team Territory'
    - ' @CMDCON region flag -w HardWorld $<worldname>.<playername>CurrentTown farewell Left $<playername>.SMTeam Team Territory'
    - ' @CMDCON region flag -w HardWorld $<worldname>.<playername>CurrentTown deny-spawn CAVE_SPIDER,CREEPER,ENDER_DRAGON,ENDERMAN,GHAST,GIANT,MAGMA_CUBE,SKELETON,SLIME,SPIDER,WITCH,ZOMBIE'
    - ' @CMDCON region flag -w HardWorld $<worldname>.<playername>CurrentTown creeper-explosion deny'
    - ' @CMDCON region flag -w HardWorld $<worldname>.<playername>CurrentTown other-explosion deny' 
    - ' @SETBOOL $<var:$<playername>.SMTeam>.Settled True'
    - ' @SETINT $<worldname>.<var:$<worldname>.<playername>CurrentTown>TownCopyBlocks 1'
    - ' @SETINT $<worldname>.<var:$<worldname>.<playername>CurrentTown>TownSize 1'
    - ' @SETINT $<worldname>.<var:$<worldname>.<playername>CurrentTown>TownSizeeast 20'
    - ' @SETINT $<worldname>.<var:$<worldname>.<playername>CurrentTown>TownSizewest 20'
    - ' @SETINT $<worldname>.<var:$<worldname>.<playername>CurrentTown>TownSizenorth 20'
    - ' @SETINT $<worldname>.<var:$<worldname>.<playername>CurrentTown>TownSizesouth 20'
    - ' @SETINT $<worldname>.<var:$<worldname>.<playername>CurrentTown>TownSizeup 30'
    - ' @SETINT $<worldname>.<var:$<worldname>.<playername>CurrentTown>TownSizedown 10'
    - ' @SETINT $<worldname>.<var:$<worldname>.<playername>CurrentTown>FlagHP 150'
    - ' @PLAYER Land claimed for team <var:$<playername>.SMTeam>. This is your teams Flag. Protect it with your lives!'
    - ' @CMDOP vt setloc <worldname> <var:$<playername>.SMTeam>FlagSpawn'
    - ' @CMDOP setwarp <var:$<playername>.SMTeam>Flag'
    - ' @CMDOP spawnpoint <playername>'
    - ' @SETSTR $<worldname>.<playername>ActivePlans Flag'
    - ' @SETSTR $<var:$<playername>.SMTeam>.TeamSpawnSet true'
    - ' @CMDCON title @a title {text:"Team <var:$<playername>.SMTeam> Ready",color:red}'
    - ' @CMDCON title @a subtitle {text:"type /mi - START GAME - to join your team leader.",color:yellow}'
    - ' @BROADCAST Team <var:$<playername>.SMTeam> spawn is set.'
    - ' @SETSTR $<worldname>.<playername>CheckType SpiralCheck'
    - ' @CALL Shared:BuildingLedger'
    - ' @CLOSEINV <playername>'
    - ' @PAUSE 1'
    - ' @CALL Flag:Colors'
    - '@ELSE'
    - ' @PLAYER You already created your first free settlement or else something else went wrong. Contact an admin if your team has no flag.'
    - '@ENDIF'
  Colors:
    Script:
  # Set Flag color based on Team Color
    - '@SETBOOL $<worldname>.<playername>FlagDamaged False'
    - '@SETINT $<worldname>.<playername>FlagDamageCount 0'
    - '@GETBLOCK $<worldname>.<playername>FlagStick01 <relativeloc:$<playername>.CommandBlockLoc:0,1,-1>'
    - '@IF i <playerloc:y> <= 150'
    - ' @SETINT $<worldname>.<playername>FlagHeight 150'
    - ' @SUBINT $<worldname>.<playername>FlagHeight <playerloc:y>'
    - ' @IF b $<worldname>.<var:$<playername>.SMTeam>FlagRaised != True'
    - '   @SETSTR $<worldname>.<playername>FlagStickLoc <relativeloc:$<playername>.CommandBlockLoc:0,1,-1>'
    - '   @LOOP $<worldname>.<playername>FlagHeight'
    - '     @SETBLOCK 85 <relativeloc:$<worldname>.<playername>FlagStickLoc:0,1,0>'
    - '     @SETSTR $<worldname>.<playername>FlagStickLoc <relativeloc:$<worldname>.<playername>FlagStickLoc:0,1,0>'
    - '   @ENDLOOP'
    - ' @ENDIF'
    - '@ELSE'
    - ' @SETINT $<worldname>.<playername>FlagHeight 6'
    - '@ENDIF'
    - '@SUBINT $<worldname>.<playername>FlagHeight 1'
    - '@GETBLOCK $<worldname>.<playername>FlagColor040 <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,0>'
    - '@IF s $<worldname>.<playername>FlagColor040 != $<worldname>.<playername>FlagColorBlockID'
    - ' @SETBLOCK $<worldname>.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,0>'
    - ' @ADDINT $<worldname>.<playername>FlagDamageCount 1'
    - ' @SETBOOL $<worldname>.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@GETBLOCK $<worldname>.<playername>FlagColor041 <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,1>'
    - '@IF s $<worldname>.<playername>FlagColor041 != $<worldname>.<playername>FlagColorBlockID'
    - ' @SETBLOCK $<worldname>.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,1>'
    - ' @ADDINT $<worldname>.<playername>FlagDamageCount 1'
    - ' @SETBOOL $<worldname>.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@GETBLOCK $<worldname>.<playername>FlagColor042 <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,2>'
    - '@IF s $<worldname>.<playername>FlagColor042 != $<worldname>.<playername>FlagColorBlockID'
    - ' @SETBLOCK $<worldname>.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,2>'
    - ' @ADDINT $<worldname>.<playername>FlagDamageCount 1'
    - ' @SETBOOL $<worldname>.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@ADDINT $<worldname>.<playername>FlagHeight 1'
    - '@GETBLOCK $<worldname>.<playername>FlagColor050 <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,0>'
    - '@IF s $<worldname>.<playername>FlagColor050 != $<worldname>.<playername>FlagColorBlockID'
    - ' @SETBLOCK $<worldname>.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,0>'
    - ' @ADDINT $<worldname>.<playername>FlagDamageCount 1'
    - ' @SETBOOL $<worldname>.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@GETBLOCK $<worldname>.<playername>FlagColor051 <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,1>'
    - '@IF s $<worldname>.<playername>FlagColor051 != $<worldname>.<playername>FlagColorBlockID'
    - ' @SETBLOCK $<worldname>.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,1>'
    - ' @ADDINT $<worldname>.<playername>FlagDamageCount 1'
    - ' @SETBOOL $<worldname>.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@GETBLOCK $<worldname>.<playername>FlagColor052 <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,2>'
    - '@IF s $<worldname>.<playername>FlagColor052 != $<worldname>.<playername>FlagColorBlockID'
    - ' @SETBLOCK $<worldname>.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,2>'
    - ' @ADDINT $<worldname>.<playername>FlagDamageCount 1'
    - ' @SETBOOL $<worldname>.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@ADDINT $<worldname>.<playername>FlagHeight 1'
    - '@GETBLOCK $<worldname>.<playername>FlagColor060 <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,0>'
    - '@IF s $<worldname>.<playername>FlagColor060 != $<worldname>.<playername>FlagColorBlockID'
    - ' @SETBLOCK $<worldname>.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,0>'
    - ' @ADDINT $<worldname>.<playername>FlagDamageCount 1'
    - ' @SETBOOL $<worldname>.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@GETBLOCK $<worldname>.<playername>FlagColor061 <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,1>'
    - '@IF s $<worldname>.<playername>FlagColor061 != $<worldname>.<playername>FlagColorBlockID'
    - ' @SETBLOCK $<worldname>.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,1>'
    - ' @ADDINT $<worldname>.<playername>FlagDamageCount 1'
    - ' @SETBOOL $<worldname>.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@GETBLOCK $<worldname>.<playername>FlagColor062 <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,2>'
    - '@IF s $<worldname>.<playername>FlagColor062 != $<worldname>.<playername>FlagColorBlockID'
    - ' @SETBLOCK $<worldname>.<playername>FlagColorBlockID <relativeloc:$<playername>.CommandBlockLoc:0,$<worldname>.<playername>FlagHeight,2>'
    - ' @ADDINT $<worldname>.<playername>FlagDamageCount 1'
    - ' @SETBOOL $<worldname>.<playername>FlagDamaged True'
    - '@ENDIF'
    - '@IF b $<worldname>.<var:$<playername>.SMTeam>FlagRaised != True'
    - ' @PLAYER You raise your Team $<playername>.SMTeam Flag'
    - ' @SETBOOL $<worldname>.<playername>FlagDamaged False'
    - ' @SETINT $<worldname>.<playername>FlagDamageCount 0'
    - ' @SETBOOL $<worldname>.<var:$<playername>.SMTeam>FlagRaised True'
    - '@ENDIF'
    - '@IF b $<worldname>.<playername>FlagDamaged = True'
    - ' @PLAYER Your Team $<playername>.SMTeam Flag was damaged. Repairing the flag and subtracting $<worldname>.<playername>FlagDamageCount points!'
    - ' @SUBINT $HardWorld.<var:$<playername>.SMTeam>Score $<worldname>.<playername>FlagDamageCount'
    - ' @CMDCON scoreboard players remove <var:$<playername>.SMTeam>Total SHard $<worldname>.<playername>FlagDamageCount'
    - ' @SETINT $<worldname>.<playername>FlagDamageCount 0'
    - ' @SETBOOL $<worldname>.<playername>FlagDamaged False'
    - '@ENDIF'
  IEvent:
    Script:
    - '@IF s <inventorytitle> ?= Flag'
    - ' @SWITCH i <clickedslot>'
    - '   @CASE 17'
    - '     @CALL Flag:Help'
    - '   @CASE 8'
    - '     @CMDOP vt run Flag:Power <playername>'
    - '     @CLOSEINV <playername>'
    - '   @CASE 9'
    - '     @SETSTR $<worldname>.<playername>Select claimland'
    - '     @SETSTR $<worldname>.<playername>SelectClaimLandDirection east'
    - '     @PLAYER Claimland direction set to $<worldname>.<playername>SelectClaimLandDirection'
    - '   @CASE 10'
    - '     @SETSTR $<worldname>.<playername>Select claimland'
    - '     @SETSTR $<worldname>.<playername>SelectClaimLandDirection west'
    - '     @PLAYER Claimland direction set to $<worldname>.<playername>SelectClaimLandDirection'
    - '   @CASE 11'
    - '     @SETSTR $<worldname>.<playername>Select claimland'
    - '     @SETSTR $<worldname>.<playername>SelectClaimLandDirection north'
    - '     @PLAYER Claimland direction set to $<worldname>.<playername>SelectClaimLandDirection'
    - '   @CASE 12'
    - '     @SETSTR $<worldname>.<playername>Select claimland'
    - '     @SETSTR $<worldname>.<playername>SelectClaimLandDirection south'
    - '     @PLAYER Claimland direction set to $<worldname>.<playername>SelectClaimLandDirection'
    - '   @CASE 13'
    - '     @SETSTR $<worldname>.<playername>Select claimland'
    - '     @SETSTR $<worldname>.<playername>SelectClaimLandDirection up'
    - '     @PLAYER Claimland direction set to $<worldname>.<playername>SelectClaimLandDirection'
    - '   @CASE 14'
    - '     @SETSTR $<worldname>.<playername>Select claimland'
    - '     @SETSTR $<worldname>.<playername>SelectClaimLandDirection down'
    - '     @PLAYER Claimland direction set to $<worldname>.<playername>SelectClaimLandDirection'
    - '   @CASE 15'
    - '     @CMDOP vt run Flag:Power <playername>'
    - '     @CLOSEINV <playername>'
    - '   @CASE 3'
    - '     @CLOSEINV <playername>'
    - '     @GETSTRLEN $<worldname>.<playername>TechSelectStrLen $<worldname>.<var:$<playername>.SMTeam>TechResearching'
    - '     @IF i $<worldname>.<playername>TechSelectStrLen >= 2'
    - '       @SETSTR $<worldname>.<playername>TechSelectedTMP $<playername>.SMTeam'
    - '       @ADDSTR $<worldname>.<playername>TechSelectedTMP $<worldname>.<var:$<playername>.SMTeam>TechResearching'
    - '       @SETSTR $<worldname>.<playername>TechSelectedTMP2 $<worldname>.<var:$<playername>.SMTeam>TechResearching'
    - '       @PLAYER Teams current technology selection is $<worldname>.<var:$<playername>.SMTeam>TechResearching and is $<worldname>.<var:$<worldname>.<playername>TechSelectedTMP>RP of $<worldname>.RPPrice<var:$<worldname>.<playername>TechSelectedTMP2> RP from being discovered.' 
    - '     @ELSE'
    - '       @PLAYER Your team has not selected a technology to research. Please select one now.'
    - '     @ENDIF'
    - '     @PAUSE 0.2'
    - '     @OPENINV Technology'
    - '   @CASE 0'
    - '     @CALL Flag:SaveSchematic'
    - '     @CLOSEINV <playername>'
    - '   @CASE 1'
    - '     @CALL Flag:Repair'
    - '     @CLOSEINV <playername>'
    - ' @ENDSWITCH'
    - '@ENDIF'    
  Repair:
    Script:
    - '@IF i <secondticks:0> >= $<worldname>.<var:$<worldname>.<playername>BuildingTown>FlagRepairTime'
    - ' @SETINT $<worldname>.<var:$<worldname>.<playername>BuildingTown>FlagRepairTime <secondticks:600>'
    - ' @CMDOP npc create BobTheBuilder --trait builder'
    - ' @PAUSE 0.5'
    - ' @CMDOP builder timeout 0.5'
    - ' @CMDOP builder supply true'
    - ' @CMDOP npc lookclose'
    - ' @CMDOP builder load <worldname><var:$<worldname>.<playername>BuildingTown><var:$<worldname>.<playername>BuildingCategory>'
    - ' @PAUSE 1'
    - ' @CMDOP builder origin $<worldname>.<var:$<playername>.SMTeam>PlanLoc'
#    - ' @CMDOP builder origin schematic'
    - ' @PAUSE 0.5'
    - ' @CMDOP builder build ignoreair oncomplete:<var:$<worldname>.<playername>BuildingCategory>RepairComplete'
    - '@ELSE'
    - ' @SETINT $<worldname>.<var:$<worldname>.<playername>BuildingTown>FlagRepairTimeLeft $<worldname>.<var:$<worldname>.<playername>BuildingTown>FlagRepairTime'
    - ' @SUBINT $<worldname>.<var:$<worldname>.<playername>BuildingTown>FlagRepairTimeLeft <secondticks:0>'
    - ' @PLAYER $<worldname>.<var:$<worldname>.<playername>BuildingTown>FlagRepairTimeLeft Seconds left before you can repair this town again.'
    - '@ENDIF'
  RepairComplete:
    Script:
    - '@PLAYER Repair Complete. Code not completed should restore flags health.'
  SaveSchematic:
    Script:
    # FORMULA ((E+W+1)/2)-W=X
    # E=East
    # W=West
    # X=Relative Location To Move on X axis.
    # FORMULA ((S+N+1)/2)-N=Z
    # S=South
    # N=North
    # Z=Relative Location To Move on Z axis.
    # All equations will round 0.5 down.
    - '@OPENINV LOADING'
    - '@SETINT $<worldname>.<playername>PlanLocX $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizeeast'
    - '@ADDINT $<worldname>.<playername>PlanLocX $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizewest'
    - '@ADDINT $<worldname>.<playername>PlanLocX 1'
    - '@DIVINT $<worldname>.<playername>PlanLocX 2'
    - '@SUBINT $<worldname>.<playername>PlanLocX $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizewest'
    - '@PLAYER &8LOG PlanLoc set to $<worldname>.<playername>PlanLocX , $<worldname>.<playername>PlanLocY , $<worldname>.<playername>PlanLocZ'
    - '@SETINT $<worldname>.<playername>PlanLocY 0' 
    - '@SUBINT $<worldname>.<playername>PlanLocY $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizedown'
    - '@SETINT $<worldname>.<playername>PlanLocZ $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizesouth'
    - '@ADDINT $<worldname>.<playername>PlanLocZ $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizenorth'
    - '@ADDINT $<worldname>.<playername>PlanLocZ 1'
    - '@DIVINT $<worldname>.<playername>PlanLocZ 2'    
    - '@SUBINT $<worldname>.<playername>PlanLocZ $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizenorth'
    - '@PLAYER &8LOG PlanLoc set to $<worldname>.<playername>PlanLocX , $<worldname>.<playername>PlanLocY , $<worldname>.<playername>PlanLocZ'
    - '@SETSTR $<worldname>.<playername>CoordsFixed $<playername>.CommandBlockLoc'
    - '@CALL Shared:CleanCoords'
    - '@CMDOP /clearhistory'
    - '@PAUSE 0.2'
    - '@CMDOP /pos1 $<worldname>.<playername>CoordsFixed'
    - '@CMDOP /pos2 $<worldname>.<playername>CoordsFixed'
    - '@SETSTR $<worldname>.<playername>PlanLoc $<worldname>.<playername>CoordsFixed'
    - '@SETSTR $<worldname>.<playername>PlanLoc <relativeloc:$<worldname>.<playername>PlanLoc:$<worldname>.<playername>PlanLocX,$<worldname>.<playername>PlanLocY,$<worldname>.<playername>PlanLocZ>'
    - '@SETSTR $<worldname>.<playername>CoordsFixed $<worldname>.<playername>PlanLoc'
    - '@CALL Shared:CleanCoords'
    - '@SETSTR $<worldname>.<var:$<playername>.SMTeam>PlanLoc $<worldname>.<playername>CoordsFixed'
    - '@PLAYER &8LOG Builder Origin Set To $<worldname>.<var:$<playername>.SMTeam>PlanLoc'
    - '@OPENINV LOADING1'
    - '@CMDOP /expand $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizeeast $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizewest east'
    - '@CMDOP /expand $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizenorth $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizesouth north'
    - '@CMDOP /expand $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizeup $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizedown up'
    # This prevents duping in containers
    - '@CMDOP /replace 54 0'
    - '@CMDOP /replace 61 0'
    - '@CMDOP /replace 62 0'    
    - '@CMDOP /replace 23 0'
    - '@CMDOP /replace 158 0'
    - '@CMDOP /replace 342 0'
    - '@CMDOP /replace 379 0'
    - '@CMDOP /replace 408 0'
    - '@PAUSE 1'
    - '@SETSTR $<playername>.AboveCommandBlockLoc <relativeloc:$<playername>.CommandBlockLoc:0,1,0>'
    - '@TP $<playername>.AboveCommandBlockLoc'
    - '@PAUSE 0.2'
    - '@OPENINV LOADING2'
    - '@CMDOP /copy'
    - '@CMDOP /schematic save <worldname><var:$<worldname>.<playername>BuildingTown><var:$<worldname>.<playername>BuildingCategory>'
    - '@CMDOP /distr'
    - '@PAUSE 2'
    - '@OPENINV LOADING4'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@OPENINV LOADING5'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 1'
    - '@OPENINV LOADING6'
    - '@PAUSE 1'
    - '@OPENINV LOADING7'
    - '@PAUSE 1'
    - '@OPENINV LOADING8'
    - '@PAUSE 0.5'
#    - '@PLAYER $<worldname>.<playername>BuildingCategory Schematic has been saved.'
  OLDSaveSchematic:
    Script:
    - '@SETINT $<worldname>.<var:$<playername>.SMTeam>PlanLocX <playerloc:x>'
    - '@ADDINT $<worldname>.<var:$<playername>.SMTeam>PlanLocX $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizeeast'
    - '@SUBINT $<worldname>.<var:$<playername>.SMTeam>PlanLocX $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizewest'    
    - '@SETINT $<worldname>.<var:$<playername>.SMTeam>PlanLocY <playerloc:y>'
    - '@SUBINT $<worldname>.<var:$<playername>.SMTeam>PlanLocY $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizedown'
    - '@SETINT $<worldname>.<var:$<playername>.SMTeam>PlanLocZ <playerloc:z>'
    - '@SUBINT $<worldname>.<var:$<playername>.SMTeam>PlanLocZ $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizenorth'
    - '@ADDINT $<worldname>.<var:$<playername>.SMTeam>PlanLocZ $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizesouth'
    - '@SETSTR $<worldname>.<var:$<playername>.SMTeam>PlanLoc $<worldname>.<var:$<playername>.SMTeam>PlanLocX'
    - '@ADDSTR $<worldname>.<var:$<playername>.SMTeam>PlanLoc ,$<worldname>.<var:$<playername>.SMTeam>PlanLocY'
    - '@ADDSTR $<worldname>.<var:$<playername>.SMTeam>PlanLoc ,$<worldname>.<var:$<playername>.SMTeam>PlanLocZ'
    - '@PLAYER &8LOG Builder Origin Set To $<worldname>.<var:$<playername>.SMTeam>PlanLoc'
    - '@CMDOP /pos1'
    - '@CMDOP /pos2'
    - '@CMDOP /expand $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizeeast $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizewest east'
    - '@CMDOP /expand $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizenorth $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizesouth north'
    - '@CMDOP /expand $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizeup $<worldname>.<var:$<worldname>.<playername>BuildingTown>TownSizedown up'
    # This prevents duping in containers
    - '@CMDOP /replace 54 0'
    - '@CMDOP /replace 61 0'
    - '@CMDOP /replace 62 0'    
    - '@CMDOP /replace 23 0'
    - '@CMDOP /replace 158 0'
    - '@CMDOP /replace 342 0'
    - '@CMDOP /replace 379 0'
    - '@CMDOP /replace 408 0'
    - '@PAUSE 1'
    - '@CMDOP /copy'
    - '@CMDOP /schematic save <worldname><var:$<worldname>.<playername>BuildingTown><var:$<worldname>.<playername>BuildingCategory>'
    - '@PAUSE 2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PAUSE 0.2'
    - '@CMDOP /undo'
    - '@PLAYER $<worldname>.<playername>BuildingCategory Schematic has been saved.'
    