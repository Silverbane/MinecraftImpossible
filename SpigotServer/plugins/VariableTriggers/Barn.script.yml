Scripts:
  Help:
    Script:
    - '@PLAYER Opened Barn Help.'
    - '@PLAYER &4 UNDER CONSTRUCTION'
    - '@PLAYER Closed Barn Help.'
  Ledger:
    Script:
    - '@SETSTR $HardWorld.<playername>CurrentTown $<playername>.SMTeam'
    - '@SETSTR $HardWorld.<playername>NameTMP $<playername>.SMTeam'
    - '@ADDINT $HardWorld.<var:$<playername>.SMTeam>PopLimit 0'
    - '@PLAYER &8LOG Calling Shared:BuildingLedger'
    - '@CALL Shared:BuildingLedger'
  Menu:
    Script:
    - '@SETSTR $HardWorld.<playername>CheckType Y-1Check'
    - '@CALL Shared:BuildingID'
    - '@IF b $HardWorld.<playername>NoOwner = True'
    - '@AND b $HardWorld.<var:$<playername>.SMTeam>Building != True'
    - ' @SETSTR $HardWorld.<playername>CurrentTown $<playername>.SMTeam'
    - ' @SETSTR $HardWorld.<playername>NameTMP $<playername>.SMTeam'
    - ' @SETSTR $HardWorld.<var:$<playername>.SMTeam>BarnID $HardWorld.<playername>BuildingID'
    - ' @ADDINT $HardWorld.<var:$<playername>.SMTeam>PopLimit 0'
    - ' @CALL Shared:BuildingLedger'
    - '@ENDIF'
    - '@IF b $HardWorld.<playername>AllowedUse = True'
    - ' @PLAYER Opening Barn Menu'
    - ' @OPENINV Barn'
    - '@ENDIF'
  IEvent:
    Script:
    - '@IF s <inventorytitle> ?= Barn'
    - ' @SWITCH i <clickedslot>'
    - '   @CASE 0'
    - '     @CALL Barn:Help'
    - '   @CASE 1'
    - '     @PLAYER Chickens Selected.'
    - '     @SETSTR $HardWorld.<playername>Selectcmdarg2TMP Chicken'
    - '   @CASE 2'
    - '     @PLAYER Cows Selected.'
    - '     @SETSTR $HardWorld.<playername>Selectcmdarg2TMP Cow'
    - '   @CASE 3'
    - '     @PLAYER Sheep Selected.'
    - '     @SETSTR $HardWorld.<playername>Selectcmdarg2TMP Sheep'
    - '   @CASE 4'
    - '     @PLAYER Pigs Selected.'
    - '     @SETSTR $HardWorld.<playername>Selectcmdarg2TMP Pig'
    - '   @CASE 5'
    - '     @PLAYER Wolf Selected.'
    - '     @SETSTR $HardWorld.<playername>Selectcmdarg2TMP Wolf'
    - '   @CASE 6'
    - '     @PLAYER Ocelot Selected.'
    - '     @SETSTR $HardWorld.<playername>Selectcmdarg2TMP Ocelot'
    - '   @CASE 7'
    - '     @PLAYER Mushroom Cow Selected.'
    - '     @SETSTR $HardWorld.<playername>Selectcmdarg2TMP MushroomCow'
    - '   @CASE 17'
    - '     @PLAYER Upgrade Selected'
    - '     @IF b $HardWorld.<var:$<playername>.SMTeam>Building = True'
    - '       @PLAYER Your team needs to complete their current building first before starting another building project.'
    - '     @ELSE'
    - '       @IF b $HardWorld.<var:$<playername>.SMTeam>ActivateCB = True'
    - '         @CMDCON title <playername> title {text:"ERROR Activate Structure First",color:red}'
    - '         @PLAYER You need to activate a structure first before moving on to building another.'
    - '         @CALL Shared:BuildComplete'
    - '       @ELSE'
    - '       @SETBOOL $HardWorld.<playername>PlanSchematicUpgradable False'
    - '       @IF i $HardWorld.<playername>BuildingLevel = 1'
    - '       @AND b $HardWorld.<var:$<playername>.SMTeam>DomesticationIIDiscovered = True'
    - '         @SETSTR $HardWorld.<playername>PlanSchematic Barn2'
    - '         @SETBOOL $HardWorld.<playername>PlanSchematicUpgradable True'
    - '       @ENDIF'
    - '       @IF i $HardWorld.<playername>BuildingLevel = 2'
    - '       @AND b $HardWorld.<var:$<playername>.SMTeam>DomesticationIIIDiscovered = True'
    - '         @SETSTR $HardWorld.<playername>PlanSchematic Barn3'
    - '         @SETBOOL $HardWorld.<playername>PlanSchematicUpgradable True'
    - '       @ENDIF'
    - '       @IF i $HardWorld.<playername>BuildingLevel = 3'
    - '       @AND b $HardWorld.<var:$<playername>.SMTeam>DomesticationIVDiscovered = True'
    - '         @SETSTR $HardWorld.<playername>PlanSchematic Barn4'
    - '         @SETBOOL $HardWorld.<playername>PlanSchematicUpgradable True'
    - '       @ENDIF'
    - '       @IF b $HardWorld.<playername>PlanSchematicUpgradable = True'
    - '         @SETSTR $HardWorld.<playername>PlanSchematicID $HardWorld.<playername>BuildingID'
    # Figure out what direction the player is facing to load correct facing schematic
    - '         @SETSTR $HardWorld.<playername>PlanSchematicDirection $HardWorld.<playername>BuildingDirection'
    - '         @IF s $HardWorld.<playername>PlanSchematicDirection = North'
    # Change the origin based on North facing schematic East +X West -X North -Z South +Z .. Then Y depending on basement or not.
    - '           @SETINT $HardWorld.<playername>PlanLocChangeX 0' 
    - '           @SETINT $HardWorld.<playername>PlanLocChangeY -2'
    - '           @SETINT $HardWorld.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '         @IF s $HardWorld.<playername>PlanSchematicDirection = East'
    - '           @SETINT $HardWorld.<playername>PlanLocChangeX 0' 
    - '           @SETINT $HardWorld.<playername>PlanLocChangeY -2'
    - '           @SETINT $HardWorld.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '         @IF s $HardWorld.<playername>PlanSchematicDirection = South'
    - '           @SETINT $HardWorld.<playername>PlanLocChangeX 0' 
    - '           @SETINT $HardWorld.<playername>PlanLocChangeY -2'
    - '           @SETINT $HardWorld.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '         @IF s $HardWorld.<playername>PlanSchematicDirection = West'
    - '           @SETINT $HardWorld.<playername>PlanLocChangeX 0' 
    - '           @SETINT $HardWorld.<playername>PlanLocChangeY -2'
    - '           @SETINT $HardWorld.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '         @CALL Shared:Plan'
    - '       @ELSE'
    - '         @PLAYER This building is not upgradable yet. Discover more tech.'
    - '       @ENDIF'
    - '     @ENDIF'
    - '     @ENDIF'
    - ' @ENDSWITCH'
    - '@ENDIF'
  Deposit:
    Script:
    - '     @PLAYER Rounding up all the animals and guiding them to their pens.'
    - '     @IF i $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalPopCap > $HardWorld.<var:$HardWorld.<playername>BuildingID>CurrentAnimalPop'
    - '         @SETINT $HardWorld.<playername>AnimalPopCapFreeTMP 0'
    - '         @SETINT $HardWorld.<playername>AnimalCowCountTMP 0'
    - '         @SETINT $HardWorld.<playername>AnimalSheepCountTMP 0'
    - '         @SETINT $HardWorld.<playername>AnimalChickenCountTMP 0'
    - '         @SETINT $HardWorld.<playername>AnimalWolfCountTMP 0'
    - '         @SETINT $HardWorld.<playername>AnimalMushroomCowCountTMP 0'
    - '         @SETINT $HardWorld.<playername>AnimalOcelotCountTMP 0'
    - '         @SETINT $HardWorld.<playername>AnimalCountTotalTMP 0'
    - '         @SETINT $HardWorld.<playername>AnimalPopCapFreeTMP $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalPopCap'
    - '         @SUBINT $HardWorld.<playername>AnimalPopCapFreeTMP $HardWorld.<var:$HardWorld.<playername>BuildingID>CurrentAnimalPop'
    - '         @GETENTITYCOUNT $HardWorld.<playername>AnimalCowCountTMP COW 10'
    - '         @GETENTITYCOUNT $HardWorld.<playername>AnimalSheepCountTMP SHEEP 10'
    - '         @GETENTITYCOUNT $HardWorld.<playername>AnimalChickenCountTMP CHICKEN 10'    
    - '         @GETENTITYCOUNT $HardWorld.<playername>AnimalPigCountTMP PIG 10'
    - '         @GETENTITYCOUNT $HardWorld.<playername>AnimalWolfCountTMP WOLF 10'
#    - '         @GETENTITYCOUNT $HardWorld.<playername>AnimalMushroomCowCountTMP MUSHROOMCOW 10'
    - '         @GETENTITYCOUNT $HardWorld.<playername>AnimalOcelotCountTMP OCELOT 10'
    - '         @ADDINT $HardWorld.<playername>AnimalCountTotalTMP $HardWorld.<playername>AnimalCowCountTMP'
    - '         @ADDINT $HardWorld.<playername>AnimalCountTotalTMP $HardWorld.<playername>AnimalSheepCountTMP'
    - '         @ADDINT $HardWorld.<playername>AnimalCountTotalTMP $HardWorld.<playername>AnimalChickenCountTMP'
    - '         @ADDINT $HardWorld.<playername>AnimalCountTotalTMP $HardWorld.<playername>AnimalWolfCountTMP'
#    - '         @ADDINT $HardWorld.<playername>AnimalCountTotalTMP $HardWorld.<playername>AnimalMushroomCowCountTMP'
    - '         @ADDINT $HardWorld.<playername>AnimalCountTotalTMP $HardWorld.<playername>AnimalOcelotCountTMP'
    - '         @IF i $HardWorld.<playername>AnimalPopCapFreeTMP >= $HardWorld.<playername>AnimalCountTotalTMP'
    - '             @ADDINT $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalCowCount $HardWorld.<playername>AnimalCowCountTMP'
    - '             @ADDINT $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalSheepCount $HardWorld.<playername>AnimalSheepCountTMP'
    - '             @ADDINT $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalChickenCount $HardWorld.<playername>AnimalChickenCountTMP'
    - '             @ADDINT $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalPigCount $HardWorld.<playername>AnimalPigCountTMP'
    - '             @ADDINT $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalWolfCount $HardWorld.<playername>AnimalWolfCountTMP'
#    - '             @ADDINT $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalMushroomCowCount $HardWorld.<playername>AnimalMushroomCowCountTMP'
    - '             @ADDINT $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalOcelotCount $HardWorld.<playername>AnimalOcelotCountTMP'
    - '             @ADDINT $HardWorld.<var:$HardWorld.<playername>BuildingID>CurrentAnimalPop $HardWorld.<playername>AnimalCountTotalTMP'
    - '             @CMDOP killall COW 10'
    - '             @CMDOP killall SHEEP 10'
    - '             @CMDOP killall CHICKEN 10'
    - '             @CMDOP killall PIG 10'
    - '             @CMDOP killall WOLF 10'
    - '             @CMDOP killall MUSHROOMCOW 10'    
    - '             @CMDOP killall OCELOT 10'
    - '             @PLAYER Got all the animals in their pens!'
    - '         @ELSE'
    - '             @PLAYER You are trying to pen to many animals you only have room for $HardWorld.<playername>AnimalPopCapFreeTMP and are tying to fit $HardWorld.<playername>AnimalCountTotalTMP more. 
    Remove some animals from around the end portal frame and try again.'
    - '         @ENDIF'
    - '     @ELSE'
    - '         @PLAYER Your current animal storage is $HardWorld.<var:$HardWorld.<playername>BuildingID>CurrentAnimalPop out of $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalPopCap .
    You must build more barns to store more animals.'
    - '     @ENDIF'
  Withdraw:
    Script:
    - '@PLAYER &8LOG CurnAnimalPop $HardWorld.<var:$HardWorld.<playername>BuildingID>CurrentAnimalPop'
    - '     @IF i $HardWorld.<var:$HardWorld.<playername>BuildingID>CurrentAnimalPop > 0'
    - '         @SETINT $HardWorld.<playername>NumTMP 0'
    - '         @SETSTR $HardWorld.<playername>StrTMP Del'
    - '         @SETINT $HardWorld.<playername>NumTMP $HardWorld.<playername>Selectcmdarg3TMP'
    - '         @SETSTR $HardWorld.<playername>StrTMP $HardWorld.<playername>BuildingID'
    - '         @ADDSTR $HardWorld.<playername>StrTMP Animal'
    - '         @ADDSTR $HardWorld.<playername>StrTMP $HardWorld.<playername>Selectcmdarg2TMP'
    - '         @ADDSTR $HardWorld.<playername>StrTMP Count'
    - '@PLAYER &8LOG $HardWorld.<playername>NumTMP $HardWorld.<playername>Selectcmdarg2TMP $HardWorld.<playername>Selectcmdarg3TMP $HardWorld.<playername>BuildingID $HardWorld.<playername>StrTMP '
    - '         @IF i $HardWorld.<playername>NumTMP <= $HardWorld.<var:$HardWorld.<playername>StrTMP>'
    - '             @CMDOP spawnmob $HardWorld.<playername>Selectcmdarg2TMP $HardWorld.<playername>Selectcmdarg3TMP'
    - '             @SUBINT $HardWorld.<var:$HardWorld.<playername>StrTMP> $HardWorld.<playername>Selectcmdarg3TMP'
    - '             @SUBINT $HardWorld.<var:$HardWorld.<playername>BuildingID>CurrentAnimalPop $HardWorld.<playername>Selectcmdarg3TMP'
    - '         @ENDIF'
    - '     @ENDIF'
    - ' @ENDIF'
    - ' @PLAYER &l&nAnimal | Amount |  $HardWorld.<var:$HardWorld.<playername>BuildingID>CurrentAnimalPop / $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalPopCap'
    - ' @PLAYER Chicken| $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalChickenCount'
    - ' @PLAYER Cow    | $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalCowCount'
    - ' @PLAYER Pig    | $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalPigCount'
    - ' @PLAYER Sheep  | $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalSheepCount'
    - ' @PLAYER Wolf   | $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalWolfCount'
    - ' @PLAYER Ocelot | $HardWorld.<var:$HardWorld.<playername>BuildingID>AnimalOcelotCount'