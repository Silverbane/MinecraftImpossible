Scripts:
  Help:
    Script:
    - '@PLAYER Opened Barn Help.'
    - '@PLAYER &4 UNDER CONSTRUCTION'
    - '@PLAYER Closed Barn Help.'
  Ledger:
    Script:
    - '@SETSTR $<worldname>.<playername>CurrentTown $<playername>.SMTeam'
    - '@SETSTR $<worldname>.<playername>NameTMP $<playername>.SMTeam'
    - '@ADDINT $<worldname>.<var:$<playername>.SMTeam>PopLimit 0'
    - '@PLAYER &8LOG Calling Shared:BuildingLedger'
    - '@CALL Shared:BuildingLedger'
  Menu:
    Script:
    - '@SETSTR $<worldname>.<playername>CheckType Y-1Check'
    - '@CALL Shared:BuildingID'
    - '@IF b $<worldname>.<playername>NoOwner = True'
    - '@AND b $<worldname>.<var:$<playername>.SMTeam>Building != True'
    - ' @SETSTR $<worldname>.<playername>CurrentTown $<playername>.SMTeam'
    - ' @SETSTR $<worldname>.<playername>NameTMP $<playername>.SMTeam'
    - ' @SETSTR $<worldname>.<var:$<playername>.SMTeam>BarnID $<worldname>.<playername>BuildingID'
    - ' @ADDINT $<worldname>.<var:$<playername>.SMTeam>PopLimit 0'
    - ' @CALL Shared:BuildingLedger'
    - '@ENDIF'
    - '@IF b $<worldname>.<playername>AllowedUse = True'
    - ' @PLAYER Opening Barn Menu'
    - ' @OPENINV Barn'
    - '@ENDIF'
  IEvent:
    Script:
    - '@IF s <inventorytitle> ?= Barn'
    - ' @SWITCH i <clickedslot>'
    - '   @CASE 0'
    - '     @CALL Barn:Help'
    - '   @CASE 1'
    - '     @PLAYER Chickens Selected.'
    - '     @SETSTR $<worldname>.<playername>Selectcmdarg2TMP Chicken'
    - '   @CASE 2'
    - '     @PLAYER Cows Selected.'
    - '     @SETSTR $<worldname>.<playername>Selectcmdarg2TMP Cow'
    - '   @CASE 3'
    - '     @PLAYER Sheep Selected.'
    - '     @SETSTR $<worldname>.<playername>Selectcmdarg2TMP Sheep'
    - '   @CASE 4'
    - '     @PLAYER Pigs Selected.'
    - '     @SETSTR $<worldname>.<playername>Selectcmdarg2TMP Pig'
    - '   @CASE 5'
    - '     @PLAYER Wolf Selected.'
    - '     @SETSTR $<worldname>.<playername>Selectcmdarg2TMP Wolf'
    - '   @CASE 6'
    - '     @PLAYER Ocelot Selected.'
    - '     @SETSTR $<worldname>.<playername>Selectcmdarg2TMP Ocelot'
    - '   @CASE 7'
    - '     @PLAYER Mushroom Cow Selected.'
    - '     @SETSTR $<worldname>.<playername>Selectcmdarg2TMP MushroomCow'
    - '   @CASE 17'
    - '     @PLAYER Upgrade Selected'
    - '     @IF b $<worldname>.<var:$<playername>.SMTeam>Building = True'
    - '       @PLAYER Your team needs to complete their current building first before starting another building project.'
    - '     @ELSE'
    - '       @SETBOOL $<worldname>.<playername>PlanSchematicUpgradable False'
    - '       @IF i $<worldname>.<playername>BuildingLevel = 1'
    - '       @AND b $<worldname>.<var:$<playername>.SMTeam>DomesticationIIDiscovered = True'
    - '         @SETSTR $<worldname>.<playername>PlanSchematic Barn2'
    - '         @SETBOOL $<worldname>.<playername>PlanSchematicUpgradable True'
    - '       @ENDIF'
    - '       @IF i $<worldname>.<playername>BuildingLevel = 2'
    - '       @AND b $<worldname>.<var:$<playername>.SMTeam>DomesticationIIIDiscovered = True'
    - '         @SETSTR $<worldname>.<playername>PlanSchematic Barn3'
    - '         @SETBOOL $<worldname>.<playername>PlanSchematicUpgradable True'
    - '       @ENDIF'
    - '       @IF i $<worldname>.<playername>BuildingLevel = 3'
    - '       @AND b $<worldname>.<var:$<playername>.SMTeam>DomesticationIVDiscovered = True'
    - '         @SETSTR $<worldname>.<playername>PlanSchematic Barn4'
    - '         @SETBOOL $<worldname>.<playername>PlanSchematicUpgradable True'
    - '       @ENDIF'
    - '       @IF b $<worldname>.<playername>PlanSchematicUpgradable = True'
    - '         @SETSTR $<worldname>.<playername>PlanSchematicID $<worldname>.<playername>BuildingID'
    # Figure out what direction the player is facing to load correct facing schematic
    - '         @SETSTR $<worldname>.<playername>PlanSchematicDirection $<worldname>.<playername>BuildingDirection'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = North'
    # Change the origin based on North facing schematic East +X West -X North -Z South +Z .. Then Y depending on basement or not.
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX 0' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY -2'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = East'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX 0' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY -2'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = South'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX 0' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY -2'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = West'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX 0' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY -2'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '         @CALL Shared:Plan'
    - '       @ELSE'
    - '         @PLAYER This building is not upgradable yet. Discover more tech.'
    - '       @ENDIF'
    - '     @ENDIF'
    - ' @ENDSWITCH'
    - '@ENDIF'
  Deposit:
    Script:
    - '     @PLAYER Rounding up all the animals and guiding them to their pens.'
    - '     @IF i $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalPopCap > $<worldname>.<var:$<worldname>.<playername>BuildingID>CurrentAnimalPop'
    - '         @SETINT $<worldname>.<playername>AnimalPopCapFreeTMP 0'
    - '         @SETINT $<worldname>.<playername>AnimalCowCountTMP 0'
    - '         @SETINT $<worldname>.<playername>AnimalSheepCountTMP 0'
    - '         @SETINT $<worldname>.<playername>AnimalChickenCountTMP 0'
    - '         @SETINT $<worldname>.<playername>AnimalWolfCountTMP 0'
    - '         @SETINT $<worldname>.<playername>AnimalMushroomCowCountTMP 0'
    - '         @SETINT $<worldname>.<playername>AnimalOcelotCountTMP 0'
    - '         @SETINT $<worldname>.<playername>AnimalCountTotalTMP 0'
    - '         @SETINT $<worldname>.<playername>AnimalPopCapFreeTMP $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalPopCap'
    - '         @SUBINT $<worldname>.<playername>AnimalPopCapFreeTMP $<worldname>.<var:$<worldname>.<playername>BuildingID>CurrentAnimalPop'
    - '         @GETENTITYCOUNT $<worldname>.<playername>AnimalCowCountTMP COW 10'
    - '         @GETENTITYCOUNT $<worldname>.<playername>AnimalSheepCountTMP SHEEP 10'
    - '         @GETENTITYCOUNT $<worldname>.<playername>AnimalChickenCountTMP CHICKEN 10'    
    - '         @GETENTITYCOUNT $<worldname>.<playername>AnimalPigCountTMP PIG 10'
    - '         @GETENTITYCOUNT $<worldname>.<playername>AnimalWolfCountTMP WOLF 10'
#    - '         @GETENTITYCOUNT $<worldname>.<playername>AnimalMushroomCowCountTMP MUSHROOMCOW 10'
    - '         @GETENTITYCOUNT $<worldname>.<playername>AnimalOcelotCountTMP OCELOT 10'
    - '         @ADDINT $<worldname>.<playername>AnimalCountTotalTMP $<worldname>.<playername>AnimalCowCountTMP'
    - '         @ADDINT $<worldname>.<playername>AnimalCountTotalTMP $<worldname>.<playername>AnimalSheepCountTMP'
    - '         @ADDINT $<worldname>.<playername>AnimalCountTotalTMP $<worldname>.<playername>AnimalChickenCountTMP'
    - '         @ADDINT $<worldname>.<playername>AnimalCountTotalTMP $<worldname>.<playername>AnimalWolfCountTMP'
#    - '         @ADDINT $<worldname>.<playername>AnimalCountTotalTMP $<worldname>.<playername>AnimalMushroomCowCountTMP'
    - '         @ADDINT $<worldname>.<playername>AnimalCountTotalTMP $<worldname>.<playername>AnimalOcelotCountTMP'
    - '         @IF i $<worldname>.<playername>AnimalPopCapFreeTMP >= $<worldname>.<playername>AnimalCountTotalTMP'
    - '             @ADDINT $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalCowCount $<worldname>.<playername>AnimalCowCountTMP'
    - '             @ADDINT $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalSheepCount $<worldname>.<playername>AnimalSheepCountTMP'
    - '             @ADDINT $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalChickenCount $<worldname>.<playername>AnimalChickenCountTMP'
    - '             @ADDINT $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalPigCount $<worldname>.<playername>AnimalPigCountTMP'
    - '             @ADDINT $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalWolfCount $<worldname>.<playername>AnimalWolfCountTMP'
#    - '             @ADDINT $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalMushroomCowCount $<worldname>.<playername>AnimalMushroomCowCountTMP'
    - '             @ADDINT $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalOcelotCount $<worldname>.<playername>AnimalOcelotCountTMP'
    - '             @ADDINT $<worldname>.<var:$<worldname>.<playername>BuildingID>CurrentAnimalPop $<worldname>.<playername>AnimalCountTotalTMP'
    - '             @CMDOP killall COW 10'
    - '             @CMDOP killall SHEEP 10'
    - '             @CMDOP killall CHICKEN 10'
    - '             @CMDOP killall PIG 10'
    - '             @CMDOP killall WOLF 10'
    - '             @CMDOP killall MUSHROOMCOW 10'    
    - '             @CMDOP killall OCELOT 10'
    - '             @PLAYER Got all the animals in their pens!'
    - '         @ELSE'
    - '             @PLAYER You are trying to pen to many animals you only have room for $<worldname>.<playername>AnimalPopCapFreeTMP and are tying to fit $<worldname>.<playername>AnimalCountTotalTMP more. 
    Remove some animals from around the end portal frame and try again.'
    - '         @ENDIF'
    - '     @ELSE'
    - '         @PLAYER Your current animal storage is $<worldname>.<var:$<worldname>.<playername>BuildingID>CurrentAnimalPop out of $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalPopCap .
    You must build more barns to store more animals.'
    - '     @ENDIF'
  Withdraw:
    Script:
    - '@PLAYER &8LOG CurnAnimalPop $<worldname>.<var:$<worldname>.<playername>BuildingID>CurrentAnimalPop'
    - '     @IF i $<worldname>.<var:$<worldname>.<playername>BuildingID>CurrentAnimalPop > 0'
    - '         @SETINT $<worldname>.<playername>NumTMP 0'
    - '         @SETSTR $<worldname>.<playername>StrTMP Del'
    - '         @SETINT $<worldname>.<playername>NumTMP $<worldname>.<playername>Selectcmdarg3TMP'
    - '         @SETSTR $<worldname>.<playername>StrTMP $<worldname>.<playername>BuildingID'
    - '         @ADDSTR $<worldname>.<playername>StrTMP Animal'
    - '         @ADDSTR $<worldname>.<playername>StrTMP $<worldname>.<playername>Selectcmdarg2TMP'
    - '         @ADDSTR $<worldname>.<playername>StrTMP Count'
    - '@PLAYER &8LOG $<worldname>.<playername>NumTMP $<worldname>.<playername>Selectcmdarg2TMP $<worldname>.<playername>Selectcmdarg3TMP $<worldname>.<playername>BuildingID $<worldname>.<playername>StrTMP '
    - '         @IF i $<worldname>.<playername>NumTMP <= $<worldname>.<var:$<worldname>.<playername>StrTMP>'
    - '             @CMDOP spawnmob $<worldname>.<playername>Selectcmdarg2TMP $<worldname>.<playername>Selectcmdarg3TMP'
    - '             @SUBINT $<worldname>.<var:$<worldname>.<playername>StrTMP> $<worldname>.<playername>Selectcmdarg3TMP'
    - '             @SUBINT $<worldname>.<var:$<worldname>.<playername>BuildingID>CurrentAnimalPop $<worldname>.<playername>Selectcmdarg3TMP'
    - '         @ENDIF'
    - '     @ENDIF'
    - ' @ENDIF'
    - ' @PLAYER &l&nAnimal | Amount |  $<worldname>.<var:$<worldname>.<playername>BuildingID>CurrentAnimalPop / $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalPopCap'
    - ' @PLAYER Chicken| $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalChickenCount'
    - ' @PLAYER Cow    | $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalCowCount'
    - ' @PLAYER Pig    | $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalPigCount'
    - ' @PLAYER Sheep  | $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalSheepCount'
    - ' @PLAYER Wolf   | $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalWolfCount'
    - ' @PLAYER Ocelot | $<worldname>.<var:$<worldname>.<playername>BuildingID>AnimalOcelotCount'