Scripts:
  MenuHelp:
    Script:
    - '@PLAYER Menu Help for Ballistics. UNDER CONSTRUCTION'
  IEvent:
    Script:
    - '@IF s <inventorytitle> ?= Ballistics'
    - ' @SWITCH i <clickedslot>'
    - '   @CASE 0'
    - '     @CALL Ballistics:MenuHelp'
    - '   @CASE 1'
            # Check if tech discovered by team.
    - '     @IF b $<worldname>.<var:$<playername>.SMTeam>BallisticsIDiscovered = True'
    - '       @SETSTR $<worldname>.<playername>PlanSchematic Catapult'
              # Figure out what direction the player is facing to load correct facing schematic
    - '       @CALL Shared:DirectionFacing'
    - '       @SETSTR $<worldname>.<playername>PlanSchematicDirection $<worldname>.<playername>DirectionFacing'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = North'
                # Change the origin based on North facing schematic East +X West -X North -Z South +Z .. Then Y depending on basement or not.
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX 0' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY 0'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ -6'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = East'
                  # Change the origin based on East facing schematic East +X West -X North -Z South +Z .. Then Y depending on basement or not.
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX +6' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY 0'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = South'
                  # Change the origin based on South facing schematic East +X West -X North -Z South +Z .. Then Y depending on basement or not.
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX 0' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY 0'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ +6'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = West'
                  # Change the origin based on West facing schematic East +X West -X North -Z South +Z .. Then Y depending on basement or not.
    - '           @SETINT $<worldname>.<playername>PlanLocChangeX -6' 
    - '           @SETINT $<worldname>.<playername>PlanLocChangeY 0'
    - '           @SETINT $<worldname>.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '       @CALL Ballistics:Plan'
    - '     @ELSE'
    - '       @PLAYER Your team must discover Ballistics I before you can place a Catapult.'
    - '     @ENDIF'
    - '   @CASE 8'
    - '     @CALL Ballistics:Build'
    - '   @CASE 17'
    - '     @CALL Shared:DirectionFacing'
    - '     @PLAYER Facing this direction while selecting a plan will build a $<worldname>.<playername>DirectionFacing facing schematic.'
    - ' @ENDSWITCH'
    - '@ENDIF'
  Build:
    Script:
    - '     @IF b $<worldname>.<playername>PlanActive = True'
    - '       @CMDOP /undo'
    - '       @SETBOOL $<worldname>.<playername>PlanActive False'
    - '     @ENDIF'
    - '     @ADDSTR $<worldname>.<playername>PlanSchematic $<worldname>.<playername>PlanSchematicDirection'
#    - '     @CMDOP npc create Bob --trait builder'
#    - '     @PAUSE 0.5'
#    - '     @CMDOP npc assignment --set Builder'
#    - '     @CMDOP builder supply true'
#    - '     @CMDOP npc lookclose'
#    - '     @CMDOP builder origin me'
    - '     @CMDOP builder load $<worldname>.<playername>PlanSchematic'
    - '     @PAUSE 1'
    - '     @CMDOP builder build ignoreair ignoreliquid oncomplete:Suicide'
  Plan:
    Script:
    - '     @IF b $<worldname>.<playername>PlanActive = False'
#    - '       @CALL Shared:FlagDistanceCheck'
#    - '       @IF b $<worldname>.<playername>FlagDistancePassed = True'
    - '         @SETBOOL $<worldname>.<playername>PlanActive True'
    - '         @CMDOP /schematic load $<worldname>.<playername>PlanSchematic'
    - '         @PAUSE 0.5'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = East'
    - '           @CMDOP /rotate 90'
    - '           @PAUSE 0.5'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = South'
    - '           @CMDOP /rotate 180'
    - '           @PAUSE 0.5'
    - '         @ENDIF'
    - '         @IF s $<worldname>.<playername>PlanSchematicDirection = West'
    - '           @CMDOP /rotate 270'
    - '           @PAUSE 0.5'
    - '         @ENDIF'
    - '         @CMDOP /paste -a'
    - '         @CMDOP npc create BobTheBuilder --trait builder'
    - '         @PAUSE 0.5'
    - '         @CMDOP builder supply true'
    - '         @CMDOP npc lookclose'
    - '         @SETINT $<worldname>.<playername>PlanLocX <playerloc:x>'
    - '         @ADDINT $<worldname>.<playername>PlanLocX $<worldname>.<playername>PlanLocChangeX'   
    - '         @SETINT $<worldname>.<playername>PlanLocY <playerloc:y>'
    - '         @ADDINT $<worldname>.<playername>PlanLocY $<worldname>.<playername>PlanLocChangeY'
    - '         @SETINT $<worldname>.<playername>PlanLocZ <playerloc:z>'
    - '         @ADDINT $<worldname>.<playername>PlanLocZ $<worldname>.<playername>PlanLocChangeZ'
    - '         @SETSTR $<worldname>.<playername>PlanLoc $<worldname>.<playername>PlanLocX'
    - '         @ADDSTR $<worldname>.<playername>PlanLoc ,<var:$<worldname>.<playername>PlanLocY>'
    - '         @ADDSTR $<worldname>.<playername>PlanLoc ,<var:$<worldname>.<playername>PlanLocZ>'
    - '         @CMDOP builder origin $<worldname>.<playername>PlanLoc'
    - '@PLAYER &8LOG Builder Origin Set To $<worldname>.<playername>PlanLoc'
    - '         @SETINT $<worldname>.<playername>PlanActiveTime 0'
                # Plan will be active for 30 seconds then will be removed
    - '         @WHILE b $<worldname>.<playername>PlanActive = True'
    - '           @PAUSE 1'
    - '           @ADDINT $<worldname>.<playername>PlanActiveTime 1'
    - '           @IF i $<worldname>.<playername>PlanActiveTime >= 120'
    - '             @CMDOP /undo'
    - '             @CMDOP npc remove'
    - '             @SETBOOL $<worldname>.<playername>PlanActive False'
    - '           @ENDIF'
    - '         @ENDWHILE'
#    - '       @ELSE'
#    - '         @PLAYER You are to close to your enemies borders to build move atleast 25 squares away and try to build again.'
#    - '       @ENDIF'
    - '     @ELSE'
    - '       @PLAYER You have another plan still active. Clear the plan or build it before placing another plan.'
    - '     @ENDIF'