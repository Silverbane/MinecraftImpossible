Scripts:
  MenuHelp:
    Script:
    - '@PLAYER Menu Help for Ballistics. UNDER CONSTRUCTION'
  IEvent:
    Script:
    - '@IF s <inventorytitle> ?= Ballistics'
    - ' @SWITCH i <clickedslot>'
    - '   @CASE 0'
    - '     @CALL Ballistics:MenuHelp'
    - '   @CASE 1'
            # Check if tech discovered by team.
    - '     @IF b $HardWorld.<var:$<playername>.SMTeam>BallisticsIDiscovered = True'
    - '       @SETSTR $HardWorld.<playername>PlanSchematic Catapult'
              # Figure out what direction the player is facing to load correct facing schematic
    - '       @CALL Shared:DirectionFacing'
    - '       @SETSTR $HardWorld.<playername>PlanSchematicDirection $HardWorld.<playername>DirectionFacing'
    - '         @IF s $HardWorld.<playername>PlanSchematicDirection = North'
                # Change the origin based on North facing schematic East +X West -X North -Z South +Z .. Then Y depending on basement or not.
    - '           @SETINT $HardWorld.<playername>PlanLocChangeX 0' 
    - '           @SETINT $HardWorld.<playername>PlanLocChangeY 0'
    - '           @SETINT $HardWorld.<playername>PlanLocChangeZ -6'
    - '         @ENDIF'
    - '         @IF s $HardWorld.<playername>PlanSchematicDirection = East'
                  # Change the origin based on East facing schematic East +X West -X North -Z South +Z .. Then Y depending on basement or not.
    - '           @SETINT $HardWorld.<playername>PlanLocChangeX +6' 
    - '           @SETINT $HardWorld.<playername>PlanLocChangeY 0'
    - '           @SETINT $HardWorld.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '         @IF s $HardWorld.<playername>PlanSchematicDirection = South'
                  # Change the origin based on South facing schematic East +X West -X North -Z South +Z .. Then Y depending on basement or not.
    - '           @SETINT $HardWorld.<playername>PlanLocChangeX 0' 
    - '           @SETINT $HardWorld.<playername>PlanLocChangeY 0'
    - '           @SETINT $HardWorld.<playername>PlanLocChangeZ +6'
    - '         @ENDIF'
    - '         @IF s $HardWorld.<playername>PlanSchematicDirection = West'
                  # Change the origin based on West facing schematic East +X West -X North -Z South +Z .. Then Y depending on basement or not.
    - '           @SETINT $HardWorld.<playername>PlanLocChangeX -6' 
    - '           @SETINT $HardWorld.<playername>PlanLocChangeY 0'
    - '           @SETINT $HardWorld.<playername>PlanLocChangeZ 0'
    - '         @ENDIF'
    - '       @CALL Ballistics:Plan'
    - '     @ELSE'
    - '       @PLAYER Your team must discover Ballistics I before you can place a Catapult.'
    - '     @ENDIF'
    - '   @CASE 8'
    - '     @CALL Ballistics:Build'
    - '   @CASE 17'
    - '     @CALL Shared:DirectionFacing'
    - '     @PLAYER Facing this direction while selecting a plan will build a $HardWorld.<playername>DirectionFacing facing schematic.'
    - ' @ENDSWITCH'
    - '@ENDIF'
  Build:
    Script:
    - '     @IF b $HardWorld.<playername>PlanActive = True'
    - '       @CMDOP /undo'
    - '       @SETBOOL $HardWorld.<playername>PlanActive False'
    - '     @ENDIF'
    - '     @ADDSTR $HardWorld.<playername>PlanSchematic $HardWorld.<playername>PlanSchematicDirection'
#    - '     @CMDOP npc create Bob --trait builder'
#    - '     @PAUSE 0.5'
#    - '     @CMDOP npc assignment --set Builder'
#    - '     @CMDOP builder supply true'
#    - '     @CMDOP npc lookclose'
#    - '     @CMDOP builder origin me'
    - '     @CMDOP builder load $HardWorld.<playername>PlanSchematic'
    - '     @PAUSE 1'
    - '     @CMDOP builder build ignoreair ignoreliquid oncomplete:Suicide'
  Plan:
    Script:
    - '     @IF b $HardWorld.<playername>PlanActive = False'
#    - '       @CALL Shared:FlagDistanceCheck'
#    - '       @IF b $HardWorld.<playername>FlagDistancePassed = True'
    - '         @SETBOOL $HardWorld.<playername>PlanActive True'
    - '         @CMDOP /schematic load $HardWorld.<playername>PlanSchematic'
    - '         @PAUSE 0.5'
    - '         @IF s $HardWorld.<playername>PlanSchematicDirection = East'
    - '           @CMDOP /rotate 90'
    - '           @PAUSE 0.5'
    - '         @ENDIF'
    - '         @IF s $HardWorld.<playername>PlanSchematicDirection = South'
    - '           @CMDOP /rotate 180'
    - '           @PAUSE 0.5'
    - '         @ENDIF'
    - '         @IF s $HardWorld.<playername>PlanSchematicDirection = West'
    - '           @CMDOP /rotate 270'
    - '           @PAUSE 0.5'
    - '         @ENDIF'
    - '         @CMDOP /paste -a'
    - '         @CMDOP npc create BobTheBuilder --trait builder'
    - '         @PAUSE 0.5'
    - '         @CMDOP builder supply true'
    - '         @CMDOP npc lookclose'
    - '         @SETINT $HardWorld.<playername>PlanLocX <playerloc:x>'
    - '         @ADDINT $HardWorld.<playername>PlanLocX $HardWorld.<playername>PlanLocChangeX'   
    - '         @SETINT $HardWorld.<playername>PlanLocY <playerloc:y>'
    - '         @ADDINT $HardWorld.<playername>PlanLocY $HardWorld.<playername>PlanLocChangeY'
    - '         @SETINT $HardWorld.<playername>PlanLocZ <playerloc:z>'
    - '         @ADDINT $HardWorld.<playername>PlanLocZ $HardWorld.<playername>PlanLocChangeZ'
    - '         @SETSTR $HardWorld.<playername>PlanLoc $HardWorld.<playername>PlanLocX'
    - '         @ADDSTR $HardWorld.<playername>PlanLoc ,<var:$HardWorld.<playername>PlanLocY>'
    - '         @ADDSTR $HardWorld.<playername>PlanLoc ,<var:$HardWorld.<playername>PlanLocZ>'
    - '         @CMDOP builder origin $HardWorld.<playername>PlanLoc'
    - '@PLAYER &8LOG Builder Origin Set To $HardWorld.<playername>PlanLoc'
    - '         @SETINT $HardWorld.<playername>PlanActiveTime 0'
                # Plan will be active for 30 seconds then will be removed
    - '         @WHILE b $HardWorld.<playername>PlanActive = True'
    - '           @PAUSE 1'
    - '           @ADDINT $HardWorld.<playername>PlanActiveTime 1'
    - '           @IF i $HardWorld.<playername>PlanActiveTime >= 120'
    - '             @CMDOP /undo'
    - '             @CMDOP npc remove'
    - '             @SETBOOL $HardWorld.<playername>PlanActive False'
    - '           @ENDIF'
    - '         @ENDWHILE'
#    - '       @ELSE'
#    - '         @PLAYER You are to close to your enemies borders to build move atleast 25 squares away and try to build again.'
#    - '       @ENDIF'
    - '     @ELSE'
    - '       @PLAYER You have another plan still active. Clear the plan or build it before placing another plan.'
    - '     @ENDIF'